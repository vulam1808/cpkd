$(function(){iNet.ns("iNet.ui.task","iNet.ui.task.TAdditional");iNet.ui.task.TAdditional=function(){this.id="additional-div";var g=this,l=null,p={targetID:targetID},i={additional:iNet.resources.receiver.additional,global:iNet.resources.global,errors:iNet.resources.errors,constant:iNet.resources.constant,validate:iNet.resources.validate},n={additional_reqquery:iNet.getUrl("onegate/externaldata/reqquery"),additional_requpload:iNet.getUrl("onegate/externaldata/requpload"),additional_reqremove:iNet.getUrl("onegate/externaldata/reqremove")},
m=iNet.getLayout().taskMenu;m.on("menuchange",function(){});m.on("create",function(){q()});var q=function(){if(l==null)l=new iNet.ui.task.TRequest;l.on("finish",function(c){g.show();l.hide();iNet.isEmpty(c)||m.refresh("additional")});l.setData({});l.show();g.hide()},b=new iNet.ui.listview({id:"additional-list",uiItemId:"additional-list-item-ui",url:n.additional_reqquery,basicSearch:function(){this.id="additional-list-basic-search";this.intComponent=function(){var c=this,e=$("#additional-list-basic-search-expand-btn"),
j=$("#additional-list-basic-search-search-btn");this.$keyword=$("#additional-list-basic-search-txt-keyword");j.on("click",function(){b.advanceSearch.hide();var f=b.getParams()||{};f.keyword=c.$keyword.val();b.setParams(f);b.load()});e.on("click",function(){b.advanceSearch.show()})}},advanceSearch:function(){this.id="additional-list-advance-search";this.intComponent=function(){var c=this,e=$("#additional-list-advance-search-search-btn"),j=$("#additional-list-advance-search-close-btn");this.$receipt=
$("#additional-list-advance-search-receipt-txt");this.$serial=$("#additional-list-advance-search-serial-txt");this.$warnHour=$("#additional-list-advance-search-warnHour-txt");e.on("click",function(){b.advanceSearch.hide();var f=b.getParams()||{};f.serial=c.$serial.val();f.keyword=b.basicSearch.$keyword.val();b.setParams(f);b.load()});j.on("click",function(){b.advanceSearch.hide()})}},pullLeft:function(){this.id="additional-list-pull-left";this.intComponent=function(){}},params:{pageSize:20,pageNumber:0,
targetID:p.targetID},convertData:function(c){var e=c||{};b.setTotal(e.total);$.each(e.items||[],function(j,f){b.addItem(f)})}});b.on("indexchange",function(c){h.reset();if(!iNet.isEmpty(c.uuid)){var e=c||{};h.setData(e);var j={subject:c.subject||"",showAttachmentIcon:false,showCommentIcon:false,showDetailsIcon:false},f={name:c.requestName,date:" ("+$.timeago(c.created)+")",showDetailsIcon:false};h.setHeader({subject:j,sender:f,object:e});var k="",d="";d+='<div class="row-fluid">';d+='    <label class="span4">{1}</label>';
d+='    <div class="ace-file-input span5" data-container data-name="{0}">';d+='         <label data-name="{0}" data-title="Click here" class="ace-file-container file-label">';d+='             <span data-title="..." data-name="{0}" class="ace-file-name file-name"><i class="icon-upload-alt ace-icon"></i></span>';d+="         </label>";d+='         <a data-remove data-name="{0}" class="remove" href="#"><i class=" ace-icon fa fa-times"></i></a>';d+="    </div>";d+='    <div class="span3" style="margin-left: 5px;margin-top: 3px;">';
d+="        <label>";d+='            <input data-hardcopy data-name="{0}" type="checkbox" name="{0}_hardcopy" value="false" class="ace" style="display: none;" id="{0}_hardcopy">';d+='            <span class="lbl"> '+i.additional.hardcopy+"</span>";d+="        </label>";d+="    </div>";d+='    <input data-note data-name="{0}" type="text" name="{0}_note" value="{1}" style="display: none;">';d+='    <input type="file" name="{0}" style="display:none;" data-file data-name="{0}"/>';d+="</div>";for(var o in e.files)k+=
String.format(d,o,iNet.isEmpty(e.files[o])?o:e.files[o]);var a="";a+='<script type="application/javascript">\n';a+='$("[data-file][data-name]").on("change", function(){\n';a+="if (this.files.length < 1) {\n";a+="this.files = [];\n";a+="return;\n";a+="}\n";a+="var __nameFile = this.files[0].name;\n";a+='$(this).parent().find("span[data-title]").attr("data-title", __nameFile);\n';a+='$(this).parent().find(".ace-file-container").addClass("selected");\n';a+="});\n";a+='$("[data-remove][data-name]").on("click", function(){\n';
a+='var __dataName = $(this).attr("data-name");\n';a+='$(\'span[data-title][data-name="\'+__dataName+\'"]\').attr("data-title", "...");\n';a+="$('[data-file][data-name=\"'+__dataName+'\"]').val(\"\");\n";a+="$('.ace-file-container[data-name=\"'+__dataName+'\"]').removeClass(\"selected\");\n";a+="});\n";a+='$("[data-hardcopy][data-name]").on("change", function(){\n';a+='$(this).attr("value", $(this).prop("checked"));\n';a+="});\n";a+='$("[data-container][data-name] label").on("click", function(){\n';
a+='var __dataName = $(this).attr("data-name");\n';a+="$('[data-file][data-name=\"'+__dataName+'\"]').trigger(\"click\");\n";a+="});\n";a+="<\/script>";k+=a;h.setSubmitContent(k);var r=[],s=[];h.setFooter({comments:r,attBriefs:s})}});b.on("typechange",function(c){c=="max"?h.setType("min"):h.setType("full")});var h=new iNet.ui.itemview({id:"additional-view",resource:i,url:n,toolbar:function(){this.id="additional-toolbar";this.intComponent=function(){var c=$("#additional-view-print-btn"),e=$("#additional-view-send-btn"),
j=$("#additional-view-remove-btn");e.on("click",function(){var f=b.getData()||{};h.resetBodyHidden();h.addBodyHidden("requestID",f.uuid);var k=n.additional_requpload||"";iNet.isEmpty(k)||h.submit(k)});j.on("click",function(){g.confirmDialog(i.constant.del_title,"",function(){g.dialog.hide();iNet.isEmpty(g.dialog.params)||$.postJSON(n.additional_reqremove,g.dialog.params,function(k){var d=k||{};if(CommonService.isSuccess(d)){m.refresh("additional");b.refresh()}else g.notifyError(i.constant.del_title,
g.getNotifyContent(i.constant.del_error,d.errors||[]))})});var f=b.getData()||{};g.dialog.setContent(g.getNotifyContent(i.constant.del_content,""));g.dialog.params={"package":f.targetID};g.dialog.show()});c.on("click",function(){var f=b.getData()||{};window.open(iNet.getUrl(CommonService.pageRequest.formNo01)+"?targetID="+(f.targetID||""),"_blank")})}},ajaxMaskId:"ajax-mask",headerDetails:{subject:"additional-subject-details",sender:"additional-sender-details"}});h.on("submitted",function(c){var e=
c||{};if(e.type=="error")g.notifyError(i.constant.submit_title,g.getNotifyContent(i.constant.submit_error,e.errors||[]));else{g.notifySuccess(i.constant.submit_title,i.constant.submit_success);m.refresh("additional");b.refresh()}});h.on("headerchange",function(c){console.log(">>headerchange>>",c)});h.on("menuclick",function(){b.setType("menu")});b.setType("max");iNet.ui.task.TAdditional.superclass.constructor.call(this)};iNet.extend(iNet.ui.task.TAdditional,iNet.ui.app.widget);(new iNet.ui.task.TAdditional).show()});
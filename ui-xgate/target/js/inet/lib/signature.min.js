$(function(){iNet.ns("iNet.ui.signature","iNet.ui.signinfor");iNet.ui.signinfor=function(){this.id="signature-info-div";var g=$("#signature-info-div"),i=this,c=[],j={signverify:iNet.getUrl("onegate/externaldata/signverify")},b={signData:$("#signature-info-data-div"),subject:$("#signature-info-subject"),subjectDetail:$("#signature-info-subject-detail"),issuer:$("#signature-info-issuer"),issuerDetail:$("#signature-info-issuer-detail"),reason:$("#signature-info-reason-data"),signTime:$("#signature-info-signTime-data"),
verified:$("#signature-info-verified-data"),signNoData:$("#signature-info-no-data-div"),paging:$("#signature-info-paging-div"),pagingIndex:$("#signature-info-paging-index"),pagingTotal:$("#signature-info-paging-total")},k={close:$("#signature-info-div-close-btn"),back:$("#signature-info-paging-back"),next:$("#signature-info-paging-next")};b.subject.on("click",function(){b.subjectDetail.show();b.subject.find("i").addClass("icon-minus").removeClass("icon-plus");b.issuerDetail.hide();b.issuer.find("i").addClass("icon-plus").removeClass("icon-minus")});
b.issuer.on("click",function(){b.subjectDetail.hide();b.subject.find("i").addClass("icon-plus").removeClass("icon-minus");b.issuerDetail.show();b.issuer.find("i").addClass("icon-minus").removeClass("icon-plus")});k.back.on("click",function(){var a=b.pagingIndex.text();a-=1;a-=1;if(a<=0)a=0;f(a)});k.next.on("click",function(){var a=b.pagingIndex.text();a+=1;if(a>c.length)a=c.length;f(a-1)});var f=function(a){var h=c[a].signs||[],e=h[0].subject||{},d;for(d in e)b.subjectDetail.find('[data-sign-info="'+
d+'"]').text(e[d]||"");var l=h[0].issuer||{};for(d in l)b.issuerDetail.find('[data-sign-info="'+d+'"]').text(l[d]||"");var n=c[a].reason||"";b.reason.text(n);var m=c[a].signTime||0;b.signTime.text(m>0?(new Date(m)).format("H:i:s d/m/Y"):"");var o=c[a].verified||"";b.verified.text(o);if(c.length>1){b.paging.show();b.pagingIndex.text(a+1);b.pagingTotal.text(c.length)}else b.paging.hide()};this.setData=function(a){$.postJSON(j.signverify,{fileId:a},function(h){var e=h.elements||[];if(e.length==0){b.paging.hide();
b.signData.hide();b.signNoData.show()}else{b.signData.show();b.signNoData.hide();c=e||[];f(0)}})};this.show=function(){g.modal("show")};this.hide=function(){g.modal("hide")};k.close.on("click",function(){i.hide()})};iNet.extend(iNet.ui.signinfor,iNet.Component);iNet.ui.signature=function(){this.id="signature-view-div";var g=this,i=null,c={},j=null,b={global:iNet.resources.global,errors:iNet.resources.errors,constant:iNet.resources.constant,validate:iNet.resources.validate},k={signfile:iNet.getUrl("onegate/externaldata/signfile"),
downfile:iNet.getUrl("onegate/binary/download")},f={back:$("#signature-back-btn"),submit:$("#signature-submit-btn"),lanhdao:$("#signature-mode-lanhdao-btn"),tochuc:$("#signature-mode-tochuc-btn")};this.setPageBack=function(e){i=e};this.setData=function(e){window.signature=g;var d=e||{};console.log(">>Signature setData>>",d);c={};c.fileId=d.uuid;c.task=d.taskId;c.graph=d.graphId};this.signData=function(){c.signdata=$("#signature-data").val();c.signnote=$("#signature-note").val();$.postJSON(k.signfile,
c,function(e){var d=e||{};if(d.type=="ERROR")g.notifyError(b.constant.submit_title,g.getNotifyContent(b.constant.submit_error,d.errors||[]));else{g.notifySuccess(b.constant.submit_title,b.constant.submit_success);i.show();g.hide()}})};this.hideSubmit=function(){f.submit.hide()};this.viewVerify=function(e){if(j==null)j=new iNet.ui.signinfor;j.setData(e);j.show()};var a="";a+='<object codetype="application/java"\n';a+='classid="clsid:8AD9C840-044E-11D1-B3E9-00805F499D93"\n';a+='name="signature" height="400px" width="100%">\n';
a+='<param name="codebase" value="http://www.inetcloud.vn/public/tool/">\n';a+='<param name="code" value="bcy.vgca.Applet.mainApplet">\n';a+='<param name="archive" value="Binhthuan_applet.jar">\n';a+='<param name="mayscript" value="true">\n';a+='<param name="type" value="application/x-java-applet;version=1.5">\n';a+='<param name="scriptable" value="false">\n';a+='<param name="func_ghi_du_lieu_len_form" value="ghi_du_lieu_len_form">\n';a+='<param name="func_ToChuc_On_Off" value="{0}">\n';a+='<param name="func_LanhDao_On_Off" value="{1}">\n';
a+="<comment>\n";a+='<embed type="application/x-java-applet;version=1.5"\n';a+='codebase="http://www.inetcloud.vn/public/tool/"\n';a+='archive="Binhthuan_applet.jar"\n';a+='code="bcy.vgca.Applet.mainform"\n';a+='scriptable="true"\n';a+='pluginspage="http://java.sun.com/products/plugin/index.html#download"\n';a+='func_ghi_du_lieu_len_form="ghi_du_lieu_len_form" func_ToChuc_On_Off="{0}"\n';a+='func_LanhDao_On_Off="{1}" height="400px" width="100%">\n';a+="<noembed>\n";a+="Can not be started because Java Plugin is not installed.\n";
a+="</noembed>\n";a+="</comment>\n";a+="</object>\n";var h=function(e,d){$("#signature-form").hide();$("#signature-form").find("object").remove();$("#signature-form").append(String.format(a,d,e));e=="on"?f.lanhdao.attr("disabled","disabled"):f.lanhdao.removeAttr("disabled");d=="on"?f.tochuc.attr("disabled","disabled"):f.tochuc.removeAttr("disabled");setTimeout(function(){$("#signature-form").show()},1E3)};f.lanhdao.on("click",function(){h("on","off")});f.tochuc.on("click",function(){h("off","on")});
f.submit.on("click",function(){g.signData()});f.back.on("click",function(){if(i!=null){i.show();g.hide()}});iNet.ui.signature.superclass.constructor.call(this)};iNet.extend(iNet.ui.signature,iNet.ui.app.widget)});
$(function(){iNet.ns("iNet.ui.task","iNet.ui.task.TRecord");iNet.ui.task.TRecord=function(){this.id="record-home-div";var f=this,g=null,h=null;iNet.ui.task.TRecord.superclass.constructor.call(this);var e={record:iNet.resources.receiver.record,global:iNet.resources.global,errors:iNet.resources.errors,constant:iNet.resources.constant,validate:iNet.resources.validate},l={recordsearch:iNet.getUrl("onegate/deptrecord/search"),checkAdditional:iNet.getUrl("onegate/externaldata/reqload"),checkUpdate:iNet.getUrl("onegate/deptrecord/load")},
i={printFormNo03:$("#record-home-print-form-no03-btn"),printFormNo04:$("#record-home-print-form-no04-btn")},n=iNet.getLayout().taskMenu;n.on("menuchange",function(){});n.on("create",function(){s()});var j=null,s=function(){if(j==null)j=new iNet.ui.task.TRequest;j.on("finish",function(d){f.show();j.hide();if(!iNet.isEmpty(d)){n.refresh("record");k.load()}});j.setData({});j.show();f.hide()},o=function(d){var b=d||{},c="",a="",m="";c={};switch(b.statusDrilldown||""){case "CREATED":c+="?queueID="+b.idDrilldown;
a=iNet.getUrl(CommonService.pageRequest.created);c={queueID:b.idDrilldown,briefcaseStatus:b.statusDrilldown};break;case "UPDATE":case "INPROCESS":c+="?recordID="+b.idDrilldown;a=iNet.getUrl(CommonService.pageRequest.inprocess);c={recordID:b.idDrilldown,briefcaseStatus:b.statusDrilldown};break;case "REJECTED":c+="?recordID="+b.idDrilldown;a=iNet.getUrl(CommonService.pageRequest.rejected);c={recordID:b.idDrilldown,briefcaseStatus:b.statusDrilldown};break;case "PUBLISHED":c+="?recordID="+b.idDrilldown;
a=iNet.getUrl(CommonService.pageRequest.published);c={recordID:b.idDrilldown,briefcaseStatus:b.statusDrilldown};break;case "COMPLETED":c+="?recordID="+b.idDrilldown;a=iNet.getUrl(CommonService.pageRequest.completed);c={recordID:b.idDrilldown,briefcaseStatus:b.statusDrilldown};break;case "ADDITIONAL":c+="?targetID="+b.idDrilldown;a=iNet.getUrl(CommonService.pageRequest.additional);break;default:m=""}if(!iNet.isEmpty(c.briefcaseStatus)){if(c.briefcaseStatus=="CREATED"){if(h==null){h=new iNet.ui.task.TQueue(c);
h.on("back",function(){k.load();h.hide();f.show()})}else h.setData(c);h.show()}else{if(g==null){g=new iNet.ui.task.TBriefcase(c);g.on("back",function(){k.load();g.hide();f.show()})}else g.setData(c);g.show()}f.hide()}},t=new DataSource({columns:[{property:"subject",label:e.record.subject,sortable:true,disabled:true},{property:"fullName",label:e.record.fullName,sortable:true,disabled:true},{property:"serialNo",label:e.record.serialNo,sortable:true,disabled:true},{property:"receiptNo",label:e.record.receiptNo,
sortable:true,disabled:true},{property:"recordBook",label:e.record.recordBook,sortable:true,disabled:true},{property:"recordOrder",label:e.record.recordOrder,sortable:true,disabled:true},{property:"statusName",label:e.record.status,sortable:true,disabled:true},{property:"created",label:e.record.created,sortable:true,disabled:true},{property:"appointment",label:e.record.appointment,sortable:true,disabled:true},{property:"completed",label:e.record.completed,sortable:true,disabled:true},{property:"additional",
label:'<i class="icon-plus-sign icon-large" title="'+e.record.additional+'"></i>',sortable:true,disabled:true},{property:"update",label:'<i class="icon-edit-sign icon-large" title="'+e.record.update+'"></i>',sortable:true,disabled:true},{label:"",type:"action",width:32,align:"center",buttons:[{text:iNet.resources.message.button.view,icon:"icon-eye-open",labelCls:"label label-success",fn:function(d){o(d)}}]}],delay:250}),q=function(){this.id="record-home-basic-search";this.url=l.recordsearch};iNet.extend(q,
iNet.Component,{intComponent:function(){this.$keyword=$("#record-home-basic-search-txt")},getId:function(){return this.id},getUrl:function(){return this.url},getData:function(){return{keyword:this.$keyword.val(),pageNumber:0,pageSize:10}}});var r=function(){this.id="record-home-advance-search";this.url=l.recordsearch};iNet.extend(r,iNet.Component,{intComponent:function(){this.$serialNo=$("#record-home-advance-search-serialNo");this.$receiptNo=$("#record-home-advance-search-receiptNo");this.$status=
$("#record-home-advance-search-status");this.$type=$("#record-home-advance-search-type")},getId:function(){return this.id},getUrl:function(){return this.url},getData:function(){return{serial:this.$serialNo.val(),receipt:this.$receiptNo.val(),status:this.$status.val(),type:this.$type.val(),pageNumber:0,pageSize:10}}});var k=new iNet.ui.grid.Grid({id:"record-home-grid",url:l.recordsearch,basicSearch:q,advanceSearch:r,convertData:function(d){var b=d||{};k.setTotal(b.total);$.each(b.items,function(c,
a){a.statusDrilldown=a.status;a.idDrilldown=a.uuid;if(a.status=="CREATED")a.idDrilldown=a.requestID;a.statusName=e.record["status"+a.status]||"";a.created=a.created>0?(new Date(a.created)).format("H:i d/m/Y"):"";a.appointment=a.appointment>0?(new Date).getTime()>a.appointment&&a.completed==0||a.completed>a.appointment?'<label style="color: #ff0511;font-weight: bolder;">'+(new Date(a.appointment)).format("H:i d/m/Y")+"</label>":'<label style="color:#0000C0;font-weight: bolder;">'+(new Date(a.appointment)).format("H:i d/m/Y")+
"</label>":"";a.completed=a.completed>0?(new Date(a.completed)).format("H:i d/m/Y"):"";a.additional='<i data-check-additional="'+a.additionalID+'" data-idDrilldown="'+a.additionalID+'" class="icon-spinner icon-spin icon-large" style="color: #4387f5;"></i>';a.update='<i data-check-update="'+a.requestID+'" data-idDrilldown="'+a.idDrilldown+'" class="icon-spinner icon-spin icon-large" style="color: #4387f5;"></i>'});return b.items},remotePaging:true,dataSource:t,stretchHeight:false,editable:false,firstLoad:true,
idProperty:"uuid"});k.on("click",function(d){f.recordData=d||{};i.printFormNo03.show();i.printFormNo04.show()});k.on("loaded",function(){i.printFormNo03.hide();i.printFormNo04.hide();$("#record-home-grid").find("i.icon-spinner.icon-spin.icon-large").each(function(d,b){var c=$(b).attr("data-check-additional")||"",a=$(b).attr("data-idDrilldown")||"";iNet.isEmpty(c)||$.postJSON(l.checkAdditional,{packageID:c},function(p){if(iNet.isEmpty((p||{}).uuid||"")){$(b).removeClass("icon-spinner icon-spin");$(b).css("color",
"#D60505")}else{$(b).removeClass("icon-spinner icon-spin").addClass("icon-tags");$(b).attr("title",e.record.additional);$(b).css("color","#2700FF");$(b).on("click",function(){o({statusDrilldown:"ADDITIONAL",idDrilldown:a})})}});var m=$(b).attr("data-check-update")||"";iNet.isEmpty(m)||$.postJSON(l.checkUpdate,{request:m},function(p){var u=(((p||{}).request||{}).status||"")=="UPDATE";if(u){$(b).removeClass("icon-spinner icon-spin").addClass("icon-pencil");$(b).attr("title",e.record.update);$(b).css("color",
"#2700FF");$(b).on("click",function(){o({statusDrilldown:"UPDATE",idDrilldown:a})})}else{$(b).removeClass("icon-spinner icon-spin");$(b).css("color","#D60505")}})})});i.printFormNo03.on("click",function(){var d=(f.recordData||{}).requestID||"";iNet.isEmpty(d)||window.open(iNet.getUrl(CommonService.pageRequest.formNo03)+"?task="+d,"_blank")});i.printFormNo04.on("click",function(){var d=(f.recordData||{}).requestID||"";iNet.isEmpty(d)||window.open(iNet.getUrl(CommonService.pageRequest.formNo04)+"?task="+
d,"_blank")})};iNet.extend(iNet.ui.task.TRecord,iNet.ui.app.widget);(new iNet.ui.task.TRecord).show()});
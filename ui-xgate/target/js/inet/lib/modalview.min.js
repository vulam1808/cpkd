$(function(){iNet.ns("iNet.ui.modalview");iNet.ui.modalview=function(){this.id=iNet.generateId();var l=$('[data-id="modal-view-control"]'),c=this,g={global:iNet.resources.global,constant:iNet.resources.constant,errors:iNet.resources.errors},i=null,k=function(a,f,d){i||(i=new iNet.ui.form.Notify({id:iNet.generateId()}));i.setType(a);i.setTitle(f);i.setContent(d);i.show()},n=function(a,f){if(!iNet.isEmpty(f))if(iNet.isArray(f)){var d=[];try{f.forEach(function(h){iNet.isEmpty(h.message||"")?d.push("<br/>"+
h):d.push("<br/>"+iNet.resources.errors[h.message||""])});return String.format(a,d)}catch(b){console.log(">> notifyContent >>",f);return""}}else{d=f||"";return String.format(a,d)}return""},e={title:$('[data-id="modal-view-control-tile"]'),body:$('[data-id="modal-view-control-body"]'),info:$('[data-id="modal-view-control-body-info"]'),note:$('[data-id="modal-view-control-body-note"]'),description:$('[data-id="modal-view-control-additional-description"]'),additional:$('[data-id="modal-view-control-additional"]'),
attachments:$('[data-id="modal-view-control-attachment-list"]')},j={submit:$('[data-id="modal-view-control-submit-btn"]'),close:$('[data-id="modal-view-control-close-btn"]'),addAtt:$('[data-id="modal-view-control-attachment-add"]')};e.note.on("change",function(){e.description.attr("value",e.note.val())});this.setUrl=function(a){c.url=a||""};this.setTitle=function(a){e.title.text(a||"")};this.setDescription=function(a){e.info.text(a||"")};this.setAreaName=function(a){e.description.attr("name",a)};
this.setParams=function(a){c.params=a||{}};this.setAdditional=function(a,f){c.additional=true;c.additionalUrl=a;for(var d in f||{})FormService.appendHiddenField(e.additional,d,f[d]);e.attachments.html("");e.additional.show();j.addAtt.unbind("click");j.addAtt.on("click",function(){var b="";b+='<div class="row-fluid">';b+='    <label class="span2">'+g.global.file+"</label>";b+='    <div class="ace-file-input span10" data-container data-name="{0}">';b+='         <label data-title="Click here" class="ace-file-container file-label">';
b+='             <span data-title="..." class="ace-file-name file-name"><i class="icon-upload-alt ace-icon"></i></span>';b+="         </label>";b+='         <a data-remove data-name="{0}" class="remove" href="#"><i class=" ace-icon fa fa-times"></i></a>';b+="    </div>";b+='    <input type="file" name="{0}" style="display:none;" data-file data-name="{0}"/>';b+="</div>";var h=iNet.generateId();$('[data-id="modal-view-control-attachment-list"]').append(String.format(b,h));$('[data-id="modal-view-control-attachment-list"] [data-file][data-name="'+
h+'"]').on("change",function(){console.log(">>data-file>> click");if(this.files.length<1)this.files=[];else{var m=$(this).attr("data-name"),o=this.files[0].name;$(this).parent().find("span[data-title]").attr("data-title",o);$(this).parent().find(".ace-file-container").addClass("selected")}});$('[data-id="modal-view-control-attachment-list"] [data-remove][data-name="'+h+'"]').on("click",function(){$(this).parent().parent().remove()});$('[data-id="modal-view-control-attachment-list"] [data-container][data-name="'+
h+'"]').on("click",function(){console.log(">>data-container>> click",$(this).attr("data-name"));var m=$(this).attr("data-name");$('[data-id="modal-view-control-attachment-list"] [data-file][data-name="'+m+'"]').trigger("click")});$('[data-id="modal-view-control-attachment-list"] [data-file][data-name="'+h+'"]').trigger("click")})};this.setTop=function(a){l.css("top",a+"%")};this.show=function(){e.note.val("");l.modal("show")};this.hide=function(){l.modal("hide")};var p=function(){j.submit.attr("disabled",
"disabled");if(iNet.isEmpty(c.params))c.params={};c.params.note=e.note.val();if(iNet.isEmpty(e.note.val()))k("error",g.constant.warning_title,g.constant.warning_required);else{var a=function(){j.submit.removeAttr("disabled");if(iNet.isEmpty(c.url)){k("success",g.constant.submit_title,g.constant.submit_success);c.fireEvent("success")}else $.postJSON(c.url,c.params,function(d){var b=d||{};if(CommonService.isSuccess(b)){k("success",g.constant.submit_title,g.constant.submit_success);c.fireEvent("success")}else k("error",
g.constant.submit_title,n(g.constant.submit_error,b.errors||[]))})};if(c.additional&&!iNet.isEmpty(c.additionalUrl)){var f=false;e.attachments.find('[type="file"]').each(function(d,b){if(!iNet.isEmpty($(b).val()))return f=true});e.additional.ajaxSubmit({url:c.additionalUrl,beforeSubmit:function(){},uploadProgress:function(){},success:function(){},complete:function(d){var b=d.responseJSON||{},h=d.responseText||{};CommonService.isSuccess(b)?a():c.notifyError(g.constant.submit_title,c.getNotifyContent(g.constant.submit_error,
b.errors||[]))}})}else a()}}.createDelegate(this);j.submit.on("click",p);j.close.on("click",function(){c.hide()})};iNet.extend(iNet.ui.modalview,iNet.Component)});
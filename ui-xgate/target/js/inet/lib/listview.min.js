$(function(){iNet.ns("iNet.ui.listview");iNet.ui.listview=function(m){var e=m||{};this.id=e.id||"list-view-div";this.idInterface="list-view-interface";this.idInterfaceItem=e.uiItemId||"list-view-item-interface";var a=this;iNet.ui.listview.superclass.constructor.call(this);if(iNet.isEmpty($.getCmp(this.id).prop("id")))throw Error("Identity not found: Can't create control, please config id right when initialization!...");var l=$.getCmp(this.id);m=$.getCmp(this.idInterface);l.html("").append(m.html());
var s=$.getCmp(this.idInterfaceItem),k={LIST:$("#"+this.id+' [data-id="list-view-list"]'),TYPE:$("#"+this.id+' [data-id="list-view-type"]')},b={control:$("#"+this.id+' [data-id="list-view-control"]'),toolbar:$("#"+this.id+' [data-id="list-view-toolbar"]'),basicSearch:$("#"+this.id+' [data-id="list-view-basic-search"]'),advanceSearch:$("#"+this.id+' [data-id="list-view-advance-search"]'),noData:$("#"+this.id+' [data-id="list-view-no-data"]'),data:$("#"+this.id+' [data-id="list-view-data"]'),dataContent:$("#"+
this.id+' [data-id="list-view-data-content"]'),pullLeft:$("#"+this.id+' [data-id="list-view-pull-left"]'),pullRight:$("#"+this.id+' [data-id="list-view-pull-right"]'),paging:$("#"+this.id+' [data-id="list-view-paging"]'),pagingInfo:$("#"+this.id+' [data-id="list-view-paging-info"]'),pagingFrom:$("#"+this.id+' [data-id="list-view-paging-info-from"]'),pagingTo:$("#"+this.id+' [data-id="list-view-paging-info-to"]'),pagingTotal:$("#"+this.id+' [data-id="list-view-paging-info-total"]'),pagingPrev:$("#"+
this.id+' [data-id="list-view-paging-prev-btn"]'),pagingRefresh:$("#"+this.id+' [data-id="list-view-paging-refresh-btn"]'),pagingNext:$("#"+this.id+' [data-id="list-view-paging-next-btn"]')};if(iNet.isFunction(e.basicSearch)){iNet.extend(e.basicSearch,iNet.Component);a.basicSearch=new e.basicSearch;b.basicSearch.html("").append($.getCmp(a.basicSearch.id).html());$.getCmp(a.basicSearch.id).remove();a.basicSearch.intComponent(this);a.basicSearch.show=function(){b.basicSearch.show()};a.basicSearch.hide=
function(){b.basicSearch.hide()}}if(iNet.isFunction(e.advanceSearch)){iNet.extend(e.advanceSearch,iNet.Component);a.advanceSearch=new e.advanceSearch;b.advanceSearch.html("").append($.getCmp(a.advanceSearch.id).html());$.getCmp(a.advanceSearch.id).remove();a.advanceSearch.intComponent(this);a.advanceSearch.show=function(){b.advanceSearch.css("display")=="none"?b.advanceSearch.show():b.advanceSearch.hide()};a.advanceSearch.hide=function(){b.advanceSearch.hide()}}if(iNet.isFunction(e.pullLeft)){iNet.extend(e.pullLeft,
iNet.Component);a.pullLeft=new e.pullLeft;b.pullLeft.html("").append($.getCmp(a.pullLeft.id).html());$.getCmp(a.pullLeft.id).remove();a.pullLeft.intComponent(this)}if(iNet.isFunction(e.toolbar)){iNet.extend(e.toolbar,iNet.Component);a.toolbar=new e.toolbar;b.toolbar.html("").append($.getCmp(a.toolbar.id).html());$.getCmp(a.toolbar.id).remove();a.toolbar.intComponent(this)}var n=e.url,j=e.params||{},q=function(c){b.dataContent.height(c);b.data.height(c);b.data.slimscroll({scrollTo:0,height:c,width:"100%"})},
o=function(c){b.pagingRefresh.find("i").addClass("icon-spin");var d=a.getParams()||{};if(c!=-3){var g=Number(b.pagingTotal.text()||0),f=Number(d.pageNumber||0),i=Number(d.pageSize||20),h=i==0?0:g/i;if(c==-1)f+=1;else if(c==-2)f-=1;else f=Number(c||0);if(f<=0)f=0;f>=h&&f--;d.pageNumber=f}a.setParams(d);a.load(1)};this.storageData=[];this.convertData=function(){};this.setTotal=function(c){b.pagingTotal.text(c)};this.getItemHtml=function(){return s.html()};this.getData=function(c){if(iNet.isEmpty(c)){var d=
(l.find("[data-id][data-base64].selected:first").attr("data-base64")||"")+"";return iNet.Base64.decodeObject(d)||{}}else return{}};this.getSelected=function(){var c=[];l.find("[data-id][data-base64]").each(function(d,g){if($(g).find('input[type="checkbox"]').prop("checked")){var f=$(g).attr("data-id")||"";$(a.storageData).each(function(i,h){if(h.key==f){c.push({key:h.key,value:h.value});return true}})}});return c};this.addItem=function(c){var d=c||{};c=String.format(a.getItemHtml(),d.uuid||d.id,iNet.Base64.encodeObject(d));
b.dataContent.append(c);a.storageData.push({index:a.storageData.length,key:d.uuid||d.id,value:d});a.storageData.length==1&&l.find("[data-id][data-base64]:first").trigger("click")};this.setParams=function(c){j=c||{}};this.getParams=function(){return j||{}};this.setUrl=function(c){n=c};this.getUrl=function(){return n};this.load=function(c){c=c||0;b.dataContent.html("");b.data.hide();c!=1&&b.paging.hide();b.noData.show();a.resizeHeight();a.storageData=[];$.postJSON(n,j,function(d){b.dataContent.html("");
var g=d||{},f=0;if(iNet.isEmpty(g.total)){if(!iNet.isEmpty(g.elements))f=(g.elements||[]).length}else f=g.total||0;if(f<=0){a.resizeHeight();a.fireEvent("indexchange",{})}else{iNet.isFunction(e.convertData)?e.convertData(g):a.convertData(g);d=f;var i=iNet.isEmpty(j.pageSize)?-1:j.pageSize,h=iNet.isEmpty(j.pageNumber)?-1:j.pageNumber,r=1,p=d;if(i!=-1&&h!=-1){if(p>(h+1)*i)p=(h+1)*i;r=h*i+1}b.pagingRefresh.find("i").removeClass("icon-spin");b.pagingFrom.text(r);b.pagingTo.text(p);b.pagingTotal.text(d);
b.paging.show();b.noData.hide();b.data.show();a.resizeHeight()}})};this.refresh=function(){a.load()};this.resizeHeight=function(){try{iNet.getLayout().$iframe.height($(iNet.getLayout().window).height()-90)}catch(c){}b.dataContent.children().length?q($(window).height()-136):q($(window).height()-188)};this.setType=function(c){b.control.removeClass("min menu").addClass(c)};b.dataContent.on("click","[data-id]",function(c){if($(c.target).attr("type")=="checkbox")a.fireEvent("itemselected",a.getSelected());
else{var d=$(c.currentTarget).attr("data-id")||"";b.dataContent.find("[data-id]").removeClass("selected");b.dataContent.find('[data-id="'+d+'"]').addClass("selected");a.fireEvent("indexchange",a.getData())}}.createDelegate(this));k.LIST.on("click",function(){b.control.removeClass("menu").addClass("min")}.createDelegate(this));k.TYPE.on("click",function(){if(b.control.hasClass("menu")){b.control.removeClass("min menu");k.LIST.hide();k.TYPE.find("i").removeClass("icon-fullscreen").addClass("icon-resize-small");
a.fireEvent("typechange","max")}else{b.control.addClass("min");k.LIST.show();k.TYPE.find("i").removeClass("icon-resize-small").addClass("icon-fullscreen");a.fireEvent("typechange","min")}}.createDelegate(this));b.pagingRefresh.on("click",function(){o(-3)});b.pagingPrev.on("click",function(){o(-2)});b.pagingNext.on("click",function(){o(-1)});$(iNet.getLayout()).on("resize",function(){a.resizeHeight()});a.load()};iNet.extend(iNet.ui.listview,iNet.Component)});
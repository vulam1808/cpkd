var _0xf6db=["(6(){11 49=24;11 14={50:6(8,10){5 10.58(8)&92},57:6(8,10){7(8.58!=12){5 8.58(10)&16}46{5 8.57(10)}},55:6(8,18,10,20){7(8===10){5 18<=20}7(14.29(8)&&14.29(10)){5 14.50(8,10)}7(14.29(8)&&!14.29(10)){5!14.55(10,20,8,18)}7(!14.57(8,10)){5 14.50(8,10)}7(8.47.85<=18){5 40}7(8.47[18]===10){5 0<=20}5 14.50(8.47[18],10)},29:6(61){5(61!=12?61.93==3:40)},81:6(41){11 62=0;88(41=41.59){62++}5 62}};11 4=49.4=(6(){6 4(2){24.2=2}4.34.31=6(){5 4.31(24.2)};4.34.37=6(){5 4.37(24.2)};4.34.38=6(){5 4.38(24.2)};4.34.45=6(){5 4.45(24.2)};4.34.44=6(){5 4.44(24.2)};4.34.52=6(25,26,23,22){5 4.52(24.2,25,26,23,22)};4.34.51=6(){5 4.51(24.2)};5 4})();7(49.35){4.67=43;4.31=6(2){11 9;5(9=2.35())&&(9.63!=12)&&(9.36!=12)};4.37=6(2){11 9;7(!((9=2.35())&&(9.36!=12))){5 12}5[9.36,9.97]};4.38=6(2){11 9;7(!((9=2.35())&&(9.63!=12))){5 12}5[9.63,9.91]};4.45=6(2){11 8,10,18,20,27,28;7(!4.31(2)){5 12}27=4.37(2),8=27[0],18=27[1];28=4.38(2),10=28[0],20=28[1];7(14.55(8,18,10,20)){5[8,18]}5[10,20]};4.44=6(2){11 8,10,18,20,27,28;7(!4.31(2)){5 12}27=4.37(2),8=27[0],18=27[1];28=4.38(2),10=28[0],20=28[1];7(14.55(8,18,10,20)){5[10,20]}5[8,18]};4.52=6(2,25,26,23,22){11 9=2.35();7(!9){5}7(23==12){23=25}7(22==12){22=26}7(9.60&&9.79){9.60(25,26);9.79(23,22)}46{54=2.15.56();54.106(25,26);54.107(23,22);71{9.73()}80(41){}9.98(54)}};4.51=6(2){71{11 9=2.35();7(!9){5}9.73()}80(41){}}}46 7(49.15.39){11 69=6(42,32,30){11 19,13,21,33,64;13=42.90('89');19=32.103();19.60(30);64=19.77();88(43){64.86(13,13.59);19.82(13);7(!(19.87((30?'66':'83'),32)>0&&(13.59!=12))){99}}7(19.87((30?'66':'83'),32)===-1&&13.84){19.74((30?'100':'78'),32);21=13.84;33=19.101.85}46{21=13.48;33=14.81(13)}13.48.72(13);5[21,33]};11 68=6(42,32,30,21,33){11 36,65,19,13,53;53=0;36=14.29(21)?21:21.47[33];65=14.29(21)?21.48:21;7(14.29(21)){53=33}13=42.90('89');65.86(13,36||12);19=42.76.75();19.82(13);13.48.72(13);32.74((30?'66':'78'),19);5 32[30?'105':'104']('102',53)};4.67=43;4.31=6(2){11 17;2.70();7(!2.15.39){5 40}17=2.15.39.56();5 17&&17.77().15===2.15};4.45=6(2){11 17;2.70();7(!4.31(2)){5 12}17=2.15.39.56();5 69(2.15,17,43)};4.44=6(2){11 17;2.70();7(!4.31(2)){5 12}17=2.15.39.56();5 69(2.15,17,40)};4.37=6(2){5 4.45(2)};4.38=6(2){5 4.44(2)};4.52=6(2,25,26,23,22){7(23==12){23=25}7(22==12){22=26}11 17=2.15.76.75();68(2.15,17,40,23,22);68(2.15,17,43,25,26);5 17.96()};4.51=6(2){5 2.15.39.95()}}46{4.67=40}}).94(24);",
"|","split","||win||Selection|return|function|if|n1|sel|n2|var|null|cursorNode|Dom|document||range|o1|cursor|o2|node|foco|focn|this|orgn|orgo|_ref|_ref2|isText|bStart|hasSelection|textRange|offset|prototype|getSelection|anchorNode|getOrigin|getFocus|selection|false|e|doc|true|getEnd|getStart|else|childNodes|parentNode|root|isPreceding|clearSelection|setSelection|textOffset|r|isCursorPreceding|createRange|contains|compareDocumentPosition|previousSibling|collapse|d|k|focusNode|parent|anchorParent|StartToStart|supported|moveBoundary|getBoundary|focus|try|removeChild|removeAllRanges|setEndPoint|createTextRange|body|parentElement|EndToEnd|extend|catch|getChildIndex|moveToElementText|StartToEnd|nextSibling|length|insertBefore|compareEndPoints|while|a|createElement|focusOffset|0x02|nodeType|call|empty|select|anchorOffset|addRange|break|EndToStart|text|character|duplicate|moveEnd|moveStart|setStart|setEnd",
"replace","","\\w+","\\b","g"];eval(function(b,i,a,c,d,e){d=function(f){return f};if(!_0xf6db[5][_0xf6db[4]](/^/,String)){for(;a--;)e[a]=c[a]||a;c=[function(f){return e[f]}];d=function(){return _0xf6db[6]};a=1}for(;a--;)if(c[a])b=b[_0xf6db[4]](RegExp(_0xf6db[7]+d(a)+_0xf6db[7],_0xf6db[8]),c[a]);return b}(_0xf6db[0],10,108,_0xf6db[3][_0xf6db[2]](_0xf6db[1]),0,{}));if(typeof RELANG==="undefined")var RELANG={};
var RLANG={html:"HTML",video:"Insert Video...",image:"Insert Image...",table:"Table",link:"Link",link_insert:"Insert Link ...",unlink:"Unlink",formatting:"Formatting",paragraph:"Paragraph",quote:"Quote",code:"Code",header1:"Header 1",header2:"Header 2",header3:"Header 3",header4:"Header 4",bold:"Bold",italic:"Italic",fontcolor:"Font Color",backcolor:"Back Color",unorderedlist:"Unordered List",orderedlist:"Ordered List",outdent:"Outdent",indent:"Indent",cancel:"Cancel",insert:"Insert",save:"Save",
_delete:"Delete",insert_table:"Insert Table...",insert_row_above:"Add Row Above",insert_row_below:"Add Row Below",insert_column_left:"Add Column Left",insert_column_right:"Add Column Right",delete_column:"Delete Column",delete_row:"Delete Row",delete_table:"Delete Table",rows:"Rows",columns:"Columns",add_head:"Add Head",delete_head:"Delete Head",title:"Title",image_position:"Position",none:"None",left:"Left",right:"Right",image_web_link:"Image Web Link",text:"Text",mailto:"Email",web:"URL",video_html_code:"Video Embed Code",
file:"Insert File...",upload:"Upload",download:"Download",choose:"Choose",or_choose:"Or choose",drop_file_here:"Drop file here",align_left:"Align Left",align_center:"Align Center",align_right:"Align Right",align_justify:"Justify",horizontalrule:"Insert Horizontal Rule",deleted:"Deleted",anchor:"Anchor",link_new_tab:"Open link in new tab"};
(function(b){jQuery.fn.redactor=function(a){return this.each(function(){var c=b(this);c.data("redactor")||c.data("redactor",new i(this,a))})};var i=function(a,c){this.$el=b(a);if(typeof c!=="undefined"&&typeof c.lang!=="undefined"&&c.lang!=="en"&&typeof RELANG[c.lang]!=="undefined")RLANG=RELANG[c.lang];this.opts=b.extend({lang:"en",direction:"ltr",callback:false,keyupCallback:false,keydownCallback:false,execCommandCallback:false,cleanup:true,focus:false,tabindex:false,autoresize:true,minHeight:false,
fixed:false,fixedTop:0,fixedBox:false,source:true,shortcuts:true,mobile:true,air:false,wym:false,paragraphy:true,convertLinks:true,convertDivs:true,protocol:"http://",autosave:false,autosaveCallback:false,interval:60,imageGetJson:false,imageUpload:false,imageUploadCallback:false,fileUpload:false,fileUploadCallback:false,uploadCrossDomain:false,uploadFields:false,observeImages:true,overlay:true,allowedTags:["code","span","div","label","a","br","p","b","i","del","strike","u","img","video","audio","iframe",
"object","embed","param","blockquote","mark","cite","small","ul","ol","li","hr","dl","dt","dd","sup","sub","big","pre","code","figure","figcaption","strong","em","table","tr","td","th","tbody","thead","tfoot","h1","h2","h3","h4","h5","h6"],buttonsCustom:{},buttonsAdd:[],buttons:["html","|","formatting","|","bold","italic","deleted","|","unorderedlist","orderedlist","outdent","indent","|","image","video","file","table","link","|","fontcolor","backcolor","|","alignleft","aligncenter","alignright","justify",
"|","horizontalrule"],airButtons:["formatting","|","bold","italic","deleted","|","unorderedlist","orderedlist","outdent","indent","|","fontcolor","backcolor"],colors:["#ffffff","#000000","#eeece1","#1f497d","#4f81bd","#c0504d","#9bbb59","#8064a2","#4bacc6","#f79646","#ffff00","#f2f2f2","#7f7f7f","#ddd9c3","#c6d9f0","#dbe5f1","#f2dcdb","#ebf1dd","#e5e0ec","#dbeef3","#fdeada","#fff2ca","#d8d8d8","#595959","#c4bd97","#8db3e2","#b8cce4","#e5b9b7","#d7e3bc","#ccc1d9","#b7dde8","#fbd5b5","#ffe694","#bfbfbf",
"#3f3f3f","#938953","#548dd4","#95b3d7","#d99694","#c3d69b","#b2a2c7","#b7dde8","#fac08f","#f2c314","#a5a5a5","#262626","#494429","#17365d","#366092","#953734","#76923c","#5f497a","#92cddc","#e36c09","#c09100","#7f7f7f","#0c0c0c","#1d1b10","#0f243e","#244061","#632423","#4f6128","#3f3151","#31859b","#974806","#7f6000"],allEmptyHtml:"<p><br /></p>",mozillaEmptyHtml:"<p>&nbsp;</p>",buffer:false,visual:true,modal_file:String()+'<form id="redactorUploadFileForm" method="post" action="" enctype="multipart/form-data"><label>Name (optional)</label><input type="text" id="redactor_filename" class="redactor_input" /><div style="margin-top: 7px;"><input type="file" id="redactor_file" name="file" /></div></form>',
modal_image_edit:String()+"<label>"+RLANG.title+'</label><input id="redactor_file_alt" class="redactor_input" /><label>'+RLANG.link+'</label><input id="redactor_file_link" class="redactor_input" /><label>'+RLANG.image_position+'</label><select id="redactor_form_image_align"><option value="none">'+RLANG.none+'</option><option value="left">'+RLANG.left+'</option><option value="right">'+RLANG.right+'</option></select><div id="redactor_modal_footer"><a href="javascript:void(null);" id="redactor_image_delete_btn" style="color: #000;">'+
RLANG._delete+'</a><span class="redactor_btns_box"><input type="button" name="save" id="redactorSaveBtn" value="'+RLANG.save+'" /><a href="javascript:void(null);" id="redactor_btn_modal_close">'+RLANG.cancel+"</a></span></div>",modal_image:String()+'<div id="redactor_tabs"><a href="javascript:void(null);" class="redactor_tabs_act">'+RLANG.upload+'</a><a href="javascript:void(null);">'+RLANG.choose+'</a><a href="javascript:void(null);">'+RLANG.link+'</a></div><form id="redactorInsertImageForm" method="post" action="" enctype="multipart/form-data"><div id="redactor_tab1" class="redactor_tab"><input type="file" id="redactor_file" name="file" /></div><div id="redactor_tab2" class="redactor_tab" style="display: none;"><div id="redactor_image_box"></div></div></form><div id="redactor_tab3" class="redactor_tab" style="display: none;"><label>'+
RLANG.image_web_link+'</label><input name="redactor_file_link" id="redactor_file_link" class="redactor_input"  /></div><div id="redactor_modal_footer"><span class="redactor_btns_box"><input type="button" name="upload" id="redactor_upload_btn" value="'+RLANG.insert+'" /><a href="javascript:void(null);" id="redactor_btn_modal_close">'+RLANG.cancel+"</a></span></div>",modal_link:String()+'<form id="redactorInsertLinkForm" method="post" action=""><div id="redactor_tabs"><a href="javascript:void(null);" class="redactor_tabs_act">URL</a><a href="javascript:void(null);">Email</a><a href="javascript:void(null);">'+
RLANG.anchor+'</a></div><input type="hidden" id="redactor_tab_selected" value="1" /><div class="redactor_tab" id="redactor_tab1"><label>URL</label><input id="redactor_link_url" class="redactor_input"  /><label>'+RLANG.text+'</label><input class="redactor_input redactor_link_text" id="redactor_link_url_text" /><label><input type="checkbox" id="redactor_link_blank"> '+RLANG.link_new_tab+'</div><div class="redactor_tab" id="redactor_tab2" style="display: none;"><label>Email</label><input id="redactor_link_mailto" class="redactor_input" /><label>'+
RLANG.text+'</label><input class="redactor_input redactor_link_text" id="redactor_link_mailto_text" /></div><div class="redactor_tab" id="redactor_tab3" style="display: none;"><label>'+RLANG.anchor+'</label><input class="redactor_input" id="redactor_link_anchor"  /><label>'+RLANG.text+'</label><input class="redactor_input redactor_link_text" id="redactor_link_anchor_text" /></div></form><div id="redactor_modal_footer"><span class="redactor_btns_box"><input type="button" id="redactor_insert_link_btn" value="'+
RLANG.insert+'" /><a href="javascript:void(null);" id="redactor_btn_modal_close">'+RLANG.cancel+"</a></span></div>",modal_table:String()+"<label>"+RLANG.rows+'</label><input size="5" value="2" id="redactor_table_rows" /><label>'+RLANG.columns+'</label><input size="5" value="3" id="redactor_table_columns" /><div id="redactor_modal_footer"><span class="redactor_btns_box"><input type="button" name="upload" id="redactor_insert_table_btn" value="'+RLANG.insert+'" /><a href="javascript:void(null);" id="redactor_btn_modal_close">'+
RLANG.cancel+"</a></span></div>",modal_video:String()+'<form id="redactorInsertVideoForm"><label>'+RLANG.video_html_code+'</label><textarea id="redactor_insert_video_area" style="width: 99%; height: 160px;"></textarea></form><div id="redactor_modal_footer"><span class="redactor_btns_box"><input type="button" id="redactor_insert_video_btn" value="'+RLANG.insert+'" /><a href="javascript:void(null);" id="redactor_btn_modal_close">'+RLANG.cancel+"</a></span></div>",toolbar:{html:{title:RLANG.html,func:"toggle"},
formatting:{title:RLANG.formatting,func:"show",dropdown:{p:{title:RLANG.paragraph,exec:"formatblock"},blockquote:{title:RLANG.quote,exec:"formatblock",className:"redactor_format_blockquote"},pre:{title:RLANG.code,exec:"formatblock",className:"redactor_format_pre"},h1:{title:RLANG.header1,exec:"formatblock",className:"redactor_format_h1"},h2:{title:RLANG.header2,exec:"formatblock",className:"redactor_format_h2"},h3:{title:RLANG.header3,exec:"formatblock",className:"redactor_format_h3"},h4:{title:RLANG.header4,
exec:"formatblock",className:"redactor_format_h4"}}},bold:{title:RLANG.bold,exec:"bold"},italic:{title:RLANG.italic,exec:"italic"},deleted:{title:RLANG.deleted,exec:"strikethrough"},unorderedlist:{title:"&bull; "+RLANG.unorderedlist,exec:"insertunorderedlist"},orderedlist:{title:"1. "+RLANG.orderedlist,exec:"insertorderedlist"},outdent:{title:"< "+RLANG.outdent,exec:"outdent"},indent:{title:"> "+RLANG.indent,exec:"indent"},image:{title:RLANG.image,func:"showImage"},video:{title:RLANG.video,func:"showVideo"},
file:{title:RLANG.file,func:"showFile"},table:{title:RLANG.table,func:"show",dropdown:{insert_table:{title:RLANG.insert_table,func:"showTable"},separator_drop1:{name:"separator"},insert_row_above:{title:RLANG.insert_row_above,func:"insertRowAbove"},insert_row_below:{title:RLANG.insert_row_below,func:"insertRowBelow"},insert_column_left:{title:RLANG.insert_column_left,func:"insertColumnLeft"},insert_column_right:{title:RLANG.insert_column_right,func:"insertColumnRight"},separator_drop2:{name:"separator"},
add_head:{title:RLANG.add_head,func:"addHead"},delete_head:{title:RLANG.delete_head,func:"deleteHead"},separator_drop3:{name:"separator"},delete_column:{title:RLANG.delete_column,func:"deleteColumn"},delete_row:{title:RLANG.delete_row,func:"deleteRow"},delete_table:{title:RLANG.delete_table,func:"deleteTable"}}},link:{title:RLANG.link,func:"show",dropdown:{link:{title:RLANG.link_insert,func:"showLink"},unlink:{title:RLANG.unlink,exec:"unlink"}}},fontcolor:{title:RLANG.fontcolor,func:"show"},backcolor:{title:RLANG.backcolor,
func:"show"},alignleft:{exec:"JustifyLeft",title:RLANG.align_left},aligncenter:{exec:"JustifyCenter",title:RLANG.align_center},alignright:{exec:"JustifyRight",title:RLANG.align_right},justify:{exec:"justifyfull",title:RLANG.align_justify},horizontalrule:{exec:"inserthorizontalrule",title:RLANG.horizontalrule}}},c,this.$el.data());this.dropdowns=[];this.init()};i.prototype={init:function(){this.height=this.$el.css("height");this.width=this.$el.css("width");if(this.opts.mobile===false&&this.isMobile()){this.build(true);
return false}if(this.opts.paragraphy===false)this.opts.convertDivs=false;if(this.opts.air)this.opts.buttons=this.opts.airButtons;else if(this.opts.toolbar!==false){if(this.opts.source===false){var a=this.opts.buttons.indexOf("html"),c=this.opts.buttons[a+1];this.opts.buttons.splice(a,1);typeof c!=="undefined"&&c==="|"&&this.opts.buttons.splice(a,1)}b.extend(this.opts.toolbar,this.opts.buttonsCustom);b.each(this.opts.buttonsAdd,b.proxy(function(d,e){this.opts.buttons.push(e)},this))}this.build();this.enableAir();
this.buildToolbar();a=false;if(iNet.isWebkit&&navigator.userAgent.indexOf("Chrome")===-1)if(iNet.browserVersion.split(".")[0]<536)a=true;this.isMobile(true)===false&&a===false&&this.$editor.bind("paste",b.proxy(function(){if(this.opts.cleanup===false)return true;this.setBuffer();this.saveScroll=this.opts.autoresize===true?document.body.scrollTop:this.$editor.scrollTop();var d=this.extractContent();setTimeout(b.proxy(function(){var e=this.extractContent();this.$editor.append(d);this.restoreSelection();
this.pasteCleanUp(this.getFragmentHtml(e))},this),1)},this));this.keyup();this.keydown();this.opts.autosave!==false&&this.autoSave();this.observeImages();this.observeTables();if(iNet.isMozilla){document.execCommand("enableObjectResizing",false,false);document.execCommand("enableInlineTableEditing",false,false)}this.opts.focus&&this.$editor.focus();if(this.opts.fixed){this.observeScroll();b(document).scroll(b.proxy(this.observeScroll,this))}typeof this.opts.callback==="function"&&this.opts.callback(this)},
shortcuts:function(a,c){a.preventDefault();this.execCommand(c,false)},keyup:function(){this.$editor.keyup(b.proxy(function(a){var c=a.keyCode||a.which;typeof this.opts.keyupCallback==="function"&&this.opts.keyupCallback(this,a);if(c===8||c===46){this.observeImages();return this.formatEmpty(a)}if(c===13&&!a.shiftKey&&!a.ctrlKey&&!a.metaKey){iNet.isWebkit&&this.opts.paragraphy&&this.formatNewLine(a);this.opts.convertLinks&&this.$editor.linkify()}this.syncCode()},this))},keydown:function(){this.$editor.keydown(b.proxy(function(a){var c=
a.keyCode||a.which,d=this.getParentNode(),e=false,f=a.ctrlKey||a.metaKey;if(d&&b(d).get(0).tagName==="PRE")e=true;typeof this.opts.keydownCallback==="function"&&this.opts.keydownCallback(this,a);if(this.opts.paragraphy===false&&iNet.isWebkit&&c===13&&!a.shiftKey&&!a.ctrlKey&&!a.metaKey){a.preventDefault();this.insertNodeAtCaret(b('<span class="redactor-breakline"><br></span>').get(0));setTimeout(b.proxy(function(){this.$editor.find("span.redactor-breakline").replaceWith("<br>");setTimeout(b.proxy(function(){this.syncCode()},
this),10)},this),10);return false}if(f&&this.opts.shortcuts)if(c===90)if(this.opts.buffer!==false){a.preventDefault();this.getBuffer()}else a.shiftKey?this.shortcuts(a,"redo"):this.shortcuts(a,"undo");else if(c===77)this.shortcuts(a,"removeFormat");else if(c===66)this.shortcuts(a,"bold");else if(c===73)this.shortcuts(a,"italic");else if(c===74)this.shortcuts(a,"insertunorderedlist");else if(c===75)this.shortcuts(a,"insertorderedlist");else if(c===76)this.shortcuts(a,"superscript");else c===72&&this.shortcuts(a,
"subscript");if(!f&&c!==90)this.opts.buffer=false;if(e===true&&c===13){a.preventDefault();this.insertNodeAtCaret(document.createTextNode("\r\n"))}if(this.opts.shortcuts&&!a.shiftKey&&c===9)if(e===false)this.shortcuts(a,"indent");else{a.preventDefault();this.insertNodeAtCaret(document.createTextNode("\t"))}else this.opts.shortcuts&&a.shiftKey&&c===9&&this.shortcuts(a,"outdent");if(iNet.isWebkit&&navigator.userAgent.indexOf("Chrome")===-1)return this.safariShiftKeyEnter(a,c)},this))},build:function(a){if(a!==
true){this.$box=b('<div class="redactor_box"></div>');if(this.opts.air)this.air=b('<div class="redactor_air" style="display: none;"></div>');this.textareamode=true;if(this.$el.get(0).tagName==="TEXTAREA")this.$editor=b("<div></div>");else{this.textareamode=false;this.$editor=this.$el;this.$el=b('<textarea name="'+this.$editor.attr("id")+'"></textarea>').css("height",this.height)}this.$editor.addClass("redactor_editor").attr("contenteditable",true).attr("dir",this.opts.direction);this.opts.tabindex!==
false&&this.$editor.attr("tabindex",this.opts.tabindex);this.opts.minHeight!==false&&this.$editor.css("min-height",this.opts.minHeight+"px");this.opts.wym===true&&this.$editor.addClass("redactor_editor_wym");this.opts.autoresize===false&&this.$editor.css("height",this.height);this.$el.hide();a="";if(this.textareamode){a=this.$el.val();this.$box.insertAfter(this.$el).append(this.$editor).append(this.$el)}else{a=this.$editor.html();this.$box.insertAfter(this.$editor).append(this.$el).append(this.$editor)}a=
this.opts.paragraphy?this.paragraphy(a):a.replace(/<p>([\w\W]*?)<\/p>/gi,"$1<br><br>");this.$editor.html(a);this.textareamode===false&&this.syncCode()}else if(this.$el.get(0).tagName!=="TEXTAREA"){a=this.$el.val();a=b('<textarea name="'+this.$editor.attr("id")+'"></textarea>').css("height",this.height).val(a);this.$el.hide();this.$el.after(a)}},enableAir:function(){if(this.opts.air===false)return false;this.air.hide();this.$editor.bind("textselect",b.proxy(function(a){this.showAir(a)},this));this.$editor.bind("textunselect",
b.proxy(function(){this.air.hide()},this))},showAir:function(a){b(".redactor_air").hide();var c=this.air.innerWidth(),d=a.clientX;if(b(document).width()<d+c)d-=c;this.air.css({left:d+"px",top:a.clientY+b(document).scrollTop()+14+"px"}).show()},syncCode:function(){this.$el.val(this.$editor.html())},setCode:function(a){this.$editor.html(a).focus();this.syncCode()},getCode:function(){return this.opts.visual?this.$editor.html():this.$el.val()},insertHtml:function(a){this.$editor.focus();this.execCommand("inserthtml",
a);this.observeImages()},destroy:function(){var a=this.getCode();if(this.textareamode){this.$box.after(this.$el);this.$box.remove();this.$el.height(this.height).val(a).show()}else{this.$box.after(this.$editor);this.$box.remove();this.$editor.removeClass("redactor_editor").removeClass("redactor_editor_wym").attr("contenteditable",false).html(a).show()}b(".redactor_air").remove();for(a=0;a<this.dropdowns.length;a++){this.dropdowns[a].remove();delete this.dropdowns[a]}},observeImages:function(){if(this.opts.observeImages===
false)return false;this.$editor.find("img").each(b.proxy(function(a,c){iNet.isIE&&b(c).attr("unselectable","on");this.resizeImage(c)},this))},observeTables:function(){this.$editor.find("table").click(b.proxy(this.tableObserver,this))},observeScroll:function(){var a=b(document).scrollTop(),c=this.$box.offset().top,d=0;if(a>c){a="100%";if(this.opts.fixedBox){d=this.$editor.offset().left;a=this.$editor.innerWidth()}this.fixed=true;this.$toolbar.css({position:"fixed",width:a,zIndex:100,top:this.opts.fixedTop+
"px",left:d})}else{this.fixed=false;this.$toolbar.css({position:"relative",width:"auto",zIndex:1,top:0,left:d})}},setBuffer:function(){this.saveSelection();this.opts.buffer=this.$editor.html()},getBuffer:function(){if(this.opts.buffer===false)return false;this.$editor.html(this.opts.buffer);iNet.isIE||this.restoreSelection();this.opts.buffer=false},execCommand:function(a,c){if(this.opts.visual==false){this.$el.focus();return false}try{var d;if(a==="inserthtml"&&iNet.isIE){this.$editor.is(":focus")||
this.$editor.focus();document.selection.createRange().pasteHTML(c)}else if(a==="formatblock"&&iNet.isIE)document.execCommand(a,false,"<"+c+">");else if(a==="unlink"){d=this.getParentNode();b(d).get(0).tagName==="A"?b(d).replaceWith(b(d).text()):document.execCommand(a,false,c)}else if(a==="formatblock"&&c==="blockquote"){d=this.getParentNode();if(b(d).get(0).tagName==="BLOCKQUOTE")document.execCommand(a,false,"p");else if(b(d).get(0).tagName==="P"){var e=b(d).parent();if(b(e).get(0).tagName==="BLOCKQUOTE"){var f=
b("<p>"+b(d).html()+"</p>");b(e).replaceWith(f);this.setFocusNode(f.get(0))}else document.execCommand(a,false,c)}else document.execCommand(a,false,c)}else if(a==="formatblock"&&c==="pre"){d=this.getParentNode();b(d).get(0).tagName==="PRE"?b(d).replaceWith("<p>"+b(d).text()+"</p>"):document.execCommand(a,false,c)}else document.execCommand(a,false,c);a==="inserthorizontalrule"&&this.$editor.find("hr").removeAttr("id");this.syncCode();this.oldIE()&&this.$editor.focus();typeof this.opts.execCommandCallback===
"function"&&this.opts.execCommandCallback(this,a);this.opts.air&&this.air.hide()}catch(g){}},formatNewLine:function(){var a=this.getParentNode();if(a.nodeName==="DIV"&&a.className==="redactor_editor"){a=b(this.getCurrentNode());if(a.get(0).tagName==="DIV"&&(a.html()===""||a.html()==="<br>")){var c=b("<p>").append(a.clone().get(0).childNodes);a.replaceWith(c);c.html("<br />");this.setFocusNode(c.get(0))}}},safariShiftKeyEnter:function(a,c){if(a.shiftKey&&c===13){a.preventDefault();this.insertNodeAtCaret(b("<span><br /></span>").get(0));
this.syncCode();return false}else return true},formatEmpty:function(a){var c=b.trim(this.$editor.html());if(iNet.isGecko)c=c.replace(/<br>/i,"");if(c===""){a.preventDefault();a=this.opts.allEmptyHtml;if(iNet.isGecko)a=this.opts.mozillaEmptyHtml;a=b(a).get(0);this.$editor.html(a);this.setFocusNode(a);this.syncCode();return false}else this.syncCode()},paragraphy:function(a){a=b.trim(a);if(a==="")return iNet.isGecko?this.opts.mozillaEmptyHtml:this.opts.allEmptyHtml;if(this.opts.convertDivs)a=a.replace(/<div(.*?)>([\w\W]*?)<\/div>/gi,
"<p>$2</p>");var c=function(e,f,g){return e.replace(RegExp(f,"g"),g)},d=function(e,f){return c(a,e,f)};a+="\n";d("<br />\\s*<br />","\n\n");d("(<(table|thead|tfoot|caption|colgroup|tbody|tr|td|th|div|dl|dd|dt|ul|ol|li|pre|select|form|blockquote|address|math|style|script|object|input|param|p|h[1-6])[^>]*>)","\n$1");d("(</(table|thead|tfoot|caption|colgroup|tbody|tr|td|th|div|dl|dd|dt|ul|ol|li|pre|select|form|blockquote|address|math|style|script|object|input|param|p|h[1-6])>)","$1\n\n");d("\r\n|\r",
"\n");d("\n\n+","\n\n");d("\n?((.|\n)+?)$","<p>$1</p>\n");d("<p>\\s*?</p>","");d("<p>(<div[^>]*>\\s*)","$1<p>");d("<p>([^<]+)\\s*?(</(div|address|form)[^>]*>)","<p>$1</p>$2");d("<p>\\s*(</?(table|thead|tfoot|caption|colgroup|tbody|tr|td|th|div|dl|dd|dt|ul|ol|li|pre|select|form|blockquote|address|math|style|script|object|input|param|p|h[1-6])[^>]*>)\\s*</p>","$1");d("<p>(<li.+?)</p>","$1");d("<p>\\s*(</?(table|thead|tfoot|caption|colgroup|tbody|tr|td|th|div|dl|dd|dt|ul|ol|li|pre|select|form|blockquote|address|math|style|script|object|input|param|p|h[1-6])[^>]*>)",
"$1");d("(</?(table|thead|tfoot|caption|colgroup|tbody|tr|td|th|div|dl|dd|dt|ul|ol|li|pre|select|form|blockquote|address|math|style|script|object|input|param|p|h[1-6])[^>]*>)\\s*</p>","$1");d("(</?(table|thead|tfoot|caption|colgroup|tbody|tr|td|th|div|dl|dd|dt|ul|ol|li|pre|select|form|blockquote|address|math|style|script|object|input|param|p|h[1-6])[^>]*>)\\s*<br />","$1");d("<br />(\\s*</?(p|li|div|dl|dd|dt|th|pre|td|ul|ol)[^>]*>)","$1");a.indexOf("<pre")!=-1&&d("(<pre(.|\n)*?>)((.|\n)*?)</pre>",
function(e,f,g,h){return c(f,"\\\\(['\"\\\\])","$1")+c(c(c(h,"<p>","\n"),"</p>|<br />",""),"\\\\(['\"\\\\])","$1")+"</pre>"});return d("\n</p>$","</p>")},stripTags:function(a){var c=this.opts.allowedTags;return a.replace(/<\/?([a-z][a-z0-9]*)\b[^>]*>/gi,function(d,e){return b.inArray(e.toLowerCase(),c)>"-1"?d:""})},pasteCleanUp:function(a){a=a.replace(/<!--[\s\S]*?--\>|<\?(?:php)?[\s\S]*?\?>/gi,"");a=a.replace(/(&nbsp;){1,}/gi,"&nbsp;");a=a.replace(/<b\sid="internal-source-marker(.*?)">([\w\W]*?)<\/b>/gi,
"$2");a=this.stripTags(a);a=a.replace(/<td><br><\/td>/gi,"[td]");a=a.replace(/<a(.*?)>([\w\W]*?)<\/a>/gi,"[a$1]$2[/a]");a=a.replace(/<iframe(.*?)>([\w\W]*?)<\/iframe>/gi,"[iframe$1]$2[/iframe]");a=a.replace(/<video(.*?)>([\w\W]*?)<\/video>/gi,"[video$1]$2[/video]");a=a.replace(/<audio(.*?)>([\w\W]*?)<\/audio>/gi,"[audio$1]$2[/audio]");a=a.replace(/<embed(.*?)>([\w\W]*?)<\/embed>/gi,"[embed$1]$2[/embed]");a=a.replace(/<object(.*?)>([\w\W]*?)<\/object>/gi,"[object$1]$2[/object]");a=a.replace(/<param(.*?)>/gi,
"[param$1]");a=a.replace(/<img(.*?)>/gi,"[img$1]");a=a.replace(/<(\w+)([\w\W]*?)>/gi,"<$1>");a=a.replace(/<[^\/>][^>]*>(\s*|\t*|\n*|&nbsp;|<br>)<\/[^>]+>/gi,"");a=a.replace(/<[^\/>][^>]*>(\s*|\t*|\n*|&nbsp;|<br>)<\/[^>]+>/gi,"");a=a.replace(/\[td\]/gi,"<td><br></td>");a=a.replace(/\[a(.*?)\]([\w\W]*?)\[\/a\]/gi,"<a$1>$2</a>");a=a.replace(/\[iframe(.*?)\]([\w\W]*?)\[\/iframe\]/gi,"<iframe$1>$2</iframe>");a=a.replace(/\[video(.*?)\]([\w\W]*?)\[\/video\]/gi,"<video$1>$2</video>");a=a.replace(/\[audio(.*?)\]([\w\W]*?)\[\/audio\]/gi,
"<audio$1>$2</audio>");a=a.replace(/\[embed(.*?)\]([\w\W]*?)\[\/embed\]/gi,"<embed$1>$2</embed>");a=a.replace(/\[object(.*?)\]([\w\W]*?)\[\/object\]/gi,"<object$1>$2</object>");a=a.replace(/\[param(.*?)\]/gi,"<param$1>");a=a.replace(/\[img(.*?)\]/gi,"<img$1>");if(this.opts.convertDivs)a=a.replace(/<div(.*?)>([\w\W]*?)<\/div>/gi,"<p>$2</p>");if(this.opts.paragraphy===false)a=a.replace(/<p>([\w\W]*?)<\/p>/gi,"$1<br>");a=a.replace(/<span>([\w\W]*?)<\/span>/gi,"$1");a=a.replace(/\n{3,}/gi,"\n");a=a.replace(/<p><p>/g,
"<p>");a=a.replace(/<\/p><\/p>/g,"</p>");this.execCommand("inserthtml",a);this.opts.autoresize===true?b(document.body).scrollTop(this.saveScroll):this.$editor.scrollTop(this.saveScroll)},formattingRemove:function(a){var c=[],d=a.match(/<pre(.*?)>([\w\W]*?)<\/pre>/gi);d!==null&&b.each(d,function(e,f){a=a.replace(f,"prebuffer_"+e);c.push(f)});a=a.replace(/\s{2,}/g," ");a=a.replace(/\n/g," ");a=a.replace(/[\t]*/g,"");a=a.replace(/\n\s*\n/g,"\n");a=a.replace(/^[\s\n]*/g,"");a=a.replace(/[\s\n]*$/g,"");
a=a.replace(/>\s+</g,"><");if(c){b.each(c,function(e,f){a=a.replace("prebuffer_"+e,f)});c=[]}return a},formattingIndenting:function(a){a=a.replace(/<li/g,"\t<li");a=a.replace(/<tr/g,"\t<tr");a=a.replace(/<td/g,"\t\t<td");return a=a.replace(/<\/tr>/g,"\t</tr>")},formattingEmptyTags:function(a){for(var c=["<pre></pre>","<blockquote>\\s*</blockquote>","<em>\\s*</em>","<ul></ul>","<ol></ol>","<li></li>","<table></table>","<tr></tr>","<span>\\s*<span>","<span>&nbsp;<span>","<b>\\s*</b>","<b>&nbsp;</b>",
"<p>\\s*</p>","<p>&nbsp;</p>","<p>\\s*<br>\\s*</p>","<div>\\s*</div>","<div>\\s*<br>\\s*</div>"],d=0;d<c.length;++d)a=a.replace(RegExp(c[d],"gi"),"");return a},formattingAddBefore:function(a){for(var c=["<p","<form","</ul>","</ol>","<fieldset","<legend","<object","<embed","<select","<option","<input","<textarea","<pre","<blockquote","<ul","<ol","<li","<dl","<dt","<dd","<table","<thead","<tbody","<caption","</caption>","<th","<tr","<td","<figure"],d=0;d<c.length;++d){var e=c[d];a=a.replace(RegExp(e,
"gi"),"\r\n"+e)}return a},formattingAddAfter:function(a){for(var c=["</p>","</div>","</h1>","</h2>","</h3>","</h4>","</h5>","</h6>","<br>","<br />","</dl>","</dt>","</dd>","</form>","</blockquote>","</pre>","</legend>","</fieldset>","</object>","</embed>","</textarea>","</select>","</option>","</table>","</thead>","</tbody>","</tr>","</td>","</th>","</figure>"],d=0;d<c.length;++d){var e=c[d];a=a.replace(RegExp(e,"gi"),e+"\r\n")}return a},formatting:function(a){a=this.formattingRemove(a);a=this.formattingEmptyTags(a);
a=this.formattingAddBefore(a);a=this.formattingAddAfter(a);return a=this.formattingIndenting(a)},toggle:function(){var a;if(this.opts.visual){this.$editor.hide();a=this.$editor.html();a=b.trim(this.formatting(a));this.$el.height(this.$editor.innerHeight()).val(a).show().focus();this.setBtnActive("html");this.opts.visual=false}else{this.$el.hide();a=this.stripTags(this.$el.val());this.$editor.html(a);this.$editor.show();if(this.$editor.html()===""){a=iNet.isGecko?this.opts.mozillaEmptyHtml:this.opts.allEmptyHtml;
this.setCode(a)}this.$editor.focus();this.setBtnInactive("html");this.opts.visual=true;this.observeImages();this.observeTables()}},autoSave:function(){setInterval(b.proxy(function(){b.ajax({url:this.opts.autosave,type:"post",data:this.$el.attr("name")+"="+this.getCode(),success:b.proxy(function(a){typeof this.opts.autosaveCallback==="function"&&this.opts.autosaveCallback(a,this)},this)})},this),this.opts.interval*1E3)},buildToolbar:function(){if(this.opts.toolbar===false)return false;this.$toolbar=
b("<ul>").addClass("redactor_toolbar");if(this.opts.air){b(this.air).append(this.$toolbar);b("body").prepend(this.air)}else this.$box.prepend(this.$toolbar);b.each(this.opts.buttons,b.proxy(function(a,c){if(c!=="|"&&typeof this.opts.toolbar[c]!=="undefined"){var d=this.opts.toolbar[c];if(this.opts.fileUpload===false&&c==="file")return true;var e=b("<li>"),f=this.buildButton(c,d);if(c==="backcolor"||c==="fontcolor"||typeof d.dropdown!=="undefined"){var g=b('<div class="redactor_dropdown" style="display: none;">');
g=c==="backcolor"||c==="fontcolor"?this.buildColorPicker(g,c):this.buildDropdown(g,d.dropdown);this.dropdowns.push(g.appendTo(b(document.body)));this.hdlHideDropDown=b.proxy(function(h){this.hideDropDown(h,g,c)},this);this.hdlShowDropDown=b.proxy(function(h){this.showDropDown(h,g,c)},this);f.click(this.hdlShowDropDown)}this.$toolbar.append(b(e).append(f))}c==="|"&&this.$toolbar.append(b('<li class="redactor_separator"></li>'))},this));b(document).click(this.hdlHideDropDown);this.$editor.click(this.hdlHideDropDown)},
buildButton:function(a,c){var d=b('<a href="javascript:void(null);" title="'+c.title+'" class="redactor_btn_'+a+'"></a>');if(typeof c.func==="undefined")d.click(b.proxy(function(){this.execCommand(c.exec,a)},this));else c.func!=="show"&&d.click(b.proxy(function(e){this[c.func](e)},this));typeof c.callback!=="undefined"&&d.click(b.proxy(function(e){c.callback(this,e,a)},this));return d},buildDropdown:function(a,c){b.each(c,b.proxy(function(d,e){if(typeof e.className==="undefined")e.className="";var f;
if(typeof e.name!=="undefined"&&e.name==="separator")f=b('<a class="redactor_separator_drop">');else{f=b('<a href="javascript:void(null);" class="'+e.className+'">'+e.title+"</a>");typeof e.func==="undefined"?b(f).click(b.proxy(function(){this.execCommand(e.exec,d)},this)):b(f).click(b.proxy(function(g){this[e.func](g)},this))}b(a).append(f)},this));return a},buildColorPicker:function(a,c){var d;d=c==="backcolor"?iNet.isIE?"BackColor":"hilitecolor":"forecolor";b(a).width(210);for(var e=this.opts.colors.length,
f=0;f<e;++f){var g=this.opts.colors[f];g=b('<a rel="'+g+'" href="javascript:void(null);" class="redactor_color_link"></a>').css({backgroundColor:g});b(a).append(g);var h=this;b(g).click(function(){h.execCommand(d,b(this).attr("rel"));d==="forecolor"&&h.$editor.find("font").replaceWith(function(){return b('<span style="color: '+b(this).attr("color")+';">'+b(this).html()+"</span>")});iNet.isIE&&d==="BackColor"&&h.$editor.find("font").replaceWith(function(){return b('<span style="'+b(this).attr("style")+
'">'+b(this).html()+"</span>")})})}e=b('<a href="javascript:void(null);" class="redactor_color_none"></a>').html(RLANG.none);c==="backcolor"?e.click(b.proxy(this.setBackgroundNone,this)):e.click(b.proxy(this.setColorNone,this));b(a).append(e);return a},setBackgroundNone:function(){b(this.getParentNode()).css("background-color","transparent");this.syncCode()},setColorNone:function(){b(this.getParentNode()).attr("color","").css("color","");this.syncCode()},showDropDown:function(a,c,d){if(this.getBtn(d).hasClass("dropact"))this.hideAllDropDown();
else{this.hideAllDropDown();this.setBtnActive(d);this.getBtn(d).addClass("dropact");a=this.getBtn(d).offset().left;if(this.opts.air){d=this.air.offset().top;b(c).css({position:"absolute",left:a+"px",top:d+30+"px"}).show()}else if(this.opts.fixed&&this.fixed)b(c).css({position:"fixed",left:a+"px",top:"30px"}).show();else{d=this.$toolbar.offset().top+30;b(c).css({position:"absolute",left:a+"px",top:d+"px"}).show()}}},hideAllDropDown:function(){this.$toolbar.find("a.dropact").removeClass("act").removeClass("dropact");
b(".redactor_dropdown").hide()},hideDropDown:function(a,c){if(!b(a.target).hasClass("dropact")){b(c).removeClass("act");this.showedDropDown=false;this.hideAllDropDown()}},getSelection:function(){if(typeof window.getSelection!=="undefined")return document.getSelection();else if(typeof document.selection!=="undefined")return document.selection.createRange()},getFragmentHtml:function(a){a=a.cloneNode(true);var c=document.createElement("div");c.appendChild(a);return c.innerHTML},extractContent:function(){for(var a=
this.$editor.get(0),c=document.createDocumentFragment(),d;d=a.firstChild;)c.appendChild(d);return c},saveSelection:function(){this.savedSelObj=this.savedSel=null;if(iNet.isIE&&parseInt(iNet.browserVersion,10)<9){var a=this.$editor.get(0);this.savedSel=window.Selection.getOrigin(a);this.savedSelObj=window.Selection.getFocus(a)}else{this.savedSel=window.Selection.getOrigin(window);this.savedSelObj=window.Selection.getFocus(window)}},restoreSelection:function(){if(this.savedSel!==null&&this.savedSelObj!==
null&&this.savedSel[0].tagName!=="BODY")b(this.savedSel[0]).closest(".redactor_editor").size()==0?this.$editor.focus():window.Selection.setSelection(window,this.savedSel[0],this.savedSel[1],this.savedSelObj[0],this.savedSelObj[1]);else this.$editor.focus()},getParentNode:function(){if(typeof window.getSelection!=="undefined")return window.getSelection().rangeCount>0?this.getSelection().getRangeAt(0).startContainer.parentNode:false;else if(typeof document.selection!=="undefined")return this.getSelection().parentElement()},
getCurrentNode:function(){if(typeof window.getSelection!=="undefined")return this.getSelection().getRangeAt(0).startContainer;else if(typeof document.selection!=="undefined")return this.getSelection()},setFocusNode:function(a){if(typeof a==="undefined")return false;try{var c=document.createRange(),d=this.getSelection();if(d!==null){c.selectNodeContents(a);d.addRange(c);d.collapse(a,0)}this.$editor.focus()}catch(e){}},insertNodeAtCaret:function(a){if(window.getSelection){var c=this.getSelection();
if(c.rangeCount){var d=c.getRangeAt(0);d.collapse(false);d.insertNode(a);d=d.cloneRange();d.selectNodeContents(a);d.collapse(false);c.removeAllRanges();c.addRange(d)}}else if(document.selection){c=a.nodeType===1?a.outerHTML:a.data;d="marker_"+(""+Math.random()).slice(2);c+='<span id="'+d+'"></span>';a=this.getSelection();a.collapse(false);a.pasteHTML(c);c=document.getElementById(d);a.moveToElementText(c);a.select();c.parentNode.removeChild(c)}},getSelectedHtml:function(){var a="";if(window.getSelection){var c=
window.getSelection();if(c.rangeCount){a=document.createElement("div");for(var d=0,e=c.rangeCount;d<e;++d)a.appendChild(c.getRangeAt(d).cloneContents());a=a.innerHTML}}else if(document.selection)if(document.selection.type==="Text")a=document.selection.createRange().htmlText;return a},getBtn:function(a){return b(this.$toolbar.find("a.redactor_btn_"+a))},setBtnActive:function(a){this.getBtn(a).addClass("act")},setBtnInactive:function(a){this.getBtn(a).removeClass("act")},resizeImage:function(a){var c=
false,d=false,e,f=b(a).width()/b(a).height();b(a).hover(function(){b(a).css("cursor","nw-resize")},function(){b(a).css("cursor","default");c=false});b(a).mousedown(function(g){g.preventDefault();f=b(a).width()/b(a).height();d=c=true;b(a).eq(0).offset();e=Math.round(g.pageY-b(a).eq(0).offset().top)});b(a).mouseup(b.proxy(function(){c=false;this.syncCode()},this));b(a).click(b.proxy(function(g){d&&this.imageEdit(g)},this));b(a).mousemove(function(g){if(c){d=false;b(this).eq(0).offset();var h=Math.round(g.pageY-
b(this).eq(0).offset().top)-e,j=b(a).height();h=parseInt(j,10)+h;j=h*f;j>10&&b(a).width(j);h>10&&b(a).height(h);b(this).eq(0).offset();e=Math.round(g.pageY-b(this).eq(0).offset().top)}})},showTable:function(){this.saveSelection();this.modalInit(RLANG.table,"table",300,b.proxy(function(){b("#redactor_insert_table_btn").click(b.proxy(this.insertTable,this))},this),function(){b("#redactor_table_rows").focus()})},insertTable:function(){for(var a=b("#redactor_table_rows").val(),c=b("#redactor_table_columns").val(),
d=b("<div></div>"),e=b('<table id="table'+Math.floor(Math.random()*99999)+'"><tbody></tbody></table>'),f=0;f<a;f++){for(var g=b("<tr></tr>"),h=0;h<c;h++){var j=b("<td><br></td>");b(g).append(j)}b(e).append(g)}b(d).append(e);a=b(d).html()+"<p></p>";this.restoreSelection();this.execCommand("inserthtml",a);this.modalClose();this.observeTables()},tableObserver:function(a){this.$table=b(a.target).closest("table");this.$table_tr=this.$table.find("tr");this.$table_td=this.$table.find("td");this.$table_td.removeClass("redactor-current-td");
this.$tbody=b(a.target).closest("tbody");this.$thead=b(this.$table).find("thead");this.$current_td=b(a.target);this.$current_td.addClass("redactor-current-td");this.$current_tr=b(a.target).closest("tr")},deleteTable:function(){b(this.$table).remove();this.$table=false;this.syncCode()},deleteRow:function(){b(this.$current_tr).remove();this.syncCode()},deleteColumn:function(){var a=b(this.$current_td).get(0).cellIndex;b(this.$table).find("tr").each(function(){b(this).find("td").eq(a).remove()});this.syncCode()},
addHead:function(){if(b(this.$table).find("thead").size()!==0)this.deleteHead();else{var a=b(this.$table).find("tr").first().clone();a.find("td").html("&nbsp;");this.$thead=b("<thead></thead>");this.$thead.append(a);b(this.$table).prepend(this.$thead);this.syncCode()}},deleteHead:function(){b(this.$thead).remove();this.$thead=false;this.syncCode()},insertRowAbove:function(){this.insertRow("before")},insertRowBelow:function(){this.insertRow("after")},insertColumnLeft:function(){this.insertColumn("before")},
insertColumnRight:function(){this.insertColumn("after")},insertRow:function(a){var c=b(this.$current_tr).clone();c.find("td").html("&nbsp;");a==="after"?b(this.$current_tr).after(c):b(this.$current_tr).before(c);this.syncCode()},insertColumn:function(a){var c=0;this.$current_td.addClass("redactor-current-td");this.$current_tr.find("td").each(function(d,e){if(b(e).hasClass("redactor-current-td"))c=d});this.$table_tr.each(function(d,e){var f=b(e).find("td").eq(c),g=f.clone();g.html("&nbsp;");a==="after"?
b(f).after(g):b(f).before(g)});this.syncCode()},showVideo:function(){this.saveSelection();this.modalInit(RLANG.video,"video",600,b.proxy(function(){b("#redactor_insert_video_btn").click(b.proxy(this.insertVideo,this))},this),function(){b("#redactor_insert_video_area").focus()})},insertVideo:function(){var a=b("#redactor_insert_video_area").val();a=this.stripTags(a);this.restoreSelection();this.execCommand("inserthtml",a);this.modalClose()},imageEdit:function(a){var c=b(a.target),d=c.parent();a=b.proxy(function(){b("#redactor_file_alt").val(c.attr("alt"));
b("#redactor_image_edit_src").attr("href",c.attr("src"));b("#redactor_form_image_align").val(c.css("float"));b(d).get(0).tagName==="A"&&b("#redactor_file_link").val(b(d).attr("href"));b("#redactor_image_delete_btn").click(b.proxy(function(){this.imageDelete(c)},this));b("#redactorSaveBtn").click(b.proxy(function(){this.imageSave(c)},this))},this);this.modalInit(RLANG.image,"image_edit",380,a)},imageDelete:function(a){b(a).remove();this.modalClose();this.syncCode()},imageSave:function(a){var c=b(a).parent();
b(a).attr("alt",b("#redactor_file_alt").val());var d=b("#redactor_form_image_align").val();if(d==="left")b(a).css({"float":"left",margin:"0 10px 10px 0"});else d==="right"?b(a).css({"float":"right",margin:"0 0 10px 10px"}):b(a).css({"float":"none",margin:"0"});d=b.trim(b("#redactor_file_link").val());if(d!=="")b(c).get(0).tagName!=="A"?b(a).replaceWith('<a href="'+d+'">'+this.outerHTML(a)+"</a>"):b(c).attr("href",d);else b(c).get(0).tagName==="A"&&b(c).replaceWith(this.outerHTML(a));this.modalClose();
this.observeImages();this.syncCode()},showImage:function(){this.saveSelection();var a=b.proxy(function(){this.opts.imageGetJson!==false?b.getJSON(this.opts.imageGetJson,b.proxy(function(e){var f={},g=0;b.each(e,b.proxy(function(l,k){if(typeof k.folder!=="undefined"){g++;f[k.folder]=g}},this));var h=false;b.each(e,b.proxy(function(l,k){var m="";if(typeof k.title!=="undefined")m=k.title;var n=0;if(!b.isEmptyObject(f)&&typeof k.folder!=="undefined"){n=f[k.folder];if(h===false)h=".redactorfolder"+n}m=
b('<img src="'+k.thumb+'" class="redactorfolder redactorfolder'+n+'" rel="'+k.image+'" title="'+m+'" />');b("#redactor_image_box").append(m);b(m).click(b.proxy(this.imageSetThumb,this))},this));if(!b.isEmptyObject(f)){b(".redactorfolder").hide();b(h).show();var j=b('<select id="redactor_image_box_select">');b.each(f,function(l,k){j.append(b('<option value="'+k+'">'+l+"</option>"))});b("#redactor_image_box").before(j);j.change(function(l){b(".redactorfolder").hide();b(".redactorfolder"+b(l.target).val()).show()})}},
this)):b("#redactor_tabs a").eq(1).remove();if(this.opts.imageUpload!==false){this.opts.uploadCrossDomain===false&&this.isMobile()===false&&b("#redactor_file").size()!==0&&b("#redactor_file").dragupload({url:this.opts.imageUpload,uploadFields:this.opts.uploadFields,success:b.proxy(this.imageUploadCallback,this)});this.uploadInit("redactor_file",{auto:true,url:this.opts.imageUpload,success:b.proxy(this.imageUploadCallback,this)})}else{b(".redactor_tab").hide();if(this.opts.imageGetJson===false){b("#redactor_tabs").remove();
b("#redactor_tab3").show()}else{var d=b("#redactor_tabs a");d.eq(0).remove();d.eq(1).addClass("redactor_tabs_act");b("#redactor_tab2").show()}}b("#redactor_upload_btn").click(b.proxy(this.imageUploadCallbackLink,this))},this),c=b.proxy(function(){this.opts.imageUpload===false&&this.opts.imageGetJson===false&&b("#redactor_file_link").focus()},this);this.modalInit(RLANG.image,"image",570,a,c,true)},imageSetThumb:function(a){this._imageSet('<img src="'+b(a.target).attr("rel")+'" alt="'+b(a.target).attr("title")+
'" />',true)},imageUploadCallbackLink:function(){b("#redactor_file_link").val()!==""?this._imageSet('<img src="'+b("#redactor_file_link").val()+'" />',true):this.modalClose()},imageUploadCallback:function(a){this._imageSet(a)},_imageSet:function(a,c){this.restoreSelection();if(a!==false){var d="",e="";if(c!==true){e=b.parseJSON(a);d='<p><img src="'+e.filelink+'" /></p>'}else d=a;this.execCommand("inserthtml",d);c!==true&&typeof this.opts.imageUploadCallback==="function"&&this.opts.imageUploadCallback(this,
e)}this.modalClose();this.observeImages()},showLink:function(){this.saveSelection();var a=b.proxy(function(){this.insert_link_node=false;var c=this.getSelection(),d="",e="",f="";if(iNet.isIE){e=this.getParentNode();if(e.nodeName==="A"){this.insert_link_node=b(e);e=this.insert_link_node.text();d=this.insert_link_node.attr("href");f=this.insert_link_node.attr("target")}else e=this.oldIE()?c.text:c.toString()}else if(c&&c.anchorNode&&c.anchorNode.parentNode.tagName==="A"){d=c.anchorNode.parentNode.href;
e=c.anchorNode.parentNode.text;f=c.anchorNode.parentNode.target;if(c.toString()==="")this.insert_link_node=c.anchorNode.parentNode}else e=c.toString();b(".redactor_link_text").val(e);c=d.replace(self.location.href,"");if(d.search("mailto:")===0){this.setModalTab(2);b("#redactor_tab_selected").val(2);b("#redactor_link_mailto").val(d.replace("mailto:",""))}else if(c.search(/^#/gi)===0){this.setModalTab(3);b("#redactor_tab_selected").val(3);b("#redactor_link_anchor").val(c.replace(/^#/gi,""))}else b("#redactor_link_url").val(d);
f==="_blank"&&b("#redactor_link_blank").attr("checked",true);b("#redactor_insert_link_btn").click(b.proxy(this.insertLink,this))},this);this.modalInit(RLANG.link,"link",460,a,function(){b("#redactor_link_url").focus()})},insertLink:function(){var a=b("#redactor_tab_selected").val(),c="",d="",e="";if(a==="1"){c=b("#redactor_link_url").val();d=b("#redactor_link_url_text").val();if(b("#redactor_link_blank").attr("checked"))e="_blank";if(c.search(/^https?:\/\//i)==-1)c=this.opts.protocol+c}else if(a===
"2"){c="mailto:"+b("#redactor_link_mailto").val();d=b("#redactor_link_mailto_text").val()}else if(a==="3"){c="#"+b("#redactor_link_anchor").val();d=b("#redactor_link_anchor_text").val()}this._insertLink('<a href="'+c+'" target="'+e+'">'+d+"</a>&nbsp;",b.trim(d),c,e)},_insertLink:function(a,c,d,e){this.$editor.focus();this.restoreSelection();if(c!=="")if(this.insert_link_node){b(this.insert_link_node).text(c);b(this.insert_link_node).attr("href",d);e!==""&&b(this.insert_link_node).attr("target",e);
this.syncCode()}else this.execCommand("inserthtml",a);this.modalClose()},showFile:function(){this.saveSelection();var a=b.proxy(function(){var c=this.getSelection(),d="";d=this.oldIE()?c.text:c.toString();b("#redactor_filename").val(d);this.opts.uploadCrossDomain===false&&this.isMobile()===false&&b("#redactor_file").dragupload({url:this.opts.fileUpload,uploadFields:this.opts.uploadFields,success:b.proxy(function(e){this.fileUploadCallback(e)},this)});this.uploadInit("redactor_file",{auto:true,url:this.opts.fileUpload,
success:b.proxy(function(e){this.fileUploadCallback(e)},this)})},this);this.modalInit(RLANG.file,"file",500,a)},fileUploadCallback:function(a){this.restoreSelection();if(a!==false){a=b.parseJSON(a);var c=b("#redactor_filename").val();if(c==="")c=a.filename;c='<a href="'+a.filelink+'">'+c+"</a>";if(iNet.isWebkit&&window.chrome)c+="&nbsp;";this.execCommand("inserthtml",c);typeof this.opts.fileUploadCallback==="function"&&this.opts.fileUploadCallback(this,a)}this.modalClose()},modalInit:function(a,c,
d,e,f){if(b("#redactor_modal_overlay").size()===0){this.overlay=b('<div id="redactor_modal_overlay" style="display: none;"></div>');b("body").prepend(this.overlay)}if(this.opts.overlay){b("#redactor_modal_overlay").show();b("#redactor_modal_overlay").click(b.proxy(this.modalClose,this))}if(b("#redactor_modal").size()===0){this.modal=b('<div id="redactor_modal" style="display: none;"><div id="redactor_modal_close">&times;</div><div id="redactor_modal_header"></div><div id="redactor_modal_inner"></div></div>');
b("body").append(this.modal)}b("#redactor_modal_close").click(b.proxy(this.modalClose,this));this.hdlModalClose=b.proxy(function(h){h.keyCode===27&&this.modalClose()},this);b(document).keyup(this.hdlModalClose);this.$editor.keyup(this.hdlModalClose);b("#redactor_modal_inner").html(this.opts["modal_"+c]);b("#redactor_modal_header").html(a);if(b("#redactor_tabs").size()!==0){var g=this;b("#redactor_tabs a").each(function(h,j){h++;b(j).click(function(){b("#redactor_tabs a").removeClass("redactor_tabs_act");
b(this).addClass("redactor_tabs_act");b(".redactor_tab").hide();b("#redactor_tab"+h).show();b("#redactor_tab_selected").val(h);if(g.isMobile()===false){var l=b("#redactor_modal").outerHeight();b("#redactor_modal").css("margin-top","-"+(l+10)/2+"px")}})})}b("#redactor_btn_modal_close").click(b.proxy(this.modalClose,this));typeof e==="function"&&e();a=b("#redactor_modal").outerHeight();if(this.isMobile()===false){b("#redactor_modal").css({position:"fixed",top:"50%",left:"50%",width:d+"px",height:"auto",
minHeight:"auto",marginTop:"-"+(a+10)/2+"px",marginLeft:"-"+(d+60)/2+"px"}).fadeIn("fast");this.modalSaveBodyOveflow=b(document.body).css("overflow");b(document.body).css("overflow","hidden")}else b("#redactor_modal").css({position:"fixed",width:"100%",height:"100%",top:"0",left:"0",margin:"0",minHeight:"300px"}).show();typeof f==="function"&&f()},modalClose:function(){b("#redactor_modal_close").unbind("click",this.modalClose);b("#redactor_modal").fadeOut("fast",b.proxy(function(){b("#redactor_modal_inner").html("");
if(this.opts.overlay){b("#redactor_modal_overlay").hide();b("#redactor_modal_overlay").unbind("click",this.modalClose)}b(document).unbind("keyup",this.hdlModalClose);this.$editor.unbind("keyup",this.hdlModalClose)},this));this.isMobile()===false&&b(document.body).css("overflow",this.modalSaveBodyOveflow)},setModalTab:function(a){b(".redactor_tab").hide();var c=b("#redactor_tabs a");c.removeClass("redactor_tabs_act");c.eq(a-1).addClass("redactor_tabs_act");b("#redactor_tab"+a).show()},uploadInit:function(a,
c){this.uploadOptions={url:false,success:false,start:false,trigger:false,auto:false,input:false};b.extend(this.uploadOptions,c);if(b("#"+a).size()!==0&&b("#"+a).get(0).tagName==="INPUT"){this.uploadOptions.input=b("#"+a);this.element=b(b("#"+a).get(0).form)}else this.element=b("#"+a);this.element_action=this.element.attr("action");if(this.uploadOptions.auto)b(this.uploadOptions.input).change(b.proxy(function(){this.element.submit(function(){return false});this.uploadSubmit()},this));else this.uploadOptions.trigger&&
b("#"+this.uploadOptions.trigger).click(b.proxy(this.uploadSubmit,this))},uploadSubmit:function(){this.uploadForm(this.element,this.uploadFrame())},uploadFrame:function(){this.id="f"+Math.floor(Math.random()*99999);var a=document.createElement("div");a.innerHTML='<iframe style="display:none" id="'+this.id+'" name="'+this.id+'"></iframe>';document.body.appendChild(a);this.uploadOptions.start&&this.uploadOptions.start();b("#"+this.id).load(b.proxy(this.uploadLoaded,this));return this.id},uploadForm:function(a,
c){if(this.uploadOptions.input){var d="redactorUploadForm"+this.id,e="redactorUploadFile"+this.id;this.form=b('<form  action="'+this.uploadOptions.url+'" method="POST" target="'+c+'" name="'+d+'" id="'+d+'" enctype="multipart/form-data"></form>');this.opts.uploadFields!==false&&typeof this.opts.uploadFields==="object"&&b.each(this.opts.uploadFields,b.proxy(function(g,h){if(h.indexOf("#")===0)h=b(h).val();var j=b('<input type="hidden" name="'+g+'" value="'+h+'">');b(this.form).append(j)},this));d=
this.uploadOptions.input;var f=b(d).clone();b(d).attr("id",e);b(d).before(f);b(d).appendTo(this.form);b(this.form).css("position","absolute");b(this.form).css("top","-2000px");b(this.form).css("left","-2000px");b(this.form).appendTo("body");this.form.submit()}else{a.attr("target",c);a.attr("method","POST");a.attr("enctype","multipart/form-data");a.attr("action",this.uploadOptions.url);this.element.submit()}},uploadLoaded:function(){var a=b("#"+this.id);a=a.contentDocument?a.contentDocument:a.contentWindow?
a.contentWindow.document:window.frames[this.id].document;if(this.uploadOptions.success)if(typeof a!=="undefined")this.uploadOptions.success(a.body.innerHTML.match(/\{.*\}/)[0]);else{alert("Upload failed!");this.uploadOptions.success(false)}this.element.attr("action",this.element_action);this.element.attr("target","")},oldIE:function(){if(iNet.isIE&&parseInt(iNet.browserVersion,10)<9)return true;return false},outerHTML:function(a){return b("<p>").append(b(a).eq(0).clone()).html()},normalize:function(a){return parseInt(a.replace("px",
""),10)},isMobile:function(a){return a===true&&/(iPhone|iPod|iPad|BlackBerry|Android)/.test(navigator.userAgent)?true:/(iPhone|iPod|BlackBerry|Android)/.test(navigator.userAgent)?true:false}};b.fn.getEditor=function(){return this.data("redactor").$editor};b.fn.getCode=function(){return this.data("redactor").getCode()};b.fn.getText=function(){return this.data("redactor").$editor.text()};b.fn.getSelected=function(){return this.data("redactor").getSelectedHtml()};b.fn.setCode=function(a){this.data("redactor").setCode(a)};
b.fn.insertHtml=function(a){this.data("redactor").insertHtml(a)};b.fn.destroyEditor=function(){this.data("redactor").destroy();this.removeData("redactor")};b.fn.setFocus=function(){this.data("redactor").$editor.focus()};b.fn.execCommand=function(a,c){this.data("redactor").execCommand(a,c)}})(jQuery);
(function(b){function i(a,c){this.opts=b.extend({url:false,success:false,preview:false,uploadFields:false,text:RLANG.drop_file_here,atext:RLANG.or_choose},c);this.$el=b(a)}b.fn.dragupload=function(a){return this.each(function(){(new i(this,a)).init()})};i.prototype={init:function(){if(!iNet.isIE){this.droparea=b('<div class="redactor_droparea"></div>');this.dropareabox=b('<div class="redactor_dropareabox">'+this.opts.text+"</div>");this.dropalternative=b('<div class="redactor_dropalternative">'+this.opts.atext+
"</div>");this.droparea.append(this.dropareabox);this.$el.before(this.droparea);this.$el.before(this.dropalternative);this.dropareabox.bind("dragover",b.proxy(function(){return this.ondrag()},this));this.dropareabox.bind("dragleave",b.proxy(function(){return this.ondragleave()},this));var a=b.proxy(function(e){this.dropareabox.text("Loading "+parseInt(e.loaded/e.total*100,10)+"%")},this),c=jQuery.ajaxSettings.xhr();c.upload&&c.upload.addEventListener("progress",a,false);var d=function(){return c};
this.dropareabox.get(0).ondrop=b.proxy(function(e){e.preventDefault();this.dropareabox.removeClass("hover").addClass("drop");e=e.dataTransfer.files[0];var f=new FormData;this.opts.uploadFields!==false&&typeof this.opts.uploadFields==="object"&&b.each(this.opts.uploadFields,b.proxy(function(g,h){if(h.indexOf("#")===0)h=b(h).val();f.append(g,h)},this));f.append("file",e);b.ajax({dataType:"html",url:this.opts.url,data:f,xhr:d,cache:false,contentType:false,processData:false,type:"POST",success:b.proxy(function(g){this.opts.success!==
false&&this.opts.success(g);this.opts.preview===true&&this.dropareabox.html(g)},this)})},this)}},ondrag:function(){this.dropareabox.addClass("hover");return false},ondragleave:function(){this.dropareabox.removeClass("hover");return false}}})(jQuery);
(function(b){var i=/(^|&lt;|\s)(www\..+?\..+?)(\s|&gt;|$)/g,a=/(^|&lt;|\s)(((https?|ftp):\/\/|mailto:).+?)(\s|&gt;|$)/g,c=function(){for(var d=this.childNodes,e=d.length;e--;){var f=d[e];if(f.nodeType===3){var g=f.nodeValue;if(g){g=g.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(i,'$1<a href="http://$2">$2</a>$3').replace(a,'$1<a href="$2">$2</a>$5');b(f).after(g).remove()}}else f.nodeType===1&&!/^(a|button|textarea)$/i.test(f.tagName)&&c.call(f)}};b.fn.linkify=function(){this.each(c)}})(jQuery);
(function(b){b.event.special.textselect={setup:function(i){b(this).data("textselected",false);b(this).data("ttt",i);b(this).bind("mouseup",b.event.special.textselect.handler)},teardown:function(){b(this).unbind("mouseup",b.event.special.textselect.handler)},handler:function(i){var a=b(this).data("ttt");a=b.event.special.textselect.getSelectedText(a).toString();if(a!=""){b(this).data("textselected",true);i.type="textselect";i.text=a;b.event.handle.apply(this,arguments)}},getSelectedText:function(){var i=
"";if(window.getSelection)i=window.getSelection();else if(document.getSelection)i=document.getSelection();else if(document.selection)i=document.selection.createRange().text;return i}};b.event.special.textunselect={setup:function(i){b(this).data("rttt",i);b(this).data("textselected",false);b(this).bind("mouseup",b.event.special.textunselect.handler);b(this).bind("keyup",b.event.special.textunselect.handlerKey)},teardown:function(){b(this).unbind("mouseup",b.event.special.textunselect.handler)},handler:function(i){if(b(this).data("textselected")){var a=
b(this).data("rttt");if(b.event.special.textselect.getSelectedText(a).toString()==""){b(this).data("textselected",false);i.type="textunselect";b.event.handle.apply(this,arguments)}}},handlerKey:function(i){if(b(this).data("textselected")){var a=b(this).data("rttt");a=b.event.special.textselect.getSelectedText(a).toString();if((i.keyCode=27)&&a==""){b(this).data("textselected",false);i.type="textunselect";b.event.handle.apply(this,arguments)}}}}})(jQuery);
$(function(){iNet.ns("iNet.ui.admin","iNet.ui.admin.Application");iNet.ui.admin.Application=function(){this.id="application-div";this.ajaxMaskId="ajax-mask";var c=this,a={application:iNet.resources.xgate.admin.application,global:iNet.resources.global,errors:iNet.resources.errors,constant:iNet.resources.constant,validate:iNet.resources.validate},l={BACK:$("#application-back-btn"),IMPORT:$("#application-import-btn"),DEPLOY:$("#application-deploy-btn")};l.BACK.hide();var f={view:iNet.getUrl("cms/application/list",
"smartcloud"),create:iNet.getUrl("cms/application/create","smartcloud"),activate:iNet.getUrl("cms/application/activate","smartcloud"),deploy:iNet.getUrl("cms/application/deploy","smartcloud"),verify:iNet.getUrl("cms/application/verify","smartcloud"),del:iNet.getUrl("cms/application/remove","smartcloud")},h={submit:$("#application-import-form"),file:$("#application-import-form-file")};h.file.on("change",function(){if(this.files.length<1)this.files=[];else{$("#"+(c.ajaxMaskId||"")).show();h.submit.ajaxSubmit({url:f.create,
beforeSubmit:function(){},uploadProgress:function(){},success:function(){},complete:function(b){$("#"+(c.ajaxMaskId||"")).hide();h.file.val("");var d=b.responseJSON||{},i=b.responseText||{};console.log(">> __responseJSON >>",d);if(CommonService.isSuccess(d)){c.notifySuccess(a.constant.submit_title,a.constant.submit_success);j.load()}else c.notifyError(a.constant.submit_title,c.getNotifyContent(a.constant.submit_error,d.errors||[]))}})}});var p=new DataSource({columns:[{property:"application",label:a.application.name,
sortable:true,disabled:true},{property:"brief",label:a.application.brief,sortable:true,disabled:true},{property:"changedName",label:a.application.changed,sortable:true,disabled:true},{property:"statusName",label:a.application.status,sortable:true,disabled:true},{label:"",type:"action",width:32,align:"center",buttons:[{text:a.application.changedPUBLISHED,icon:"icon-legal",labelCls:"label label-info",fn:function(b){m(f.activate,{application:b.application,activate:true})},visibled:function(b){return(b.changed||
"")!="PUBLISHED"}},{text:a.application.changedDESIGN,icon:"icon-magic",labelCls:"label label-warning",fn:function(b){m(f.activate,{application:b.application,activate:false})},visibled:function(b){return(b.changed||"")!="DESIGN"}},{text:a.application.changedUNPUBLISHED,icon:"icon-trash",labelCls:"label label-important",fn:function(b){m(f.del,{application:b.application})},visibled:function(b){return(b.changed||"")!="UNPUBLISHED"}}]}],delay:250}),j=new iNet.ui.grid.Grid({id:"application-grid",url:f.view,
firstLoad:true,dataSource:p,convertData:function(b){var d=b||{};$.each(d.items||[],function(i,e){e.changedName=a.application["changed"+e.changed];e.statusName=a.application["status"+e.status]});j.setTotal(d.total);return d.items},stretchHeight:false,editable:false,idProperty:"uuid"}),m=function(b,d){$.postJSON(b,d,function(i){var e=i||{};CommonService.isSuccess(e)?$.postJSON(f.verify,{},function(k){var g=k||{};if(CommonService.isSuccess(g)){g=="YES"&&c.notifySuccess(a.constant.warning_title,a.application.changedINFO);
j.load()}},{mask:c.getMask(),msg:iNet.resources.ajaxLoading.processing}):c.notifyError(a.constant.warning_title,c.getNotifyContent(a.constant.submit_error,e.errors||[]))},{mask:c.getMask(),msg:iNet.resources.ajaxLoading.processing})};j.on("click",function(){});j.on("loaded",function(){});l.IMPORT.on("click",function(){h.submit.find('[name="update"]').remove();h.file.trigger("click")});l.DEPLOY.on("click",function(){$.postJSON(f.verify,{},function(b){var d=b||{};if(CommonService.isSuccess(d))if(d==
"YES"){iNet.getLayout().xGate!=null&&iNet.getLayout().xGate.mask.show();$.postJSON(f.deploy,{},function(i){var e=i||{};if(CommonService.isSuccess(e))if(e=="SUCCESS"){var k=function(g){if(iNet.getLayout().xGate!=null){var n="......!!!";if(g%2==0)n="............!!!";if(g%3==0)n="........................!!!";iNet.getLayout().xGate.mask.loading(n)}var o=FormService.checkService();console.log("__isDeployCompleted >>",o);if(o)window.location.href+=window.location.hash;else setTimeout(function(){k(g+1)},
3E3)};k(1)}else{iNet.getLayout().xGate!=null&&iNet.getLayout().xGate.mask.hide();c.notifyError(a.constant.submit_title,c.getNotifyContent(a.constant.submit_error,e.errors||[]))}else{iNet.getLayout().xGate!=null&&iNet.getLayout().xGate.mask.hide();c.notifyError(a.constant.submit_title,c.getNotifyContent(a.constant.submit_error,e.errors||[]))}})}else c.notifySuccess(a.constant.warning_title,a.application.changedNOCHANGE);else c.notifyError(a.constant.warning_title,c.getNotifyContent(a.constant.submit_error,
d.errors||[]))})});iNet.ui.admin.Application.superclass.constructor.call(this)};iNet.extend(iNet.ui.admin.Application,iNet.ui.app.widget);(new iNet.ui.admin.Application).show()});
$(function(){iNet.ns("iNet.ui.admin","iNet.ui.admin.Bridge");iNet.ui.admin.Bridge=function(){this.id="bridge-div";var d=this,c={bridge:iNet.resources.xgate.admin.bridge,global:iNet.resources.global,errors:iNet.resources.errors,constant:iNet.resources.constant,validate:iNet.resources.validate},g={REGISTER:$("#bridge-register-btn"),PROFILE:$("#bridge-profile-btn")},h={register:iNet.getUrl("camel/bridge/register"),profile:iNet.getUrl("camel/endpoint/register"),regverify:iNet.getUrl("camel/bridge/regverify"),
siteprofile:iNet.getUrl("system/siteprofile"),subfirm:iNet.getUrl("firmtask/subfirm/list")},a={info:$("#bridge-info"),details:$("#bridge-details"),firmList:$("#bridge-firm-list"),service:$("#bridge-service-url"),urlRefresh:$("#bridge-service-url-refresh"),name:$("#bridge-name"),industry:$("#bridge-industry"),brief:$("#bridge-brief"),email:$("#bridge-email"),phone:$("#bridge-phone"),website:$("#bridge-website"),fax:$("#bridge-fax"),address1:$("#bridge-address1"),organId:$("#bridge-organId"),profileID:$("#bridge-profileID")};
a.details.hide();a.firmList.hide();$.postJSON(h.siteprofile,{},function(e){var b=e||{};if(CommonService.isSuccess(b)){a.name.val(b.name||"");a.industry.val(b.industry||"");a.brief.val(b.brief||"");a.email.val(b.email||"");a.phone.val(b.phone||"");a.website.val(b.website||"");a.fax.val(b.fax||"");a.address1.val(b.address1||"");a.organId.val(b.organiId||"");a.profileID.val(b.profileID||"");a.details.show();a.name.attr("readonly",true);a.industry.attr("readonly",true);a.brief.attr("readonly",true);a.email.attr("readonly",
true);a.phone.attr("readonly",true);a.website.attr("readonly",true);a.fax.attr("readonly",true);a.address1.attr("readonly",true);a.organId.attr("readonly",true);a.profileID.attr("readonly",true)}});var l=new DataSource({columns:[{property:"organiId",label:c.bridge.organId,sortable:true,disabled:true},{property:"name",label:c.bridge.name,sortable:true,disabled:true},{property:"email",label:c.bridge.email,sortable:true,disabled:true},{property:"phone",label:c.bridge.phone,sortable:true,disabled:true},
{property:"fax",label:c.bridge.fax,sortable:true,disabled:true},{property:"profileID",label:c.bridge.profileID,sortable:true,disabled:true}],delay:250}),j=new iNet.ui.grid.Grid({id:"bridge-firm-grid",url:h.subfirm,params:{},convertData:function(e){var b=e||{};(b.items||[]).length>0?a.firmList.show():a.firmList.hide();return b.items},dataSource:l,stretchHeight:false,editable:false,firstLoad:true,idProperty:"uuid"});a.urlRefresh.on("click",function(){a.service.val((location||{}).origin||"")});(function(){$.postJSON(h.regverify,
{},function(e){var b=e||{};if(CommonService.isSuccess(b)){$.each(b.endpoints||[],function(i,k){var f=document.createElement("a");f.href=(k||{}).endpoint;a.service.val((f||{}).origin||"")});a.info.removeClass("alert-danger").addClass("alert-info");a.info.text(c.bridge.connected);g.PROFILE.show()}else{a.info.removeClass("alert-info").addClass("alert-danger");a.info.text(c.bridge.unconnect);g.REGISTER.show()}},{mask:d.getMask(),msg:iNet.resources.ajaxLoading.loading})})();g.REGISTER.on("click",function(){$.postJSON(h.register,
{serverUrl:a.service.val()},function(e){var b=e||{};console.log(">>register>>",b);if(CommonService.isSuccess(b)){var i="";$.each(b.elements||[],function(k,f){i+="<div"+(f.status=="SUCCESS"?"":' style="color: red;"')+">"+c.bridge.organId+" ["+f.deliveryID+"]: "+f.status+" ("+f.reason+")</div>"});d.notifySuccess(c.constant.submit_title,String.format("{0}<br>{1}</br>",c.constant.submit_success,i));j.load();g.PROFILE.show()}else d.notifyError(c.constant.submit_title,d.getNotifyContent(c.constant.submit_error,
b.errors||[]))},{mask:d.getMask(),msg:iNet.resources.ajaxLoading.loading})});g.PROFILE.on("click",function(){$.postJSON(h.profile,{serverUrl:a.service.val()},function(e){var b=e||{};console.log(">>profile>>",b);if(CommonService.isSuccess(b)){d.notifySuccess(c.constant.submit_title,c.constant.submit_success);j.load()}else d.notifyError(c.constant.submit_title,d.getNotifyContent(c.constant.submit_error,b.errors||[]))},{mask:d.getMask(),msg:iNet.resources.ajaxLoading.loading})});iNet.ui.admin.Bridge.superclass.constructor.call(this)};
iNet.extend(iNet.ui.admin.Bridge,iNet.ui.app.widget);(new iNet.ui.admin.Bridge).show()});
$(function(){iNet.ns("iNet.ui.workflow","iNet.ui.workflow.WFGraphProcessMap");iNet.ui.workflow.WFGraphProcessMap=function(){this.id="graph-process-map-div";console.log(">>>> C,E,D,V >>>> ",roleCreate,roleEdit,roleDelete,roleView);var k=iNet.zone,l=iNet.context,d=[],m={},h=this,o=null,i={processmap:iNet.resources.workflow.processmap,global:iNet.resources.global,errors:iNet.resources.errors,constant:iNet.resources.constant,validate:iNet.resources.validate},n={BACK:$("#graph-process-map-back-btn"),SAVE:$("#graph-process-map-save-btn")};
n.SAVE.hide();var j={view:iNet.getUrl("cloud/workflow/process/list"),create:iNet.getUrl("firmtask/process/assign"),load_actor:iNet.getUrl("cloud/workflow/alias/list")},g={uuid:$("#graph-process-map-uuid-txt"),name:$("#graph-process-map-name-txt"),brief:$("#graph-process-map-brief-txt")},r=new DataSource({columns:[{property:"map",label:i.processmap.map,sortable:true,type:"checkbox",width:30},{property:"name",label:i.processmap.name,sortable:true,disabled:true,type:"text",width:150}],delay:250}),e=
new iNet.ui.grid.Grid({id:"graph-process-map-grid",url:j.load_actor,params:{zone:k,context:l,pageSize:10,pageNumber:0},convertData:function(a){var c=a||{};a=c.items||[];$.each(a,function(b,f){f.map=d.indexOf(f.actor)>=0});return a},dataSource:r,stretchHeight:false,editable:roleEdit,firstLoad:false,idProperty:"uuid"});e.on("save",function(){});e.on("update",function(){});e.on("blur",function(){});e.on("selectionchange",function(){});e.on("change",function(a,c){var b=iNet.apply(a,c);e.update(b);e.commit();
if(b.map)d.push(b.actor);else d.indexOf(b.actor)>=0&&d.splice(d.indexOf(b.actor),1);p()});this.loadData=function(a,c){if(iNet.isEmpty(c))c=true;var b=a||{};m=b;g.uuid.val(b.uuid||"");g.name.val(b.name||"");g.brief.val(b.brief||"");FormService.disable(g.name);FormService.disable(g.brief);$.postJSON(j.view,{zone:k,context:l},function(f){var s=f||{};d=[];$.each(s.items||[],function(t,q){if(q.graphProcessUUID==b.uuid){d=q.actors||[];return true}});c&&e.load()})};this.setPageBack=function(a){o=a};var p=
function(){var a={zone:k,context:l,actor:d.join(iNet.splitChar),graph:g.uuid.val(),service:""};if(!iNet.isEmpty(m.uuid))a.uuid=m.uuid;var c=iNet.isEmpty(a.uuid)?j.create:j.create;$.postJSON(c,a,function(b){var f=b||{};CommonService.isSuccess(f)||h.notifyError(i.constant.save_title,h.getNotifyContent(i.constant.save_error,f.errors||[]))},{msg:iNet.resources.ajaxLoading.processing,mask:h.getMask()})};n.BACK.on("click",function(){h.hide();o.show()});n.SAVE.on("click",p);iNet.ui.workflow.WFGraphProcessMap.superclass.constructor.call(this)};
iNet.extend(iNet.ui.workflow.WFGraphProcessMap,iNet.ui.app.widget)});
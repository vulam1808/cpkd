$(function(){iNet.ns("iNet.ui.xgate","iNet.ui.xgate.BfWorkflow");iNet.ui.xgate.BfWorkflow=function(s){this.id="briefcase-workflow-div";var y=s||{},g=this,f=null,h={context:iNet.context,zone:iNet.zone},b={BfWorkflow:iNet.resources.xgate.BfWorkflow,global:iNet.resources.global,errors:iNet.resources.errors,constant:iNet.resources.constant,validate:iNet.resources.validate},l={history_request:iNet.getUrl("firmtask/process/history")},i=iNet.getLayout().window.taskFrame;i.on("typechange",function(e){e==
"min"?d.setMenuButton(true):d.setMenuButton(false)});var x=function(){d.reset();var e=i.getTaskDataIndex(),j=((e||{}).history||{}).graphID||"",t=((e||{}).request||{}).uuid||"",u={uuid:j,zone:h.zone,context:h.context,version:"VIEW"},m=[];$.postJSON(l.history_request,{request:t},function(v){var n=v||{};if(CommonService.isSuccess(n))$.each(n.items||[],function(z,c){var a={},o="orange",p="orange",q=b.BfWorkflow.status.completed,r=b.BfWorkflow.status.inprocess,k=b.BfWorkflow.time.unlimited;if(c.completedTime==
0){p=o="blue";q=b.BfWorkflow.status.processing}var w=c.completedTime||(new Date).getTime();if(w>c.expiredTask)r=b.BfWorkflow.status.overdue;if(c.timeProcess>0){k=c.timeProcess+" ";k+=c.timeUnit==0?b.BfWorkflow.time.minutes:c.timeUnit==1?b.BfWorkflow.time.hours:b.BfWorkflow.time.day}a=iNet.apply(a,c);a.nodeColor=o;a.statusColor=p;a.nodeHtmlContent="";a.nodeHtmlContent+="<b>+ "+b.BfWorkflow.info.to+"</b>";a.nodeHtmlContent+="<br/>";a.nodeHtmlContent+="<b>"+b.BfWorkflow.info.sender+": </b>"+c.senderName;
a.nodeHtmlContent+="<br/>";a.nodeHtmlContent+="<b>"+b.BfWorkflow.info.sendDate+": </b>"+(new Date(c.created)).format("H:i d/m/Y");a.nodeHtmlContent+="<br/>";a.nodeHtmlContent+="<br/>";a.nodeHtmlContent+="<b>+ "+b.BfWorkflow.info.process+"</b>";a.nodeHtmlContent+="<br/>";a.nodeHtmlContent+="<b>"+b.BfWorkflow.info.processor+": </b>"+(c.processorName||"");a.nodeHtmlContent+="<br/>";a.nodeHtmlContent+="<b>"+b.BfWorkflow.info.completedDate+": </b>";a.nodeHtmlContent+=c.completedTime>0?(new Date(c.completedTime)).format("H:i d/m/Y"):
"";a.nodeHtmlContent+="<br/>";a.nodeHtmlContent+="<br/>";a.nodeHtmlContent+="<b>+ "+b.BfWorkflow.info.task+"</b>";a.nodeHtmlContent+="<br/>";a.nodeHtmlContent+="<b>"+b.BfWorkflow.info.status+": </b>";a.nodeHtmlContent+=q;a.nodeHtmlContent+="<br/>";a.nodeHtmlContent+="<b>"+b.BfWorkflow.info.timeProcess+": </b>";a.nodeHtmlContent+=k;a.nodeHtmlContent+="<br/>";a.nodeHtmlContent+="<b>"+b.BfWorkflow.info.alter+": </b>";a.nodeHtmlContent+=r;a.nodeTitle="";a.nodeName=c.taskName;m.push(a)});d.dataContent.$wfDesign.loadGraph(u,
m);d.dataContent.$wfDesign.show();d.setDataContent("view")})},d=new iNet.ui.itemview({id:"briefcase-workflow",resource:b,url:l,toolbar:function(){this.id="briefcase-workflow-toolbar";this.intComponent=function(){this.$backBtn=$("#briefcase-workflow-back-btn");this.$backBtn.on("click",function(){g.fireEvent("back");if(f!=null){f.show();g.hide()}}.createDelegate(this))}},dataContent:function(){this.id="briefcase-workflow-data-content";this.intComponent=function(){this.$wfDesign=new iNet.ui.workflow.Workflow({id:"briefcase-workflow-data-content-view",
context:h.context})}},ajaxMaskId:"ajax-mask",headerDetails:{subject:"briefcase-workflow-subject-details",sender:"briefcase-workflow-sender-details"}});d.on("menuclick",function(){i.setListTaskType("menu")});this.load=function(){x()};this.setPageBack=function(e,j){f=e;f!=null&&j!=false?d.toolbar.$backBtn.show():d.toolbar.$backBtn.hide()};this.setType=function(e){$("#"+g.id+' [data-id="item-view-control"].item-view').removeClass("full").addClass(e)};iNet.ui.xgate.BfWorkflow.superclass.constructor.call(this)};
iNet.extend(iNet.ui.xgate.BfWorkflow,iNet.ui.app.widget)});
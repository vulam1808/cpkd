$(function(){iNet.ns("iNet.ui.workflow");iNet.ui.workflow.WFGraphProcess=function(){this.id="graph-process-div";console.log(">>>> C,E,D,V >>>> ",roleCreate,roleEdit,roleDelete,roleView);var p=iNet.zone,i=iNet.context,b=this,g=null,q=null,j=null,k={},d={graphprocess:iNet.resources.workflow.graphprocess,global:iNet.resources.global,errors:iNet.resources.errors,constant:iNet.resources.constant,validate:iNet.resources.validate},e={BACK:$("#graph-process-back-btn"),PUBLISHED:$("#graph-process-published-btn"),
ASSIGN:$("#graph-process-assign-btn"),MAP:$("#graph-process-map-btn")},h={view:iNet.getUrl("cloud/workflow/defproc/list"),create:iNet.getUrl("cloud/workflow/defproc/create"),checkexists:iNet.getUrl("cloud/workflow/defproc/checkexists"),update:iNet.getUrl("cloud/workflow/defproc/update"),del:iNet.getUrl("cloud/workflow/defproc/delete"),published:iNet.getUrl("cloud/workflow/defproc/published"),assign:iNet.getUrl("firmtask/process/assign")},r=this.confirmDialog(iNet.resources.message.dialog_confirm_title,
b.getNotifyContent(d.constant.del_content,null),function(){if(!iNet.isEmpty(j)){r.hide();$.postJSON(h.del,{zone:p,process:j},function(a){var c=a||{};if(CommonService.isSuccess(c)){var f=j.split(",");for(a=0;a<f.length;a++)grid.remove(f[a]);j=null;e.DELETE.hide();b.notifySuccess(d.constant.del_title,d.constant.del_success)}else b.notifyError(d.constant.del_title,b.getNotifyContent(d.constant.del_error,c.errors||[]))},{mask:b.getMask(),msg:iNet.resources.ajaxLoading.deleting})}}),n=new iNet.ui.workflow.Workflow({id:"workflow-design-virtual",
context:i});this.loadData=function(a){var c=a||{};k=c;n.loadGraph(c);n.show();e.PUBLISHED.hide();e.ASSIGN.hide();e.MAP.hide();c.version=="DESIGN"&&e.PUBLISHED.show();if(c.version=="PRODUCTION"){e.ASSIGN.hide();e.MAP.show()}};this.createWorkflow=function(a){if(iNet.isEmpty(a))l();else{var c={};c.zone=p;c.context=i;c.context=i;c.type="AUTOMATIC";c.version="DESIGN";c.name=a;c.brief=a;$.postJSON(h.checkexists,c,function(f){var m=f||{};if(CommonService.isSuccess(m))iNet.isEmpty(m.uuid)?$.postJSON(h.create,
c,function(s){var o=s||{};if(CommonService.isSuccess(o))b.loadData(o);else{l();b.notifyError(d.constant.summit_title,b.getNotifyContent(d.constant.summit_error,o.errors||[]))}}):b.loadData(m);else{l();b.notifyError(d.constant.summit_title,b.getNotifyContent(d.constant.summit_error,m.errors||[]))}})}};this.setPageBack=function(a){q=a};var l=function(){n.hide();b.hide();q.show();this.fireEvent("finish")}.createDelegate(this);e.BACK.on("click",l);e.PUBLISHED.on("click",function(){var a=k||{};if(!iNet.isEmpty(a.uuid)){var c=
{graph:a.uuid,zone:a.zone};$.postJSON(h.published,c,function(f){if(CommonService.isSuccess(f)){b.notifySuccess(d.constant.submit_title,d.constant.submit_success);e.PUBLISHED.hide();e.ASSIGN.hide();e.MAP.show()}else b.notifyError(d.constant.submit_title,b.getNotifyContent(d.constant.submit_error,f.errors||[]))},{msg:iNet.resources.ajaxLoading.loading,mask:b.getMask()})}});e.ASSIGN.on("click",function(){var a=k||{};if(!iNet.isEmpty(a.uuid)){var c={graph:a.uuid,zone:a.zone,context:i,userAllowed:true,
actor:"nothing"};$.postJSON(h.assign,c,function(f){CommonService.isSuccess(f)?b.notifySuccess(d.constant.submit_title,d.constant.submit_success):b.notifyError(d.constant.submit_title,b.getNotifyContent(d.constant.submit_error,f.errors||[]))},{msg:iNet.resources.ajaxLoading.loading,mask:b.getMask()})}});e.MAP.on("click",function(){var a=k||{};if(!iNet.isEmpty(a.uuid)){if(g==null)g=new iNet.ui.workflow.WFGraphProcessMap;g.on("finish",function(){});g.loadData(a);g.setPageBack(b);g.show();b.hide()}});
iNet.ui.workflow.WFGraphProcess.superclass.constructor.call(this)};iNet.extend(iNet.ui.workflow.WFGraphProcess,iNet.ui.app.widget)});
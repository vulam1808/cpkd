$(function(){iNet.ns("iNet.ui.report","iNet.ui.report.Summary");iNet.ui.report.Summary=function(){this.id="report-summary-div";var f=this,d={summary:iNet.resources.xgate.report.summary,global:iNet.resources.global,errors:iNet.resources.errors,constant:iNet.resources.constant,validate:iNet.resources.validate},g={SEARCH:$("#report-summary-search-btn"),PRINT:$("#report-summary-print-btn"),VIEW:$("#report-summary-view-btn"),EXPORT:$("#report-summary-export-btn")},h={report:iNet.getUrl("onegate/summaryreport"),
view:iNet.getUrl("onegate/summaryreport"),generator:iNet.getUrl("onegate/excel/generator"),chkstatus:iNet.getUrl("report/file/chkstatus"),download:iNet.getUrl("report/file/download")},e={fromDate:$("#report-summary-from"),toDate:$("#report-summary-to"),report:$("#report-summary-content"),tableBody:$("#report-summary-table-body"),rowTemplate:$("#report-summary-table-row")},j=e.fromDate.datepicker({format:"dd/mm/yyyy"}).on("changeDate",function(){j.hide()}).data("datepicker");e.fromDate.val(CommonService.getFirstDate());
var k=e.toDate.datepicker({format:"dd/mm/yyyy"}).on("changeDate",function(){k.hide()}).data("datepicker");e.toDate.val(CommonService.getCurrentDate());var l=function(a){var c=a||{},b;for(b in c)e.rowTemplate.find('[data-type="'+b+'"]').text(c[b]);return"<tr>"+e.rowTemplate.html()+"</tr>"},m=new DataSource({columns:[{property:"industry",label:d.summary.industry,sortable:true,disabled:true},{property:"inventory",label:d.summary.inventory,sortable:true,disabled:true},{property:"receiver",label:d.summary.receiver,
sortable:true,disabled:true},{property:"inTime",label:d.summary.inTime,sortable:true,disabled:true},{property:"afterTime",label:d.summary.afterTime,sortable:true,disabled:true},{property:"percent",label:d.summary.percent,sortable:true,disabled:true},{property:"inTerm",label:d.summary.inTerm,sortable:true,disabled:true},{property:"outTerm",label:d.summary.outTerm,sortable:true,disabled:true}],delay:250}),n=new iNet.ui.grid.Grid({id:"report-summary-grid",url:h.view,params:{},convertData:function(a){var c=
a||[];return c},dataSource:m,stretchHeight:false,editable:false,firstLoad:false,idProperty:"uuid"});g.SEARCH.on("click",function(){var a={};a.from=e.fromDate.val().dateToLong();a.to=e.toDate.val().endDateToLong();$.postJSON(h.report,a,function(c){var b=c||{};g.PRINT.hide();if(CommonService.isSuccess(b)){e.summary.html(b);g.PRINT.show()}else f.notifyError(d.constant.submit_title,f.getNotifyContent(d.constant.submit_error,b.errors||[]))},{mask:f.getMask(),msg:iNet.resources.ajaxLoading.loading})});
g.PRINT.on("click",function(){var a=document.createElement("iframe");a.name="framePrint";a.style.position="absolute";a.style.top="-1000000px";document.body.appendChild(a);var c=a.contentWindow?a.contentWindow:a.contentDocument.document?a.contentDocument.document:a.contentDocument;c.document.open();c.document.write(e.summary.html());c.document.close();setTimeout(function(){window.frames.framePrint.focus();window.frames.framePrint.print();document.body.removeChild(a)},500)});g.VIEW.on("click",function(){var a=
{};a.from=e.fromDate.val().dateToLong();a.to=e.toDate.val().endDateToLong();$.postJSON(h.view,a,function(c){var b=c||[];e.tableBody.html("");CommonService.isSuccess(b)?$.each(b,function(p,o){e.tableBody.append(l(o))}):f.notifyError(d.constant.submit_title,f.getNotifyContent(d.constant.submit_error,b.errors||[]))},{mask:f.getMask(),msg:iNet.resources.ajaxLoading.loading});g.EXPORT.show()});var i=function(a){$.postJSON(h.chkstatus,{reportID:a},function(c){var b=c||0;if(b==2)window.location.href=h.download+
"?reportID="+a;else b==1&&setTimeout(function(){i(a)},2E3)},{mask:f.getMask(),msg:iNet.resources.ajaxLoading.loading})};g.EXPORT.on("click",function(){var a=n.getParams()||{};a.type="Summary";$.postJSON(h.generator,a,function(c){var b=c||{};CommonService.isSuccess(b)?setTimeout(function(){i(b.uuid)},2E3):f.notifyError(d.constant.submit_title,f.getNotifyContent(d.constant.submit_error,b.errors||[]))},{mask:f.getMask(),msg:iNet.resources.ajaxLoading.loading})});CommonService.syncProcedure();iNet.ui.report.Summary.superclass.constructor.call(this)};
iNet.extend(iNet.ui.report.Summary,iNet.ui.app.widget);(new iNet.ui.report.Summary).show()});
$(function(){iNet.ns("iNet.ui.admin","iNet.ui.admin.Plugin");iNet.ui.admin.Plugin=function(){this.id="plugin-div";var d=this,g=null,i=null,b={plugin:iNet.resources.xgate.admin.plugin,global:iNet.resources.global,errors:iNet.resources.errors,constant:iNet.resources.constant,validate:iNet.resources.validate},f={BACK:$("#plugin-back-btn"),IMPORT:$("#plugin-import-btn"),UPDATE:$("#plugin-update-btn")};f.BACK.hide();var j={view:iNet.getUrl("onegate/plugin/list"),importPlugin:iNet.getUrl("onegate/plugin/import"),
del:iNet.getUrl("onegate/plugin/delete")},e={submit:$("#plugin-import-form"),file:$("#plugin-import-form-file")};e.file.on("change",function(){if(this.files.length<1)this.files=[];else e.submit.ajaxSubmit({url:j.importPlugin,beforeSubmit:function(){},uploadProgress:function(){},success:function(){},complete:function(a){e.file.val("");var c=a.responseJSON||{},k=a.responseText||{};console.log(">> __responseJSON >>",c);if(CommonService.isSuccess(c)){d.notifySuccess(b.constant.submit_title,b.constant.submit_success);
h.load()}else d.notifyError(b.constant.submit_title,d.getNotifyContent(b.constant.submit_error,c.errors||[]))}})});var l=this.confirmDialog(iNet.resources.message.dialog_confirm_title,d.getNotifyContent(b.constant.del_content,i),function(){if(!iNet.isEmpty(g)){l.hide();$.postJSON(j.del,{plugin:g},function(a){var c=a||{};if(CommonService.isSuccess(c)){var k=g.split(",");for(a=0;a<k.length;a++)h.remove(k[a]);g=null;d.notifySuccess(b.constant.del_title,b.constant.del_success)}else d.notifyError(b.constant.del_title,
d.getNotifyContent(b.constant.del_error,c.errors||[]))},{mask:d.getMask(),msg:iNet.resources.ajaxLoading.deleting})}}),m=new DataSource({columns:[{property:"name",label:b.plugin.name,sortable:true,disabled:true},{property:"brief",label:b.plugin.brief,sortable:true,disabled:true},{label:"",type:"action",width:32,align:"center",buttons:[{text:iNet.resources.message.button.del,icon:"icon-trash",labelCls:"label label-important",fn:function(a){g=a.uuid.toString();i=a.name;l.setContent(String.format(b.constant.del_content,
i));l.show()}}]}],delay:250}),h=new iNet.ui.grid.Grid({id:"plugin-grid",url:j.view,firstLoad:true,dataSource:m,convertData:function(a){var c=a||{};h.setTotal(c.total);return c.items},stretchHeight:false,editable:false,idProperty:"uuid"});h.on("click",function(){f.UPDATE.show()});h.on("loaded",function(){f.UPDATE.hide()});f.BACK.on("click",function(){});f.IMPORT.on("click",function(){e.submit.find('[name="update"]').remove();e.file.trigger("click")});f.UPDATE.on("click",function(){e.submit.find('[name="update"]').remove();
e.submit.append('<div class="hide"><input name="update" value="true" /></div>');e.file.trigger("click")});iNet.ui.admin.Plugin.superclass.constructor.call(this)};iNet.extend(iNet.ui.admin.Plugin,iNet.ui.app.widget);(new iNet.ui.admin.Plugin).show()});
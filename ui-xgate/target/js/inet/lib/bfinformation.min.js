$(function(){iNet.ns("iNet.ui.xgate","iNet.ui.xgate.BfInformation");iNet.ui.xgate.BfInformation=function(v){this.id="briefcase-information-div";var E=v||{},c=this,q=null,w={context:iNet.context,zone:iNet.zone,usercode:iNet.usercode},n={task:iNet.resources.task.task,BfInformation:iNet.resources.xgate.BfInformation,global:iNet.resources.global,errors:iNet.resources.errors,constant:iNet.resources.constant,validate:iNet.resources.validate},h={executor_task:iNet.getUrl("firmtask/process/executor"),update_task:iNet.getUrl("firmtask/process/additional"),
reject_task:iNet.getUrl("firmtask/process/reject"),mark_task:iNet.getUrl("firmtask/process/workermark"),late_task:iNet.getUrl("firmtask/process/latemark"),readComment:iNet.getUrl("firmtask/comment/read"),photo:iNet.getUrl("system/userprofile/photo"),additional_upload:iNet.getUrl("onegate/externaldata/upload"),additional_reqload:iNet.getUrl("onegate/externaldata/reqload"),new_request:iNet.getUrl("firmtask/process/request"),submit_request:iNet.getUrl("firmtask/process/submit"),update_request:iNet.getUrl("onegate/deptrecord/update"),
load_request:iNet.getUrl("onegate/deptrecord/load"),history_request:iNet.getUrl("firmtask/process/history"),downloadFile:iNet.getUrl("onegate/binary/download"),task_view:iNet.getUrl("firmtask/process/view"),record_view:iNet.getUrl("onegate/deptrecord/view")},r=iNet.getLayout().window.parent.taskMenu;r.on("menuchange",function(){});r.on("create",function(){});var i=iNet.getLayout().window.taskFrame;i.on("typechange",function(f){f=="min"?a.setMenuButton(true):a.setMenuButton(false)});var d=new iNet.ui.modalview;
d.on("success",function(){this.hide();i.refresh();r.refresh("task")});var u=new iNet.ui.fileview;u.setPageBack(c);var s=new iNet.ui.signature;s.setPageBack(c);var D=function(){a.reset();var f=i.getTaskDataIndex(),e=((f||{}).history||{}).graphID||"",o=((f||{}).history||{}).taskID||"";$.postJSON(h.task_view,{task:o,graph:e},function(g){var b=g||{};if(CommonService.isSuccess(b)){a.setData(b);a.toolbar.$updateBtn.hide();a.toolbar.$markBtn.parent().removeClass("hide");a.toolbar.$markBtn.parent().find('[data-toggle="dropdown"]').hide();
a.toolbar.$unmarkBtn.parent().addClass("hide");a.toolbar.$unmarkBtn.parent().find('[data-toggle="dropdown"]').hide();a.toolbar.$markList.html("");var m=b.request||{},k=b.history||{},j="";j+='<li style="padding: 5px; border-bottom: {5}px solid #DDD; display: flex;">';j+='<span style="width: 30px;"><img src="{0}?usercode={1}" style="height: 30px; width: 30px; border-radius: 15px;"></span>';j+='<span class="hide"> {2}<i class="icon-calendar"></i></span>';j+='<span style="padding-left: 5px;">';j+="<div>{3}</div>";
j+='<div><i style="font-size: 16px;" class="icon-info-sign"></i> {2} - {4}</div>';j+="</span>";j+='<span class="hide"> <i title="[{2}] {4}" style="font-size: 16px;" class="icon-info-sign"></i></span>';j+="</li>";var t=k.workers||[];$.each(t,function(p,l){if(l.senderCode==w.usercode){a.toolbar.$markBtn.parent().addClass("hide");a.toolbar.$unmarkBtn.parent().removeClass("hide")}a.toolbar.$markList.append(String.format(j,h.photo,l.senderCode,(l.created||0).longToDate(),l.sender,l.note,p==t.length-1?
0:1))});if(t.length>0){a.toolbar.$markBtn.parent().find('[data-toggle="dropdown"]').show();a.toolbar.$unmarkBtn.parent().find('[data-toggle="dropdown"]').show()}var x={subject:m.subject||"",showAttachmentIcon:false,showCommentIcon:false,showDetailsIcon:false},y={name:k.senderName,date:" ("+$.timeago(k.created||0)+")",showDetailsIcon:false};a.setHeader({subject:x,sender:y,object:b});a.setSubmitContent(b.content);var z=(b.request||{}).comments||[],A=(b.request||{}).attachments||[],B=(b.request||{}).externalData||
[];$.postJSON(h.record_view,{request:m.uuid},function(p){var l=p||{},C=(l.record||{}).documents||[];a.setFooter({comments:z,attBriefs:A,attExternalData:B,docRecord:C})},{mask:c.getMask(),msg:iNet.resources.ajaxLoading.loading});$.postJSON(h.additional_reqload,{packageID:(b.request||{}).additionalID},function(p){if(!iNet.isEmpty((p||{}).uuid||"")){a.toolbar.$viewProcessBtn.hide();a.toolbar.$viewTransferBtn.hide()}})}},{mask:c.getMask(),msg:iNet.resources.ajaxLoading.processing})},a=new iNet.ui.itemview({id:"briefcase-information",
resource:n,url:h,toolbar:function(){this.id="briefcase-information-toolbar";this.intComponent=function(){var f=i.getTaskDataIndex();this.$markList=$('[data-id="briefcase-information-mark-list"]');this.$backBtn=$("#briefcase-information-back-btn");this.$backBtn.on("click",function(){c.fireEvent("back");if(q!=null){q.show();c.hide()}}.createDelegate(this));this.$updateBtn=$("#briefcase-information-update-btn");this.$updateBtn.on("click",function(){var g=i.getTaskDataIndex(),b=((g||{}).history||{}).taskID||
"";d.setTitle($(this).attr("title"));d.setDescription($(this).attr("description"));d.setParams({task:b});d.setUrl(h.update_task);d.show()});this.$rejectBtn=$("#briefcase-information-reject-btn");this.$rejectBtn.on("click",function(){var g=i.getTaskDataIndex(),b=((g||{}).history||{}).processUUID||"",m=((g||{}).history||{}).taskID||"",k=((g||{}).history||{}).graphID||"";d.setTitle($(this).attr("title"));d.setDescription($(this).attr("description"));d.setParams({process:b});d.setAdditional(h.additional_upload,
{task:m,graph:k});d.setUrl(h.reject_task);d.show()});var e=(((f||{}).history||{}).attributes||{}).reject||"0";e=="1"?this.$rejectBtn.show():this.$rejectBtn.hide();this.$markBtn=$("#briefcase-information-mark-btn");this.$markBtn.on("click",function(){var g=i.getTaskDataIndex(),b=((g||{}).history||{}).taskID||"";d.setTitle($(this).attr("title"));d.setDescription($(this).attr("description"));d.setParams({task:b});d.setUrl(h.mark_task);d.show()});this.$unmarkBtn=$("#briefcase-information-unmark-btn");
this.$unmarkBtn.on("click",function(){var g=i.getTaskDataIndex(),b=((g||{}).history||{}).taskID||"";$.postJSON(h.mark_task,{task:b},function(m){var k=m||{};if(CommonService.isSuccess(k)){c.notifySuccess(n.constant.submit_title,n.constant.submit_success);i.refresh();r.refresh("task")}else c.notifyError(n.constant.submit_title,c.getNotifyContent(n.constant.submit_error,k.errors||[]))})});this.$viewProcessBtn=$("#briefcase-information-process-btn");this.$viewProcessBtn.on("click",function(){c.fireEvent("changeview",
{type:"process"})}.createDelegate(this));this.$viewAdditionalBtn=$("#briefcase-information-additional-btn");this.$viewAdditionalBtn.on("click",function(){c.fireEvent("changeview",{type:"additional"})}.createDelegate(this));this.$viewIDeskBtn=$("#briefcase-information-idesk-btn");this.$viewIDeskBtn.on("click",function(){i.changeLayout(iNet.getUrl("idesk/page/global/search-ed-instant"),"iDesk");c.fireEvent("changeview",{type:"idesk"})}.createDelegate(this));this.$viewTransferBtn=$("#briefcase-information-transfer-btn");
this.$viewTransferBtn.on("click",function(){c.fireEvent("changeview",{type:"transfer"})}.createDelegate(this));var o=(((f||{}).history||{}).attributes||{}).camel||"0";o=="1"?this.$viewTransferBtn.show():this.$viewTransferBtn.hide();this.$viewWorkflowBtn=$("#briefcase-information-workflow-btn");this.$viewWorkflowBtn.on("click",function(){c.fireEvent("changeview",{type:"workflow"})}.createDelegate(this))}},ajaxMaskId:"ajax-mask",headerDetails:{subject:"briefcase-information-subject-details",sender:"briefcase-information-sender-details"}});
a.on("menuclick",function(){i.setListTaskType("menu")});a.on("fileclick",function(f){var e=f||{};if(!iNet.isEmpty(e.uuid)){if(e.action=="viewfile"){u.viewFile(e.uuid);c.hide()}e.action=="downfile"&&window.open(h.downloadFile+"?binary="+e.uuid,"_blank");if(e.action=="signfile"){s.show();s.setData(e);c.hide()}e.action=="verifyfile"&&s.viewVerify(e.uuid)}});a.on("viewcomment",function(){var f=i.getTaskDataIndex(),e=((f||{}).history||{}).graphID||"",o=((f||{}).history||{}).taskID||"";$.postJSON(h.readComment,
{task:o,graph:e},function(g){var b=g||{};CommonService.isSuccess(b)&&console.log("readComment>>",b)},{mask:c.getMask(),msg:iNet.resources.ajaxLoading.processing})});this.load=function(){D()};this.setPageBack=function(f,e){q=f;q!=null&&e!=false?a.toolbar.$backBtn.show():a.toolbar.$backBtn.hide()};this.setType=function(f){$("#"+c.id+' [data-id="item-view-control"].item-view').removeClass("full").addClass(f)};iNet.ui.xgate.BfInformation.superclass.constructor.call(this)};iNet.extend(iNet.ui.xgate.BfInformation,
iNet.ui.app.widget)});
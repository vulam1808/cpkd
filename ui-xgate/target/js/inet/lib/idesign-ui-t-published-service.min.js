$(function(){iNet.ns("iNet.ui.builder","iNet.ui.builder.Published");iNet.ui.builder.Published=function(){this.id="published-div";var g=this,h=null,i={},j={publish:iNet.getUrl("design/cloudform/publish"),category:iNet.getUrl("cloud/designform/application")},c={constant:iNet.resources.constant,validate:iNet.resources.validate},d={SUBMIT:$("#published-submit-btn"),BACK:$("#published-back-btn"),SEARCH:$("#published-search-btn")},a={page:$("#published-page-txt"),application:$("#published-application-txt"),
category:$("#published-category-txt"),listCate:$("#published-category-list"),file:$("#published-file"),image:$("#published-image"),fileContainer:$("#published-file-container"),form:$("#published-form")};this.setData=function(b){i=b;a.page.val(i.uuid);a.application.val(i.name);a.category.val("");a.image.attr("src","#");a.fileContainer.find("span[data-title]").attr("data-title","")};this.setPageBack=function(b){h=b;h==null?d.BACK.hide():d.BACK.show()};a.fileContainer.on("click",function(){a.file.trigger("click")});
a.file.on("change",function(){a.image.attr("src","#");a.fileContainer.find("span[data-title]").attr("data-title","...");a.file.val("");if(this.files.length<1)this.files=[];else{var b=new FileReader;b.onload=function(e){a.image.attr("src",e.target.result)};b.readAsDataURL(this.files[0]);var f=this.files[0].name;a.fileContainer.find("span[data-title]").attr("data-title",f)}});var o=function(){iNet.isEmpty(a.application.val())||iNet.isEmpty(a.category.val())||iNet.isEmpty(a.file.val())?g.notifyError(c.constant.warning_title,
c.validate.required):a.form.ajaxSubmit({url:j.publish,beforeSubmit:function(){},uploadProgress:function(){},success:function(){},complete:function(b){var f=b.responseJSON||{},e=b.responseText||{};if(f=="SUCCESS"){g.notifySuccess(c.constant.submit_title,c.constant.submit_success);k()}else g.notifyError(c.constant.submit_title,c.constant.submit_error)}})}.createDelegate(this),k=function(){if(h!=null){g.hide();h.show();this.fireEvent("finish")}}.createDelegate(this),s=function(b){$.postJSON(j.category,
{},function(f){var e=f||"";if((e.type||"")!="ERROR"){a.listCate.html("");var l=e||[];$.each(l,function(p,m){var q=(b||"").toLowerCase(),r=(m||"").toLowerCase();if(r.indexOf(q)>=0){var n="padding: 5px;";n+=p==l.length-1?"":"border-bottom: 1px solid #DDD;";a.listCate.append('<li data-action="category" class="actionLi" style="'+n+'">'+m+"</li>")}});d.SEARCH.parent().addClass("open");$('li[data-action="category"]').click(function(){a.category.val($(this).text())})}})};d.SUBMIT.on("click",o);d.BACK.on("click",
k);d.SEARCH.on("click",function(){s(a.category.val())});iNet.ui.builder.Published.superclass.constructor.call(this)};iNet.extend(iNet.ui.builder.Published,iNet.ui.app.widget)});
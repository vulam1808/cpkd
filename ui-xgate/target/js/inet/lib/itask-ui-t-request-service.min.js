$(function(){iNet.ns("iNet.ui.task","iNet.ui.task.TRequest","iNet.ui.task.TMUserProfile");iNet.ui.task.TMUserProfile=function(){this.id="task-modal-user-profile";var h=$("#task-modal-user-profile"),j=this,q={task:iNet.resources.receiver.task,global:iNet.resources.global,errors:iNet.resources.errors,constant:iNet.resources.constant,validate:iNet.resources.validate},e=null,m=function(k,o,l){e||(e=new iNet.ui.form.Notify({id:iNet.generateId()}));e.setType(k);e.setTitle(o);e.setContent(l);e.show()},s=
{user_profile_search:iNet.getUrl("onegate/userprofile/search")},a={identity:$("#task-modal-user-profile-identity"),birthday:$("#task-modal-user-profile-birthday")},u={submit:$("#task-modal-user-profile-submit-btn"),close:$("#task-modal-user-profile-close-btn")};a.identity.on("keyup",function(k){var o=k.keyCode?k.keyCode:k.which;o==13&&!iNet.isEmpty(a.identity.val())&&!iNet.isEmpty(a.birthday.val())&&v()});a.birthday.on("keyup",function(k){var o=k.keyCode?k.keyCode:k.which;o==13&&!iNet.isEmpty(a.identity.val())&&
!iNet.isEmpty(a.birthday.val())&&v();iNet.isEmpty(a.birthday.val())||FormService.validateDate(a.birthday.val(),true)||a.birthday.val("")});a.birthday.on("change",function(){iNet.isEmpty(a.birthday.val())||FormService.validateDate(a.birthday.val())||a.birthday.val("")});this.setProfile=function(k){h.find('[data-profile="'+k+'"]').show();k=="citizen"?h.find('[data-profile="organ"]').hide():h.find('[data-profile="citizen"]').hide()};this.setData=function(k){var o=k||{};a.birthday.val(o.birthday||"");
a.identity.val(o.identity||"")};this.show=function(){h.modal("show")};this.hide=function(){h.modal("hide")};var v=function(){var k={birthday:a.birthday.val(),identity:a.identity.val()};iNet.isEmpty(k.birthday)||iNet.isEmpty(k.identity)?m("error",q.constant.warning_title,q.constant.warning_required):$.postJSON(s.user_profile_search,k,function(o){var l=o||{};console.log("user_profile result >>",l);if(CommonService.isSuccess(l)){j.fireEvent("finish",l);x()}else{o=String.format(q.validate.is_not_found,
q.task.profileInfo);m("error",q.constant.warning_title,o)}},{mask:j.id,msg:iNet.resources.ajaxLoading.loading})}.createDelegate(this),x=function(){j.hide()};u.submit.on("click",v);u.close.on("click",x)};iNet.extend(iNet.ui.task.TMUserProfile,iNet.Component);iNet.ui.task.TRequest=function(){this.id="task-request-div";var h=this,j={htmlHidden:'<div class="hide"><input type="text" name="{0}" value="{1}"></div>',htmlAttachment:function(){var b="";b+='<li file-id="{0}" file-name="{1}" title="{1}">';b+=
'<div class="file-box">';b+='<div class="file">';b+='<span class="corner"></span>';b+='<div class="icon" style="display: none;"><i class="{2}"></i></div>';b+='<div class="file-name">';b+='<div class="file-text"><i class="{2}"></i> {3}</div>';b+='<div class="file-size" file-size="{5}"><small>{4}</small></div>';b+='<div class="file-action" style="padding: 5px;display: flex;">';b+='<a href="'+m.downloadFile+'?binary={0}" title="'+e.global.fileDownload+'" data-id="{6}" style="width: 100%;border: 1px solid #DDD;border-radius: 15px;float: right;text-align: center;margin-left: 2px;padding-top: 3px;padding-bottom: 3px;">';
b+='<i class="ace-icon icon-download-alt"></i>';b+="</a>";b+="</div>";b+="</div>";b+="</a>";b+="</div>";b+="</div>";b+="</li>";return b},info:{},item:{},isRefresh:false,receiptNo:"",profileType:"citizen"},q=null,e={task:iNet.resources.receiver.task,global:iNet.resources.global,errors:iNet.resources.errors,constant:iNet.resources.constant,validate:iNet.resources.validate},m={new_request:iNet.getUrl("firmtask/process/request"),task_tree:iNet.getUrl("onegate/additional/tasktree"),create_request:iNet.getUrl("onegate/process/request"),
appointment_request:iNet.getUrl("onegate/ticket/appointment"),submit_request:iNet.getUrl("onegate/process/submit"),user_profile_load:iNet.getUrl("onegate/userprofile/load"),user_profile_search:iNet.getUrl("onegate/userprofile/search"),user_profile_filter:iNet.getUrl("onegate/userprofile/filter"),downloadFile:iNet.getUrl("onegate/binary/download"),load_user:iNet.getUrl("system/account/role"),receiverPlace:iNet.getUrl("onegate/deptrecord/receiverplace"),receiverno:iNet.getUrl("onegate/deptrecord/receiverno"),
receiverBookList:iNet.getUrl("onegate/recordbook/list"),receiverBookCount:iNet.getUrl("onegate/recordbook/count")},s={ajaxTask:$("#ajax-mask"),requestTask:$("#task-request")},a={requestTaskDiv:$("#task-request"),requestTaskContent:$("#task-request-content"),requestTaskForm:$("#task-request-item-form"),requestTaskFormContent:$("#task-request-form-content"),requestTaskFormContentHidden:$("#task-request-form-content-hidden"),requestTaskFormAttachment:$("#task-request-form-attachment-info"),requestTaskFormAttachmentNumber:$("#task-request-form-attach-brief-number"),
requestTaskFormAttachmentList:$("#task-request-form-attach-brief-list"),requestTaskDataInfo:$("#task-request-data-info"),requestTaskDataContent:$("#task-request-data-content"),requestTaskProcedureInfo:$("#task-request-procedure-info"),requestTaskProcedureContent:$("#task-request-procedure-content"),requestTaskProcedure:$("#task-request-procedure"),requestTaskReceiptNoLoad:$('[data-action="load-receipt-no"]'),requestTaskReceiptInfo:$("#task-request-receipt-info"),requestTaskReceiptMoreInfo:$("#task-request-receipt-more-info"),
requestTaskReceiptShowInfo:$("#task-request-receipt-show-info"),requestTaskReceiptHideInfo:$("#task-request-receipt-hide-info"),requestTaskReceiptContent:$("#task-request-receipt-content"),requestTaskReceiptNo:$("#task-request-receiptNo"),requestTaskAppointment:$("#task-request-appointment"),requestTaskAppointmentHour:$("#task-request-appointment-hour"),requestTaskExclusive:$("#task-request-exclusive"),requestTaskMembers:$("#task-request-members"),requestTaskHour:$("#task-request-hour"),requestTaskSubject:$("#task-request-subject"),
requestTaskNumberOfRecord:$("#task-request-numberOfRecord"),requestTaskIsPostOfficeSelect:$("#task-request-ispostoffice-select"),requestTaskIsPostOffice:$("#task-request-ispostoffice"),requestTaskReceverPlaceSelect:$("#task-request-receiverPlace-select"),requestTaskRecordBookLoad:$('[data-action="load-receipt-recordBook"]'),requestTaskRecordBookList:$("#task-request-recordBook-list"),requestTaskRecordBook:$("#task-request-recordBook"),requestTaskRecordOrder:$("#task-request-recordOrder"),requestTaskUPClickSearch:$('[data-action="click-search-user-profile"]'),
requestTaskUPKeyupSearch:$('[data-action="keyup-search-user-profile"]'),requestTaskUPInfo:$("#task-request-user-profile-info"),requestTaskUPCitizen:$("#task-request-user-profile-citizen"),requestTaskUPOrgan:$("#task-request-user-profile-organ"),requestTaskUPRandomInfo:$("#task-request-user-profile-random-info"),requestTaskUPMoreInfo01:$("#task-request-user-profile-more-info-01"),requestTaskUPMoreInfo02:$("#task-request-user-profile-more-info-02"),requestTaskUPShowInfo:$("#task-request-user-profile-show-info"),
requestTaskUPHideInfo:$("#task-request-user-profile-hide-info"),requestTaskUPContent:$("#task-request-user-profile-content"),requestTaskUPFullName:$("#task-request-user-profile-fullname"),requestTaskUPBirthday:$("#task-request-user-profile-birthday"),requestTaskUPIdentity:$("#task-request-user-profile-identity"),requestTaskUPIdDateOfIssue:$("#task-request-user-profile-idDateOfIssue"),requestTaskUPIdPlaceOfIssuse:$("#task-request-user-profile-idPlaceOfIssuse"),requestTaskUPRegion:$("#task-request-user-profile-region"),
requestTaskUPNationality:$("#task-request-user-profile-nationality"),requestTaskUPOtherNumber:$("#task-request-user-profile-otherNumber"),requestTaskUPOtherDateOfIssue:$("#task-request-user-profile-otherDateOfIssue"),requestTaskUPOtherPlaceOfIssuse:$("#task-request-user-profile-otherPlaceOfIssuse"),requestTaskUPAddress1:$("#task-request-user-profile-address1"),requestTaskUPAddress2:$("#task-request-user-profile-address2"),requestTaskUPSmobile:$("#task-request-user-profile-smobile"),requestTaskUPMale:$("#task-request-user-profile-sex-male"),
requestTaskUPFemale:$("#task-request-user-profile-sex-female"),requestTaskUPEmail:$("#task-request-user-profile-email"),requestTaskUPSearchContent:$("#task-request-user-profile-search-content"),requestTaskUPTable:$("#task-request-user-profile-list"),requestTaskUPRowTemplate:$("#task-request-user-profile-row-template")};a.requestTaskUPCitizen.prop("checked",true);var u={REQUEST_SUBMIT:$("#task-request-submit-btn"),REQUEST_SAVE:$("#task-request-save-btn"),REQUEST_BACK:$("#task-request-back-btn")},v=
[{id:"false",code:"false",name:e.task.receiverInOrgan},{id:"true",code:"true",name:e.task.receiverInPostOffice}];a.requestTaskIsPostOfficeSelect=FormService.createSelect("task-request-ispostoffice-select",v,"id",1,false,false);a.requestTaskIsPostOfficeSelect.setValue("false");var x=[{id:"UNIT",code:"UNIT",name:e.task.receiverPlaceUNIT},{id:"CENTER",code:"CENTER",name:e.task.receiverPlaceCENTER}];a.requestTaskReceverPlaceSelect=FormService.createSelect("task-request-receiverPlace-select",x,"id",1,
false,false);a.requestTaskReceverPlaceSelect.setValue("UNIT");a.requestTaskReceverPlaceSelect.on("change",function(){FormService.appendHiddenField(a.requestTaskFormContentHidden,"receiverPlace",a.requestTaskReceverPlaceSelect.getValue())});(function(){$.postJSON(m.receiverPlace,{},function(b){if(!iNet.isEmpty(b)){a.requestTaskReceverPlaceSelect.setValue(b);FormService.appendHiddenField(a.requestTaskFormContentHidden,"receiverPlace",b)}})})();var k=function(b,c){if(q==null)q=new iNet.ui.dialog.ModalDialog({id:iNet.generateId(),
title:e.task.printTitle||"",content:"",buttons:[{text:iNet.resources.message.button.ok,cls:"btn-primary",icon:"icon-ok icon-white",fn:function(){window.open(iNet.getUrl(CommonService.pageRequest.formNo03)+"?task="+this.taskID,"_blank");this.hide()}},{text:iNet.resources.message.button.cancel,cls:"btn-default",icon:"icon-remove",fn:function(){this.hide()}}]});q.setContent(String.format(e.task.printReceiptNo||"{0}",b));q.taskID=c;q.show()},o=function(){try{iNet.getLayout().$iframe.height($(iNet.getLayout().window).height()-
90)}catch(b){}a.requestTaskContent.height($(window).height()-45)},l=function(b,c){c=c||"";if(b.hasClass("hide"))c!="hide"&&b.removeClass("hide");else c!="show"&&b.addClass("hide")},L=function(b){a.requestTaskProcedure=FormService.createSelect("task-request-procedure",[],"id",1,false,false);a.requestTaskProcedure.setValue(b||"");w();$.postJSON(m.task_tree,{},function(c){var d=c||{};if(CommonService.isSuccess(d)){var f=[],i=false;$.each(d.elements||[],function(g,n){if(n.assigned){f.push({id:n.uimap.procedureID,
code:n.uimap.procedureID,name:n.uimap.procedureName,data:n});if((b||"")==n.uimap.procedureID)i=true}});a.requestTaskProcedure=FormService.createSelect("task-request-procedure",f,"id",1,false,false);a.requestTaskProcedure.setValue(b||"");if(!iNet.isEmpty(b||"")){F();G()}i?a.requestTaskProcedure.disable():a.requestTaskProcedure.enable();a.requestTaskProcedure.on("change",function(){F();G()})}})},M=function(){a.requestTaskExclusive=FormService.createSelect("task-request-exclusive",[],"id",1,true,true);
$.postJSON(m.load_user,{},function(b){var c=b||{};if(CommonService.isSuccess(c)){var d=[];$.each(c.items||[],function(f,i){d.push({id:i.username,code:i.username,name:i.fullname})});a.requestTaskExclusive.setValue("");a.requestTaskExclusive=FormService.createSelect("task-request-exclusive",d,"id",1,true,true)}})},G=function(){var b=a.requestTaskProcedure.getData()||{},c=(j.item.pkgdata||{}).uuid||"";w();a.requestTaskReceiptNoLoad.trigger("click");iNet.isEmpty(c)?$.postJSON(m.appointment_request,{procedureID:b.id},
function(d){if(CommonService.isSuccess(d)){a.requestTaskAppointment.val((d.appointment||0).longToDate());a.requestTaskAppointmentHour.val((new Date(d.appointment||0)).format("H:m"));a.requestTaskHour.val(d.hour||0);l(a.requestTaskReceiptContent,"show")}else h.notifyError(e.constant.warning_title,h.getNotifyContent(e.constant.warning_error,d.errors||[]))}):$.postJSON(m.appointment_request,{additionalID:c},function(d){console.log("appointment_request result >>",d);if(CommonService.isSuccess(d)){a.requestTaskAppointment.val((d.appointment||
0).longToDate());a.requestTaskAppointmentHour.val((new Date(d.appointment||0)).format("H:m"));a.requestTaskHour.val(d.hour||0)}else h.notifyError(e.constant.warning_title,h.getNotifyContent(e.constant.warning_error,d.errors||[]))})},F=function(){var b=a.requestTaskProcedure.getData()||{},c=((b.data||{}).uimap||{}).taskUI||"";if(!iNet.isEmpty(c)){var d={form:c,zone:iNet.zone,context:iNet.context},f=(j.item.pkgdata||{}).uuid||"";if(iNet.isEmpty(f))$.postJSON(m.new_request,d,function(i){var g=i||{};
console.log("loadRequestByProcedure result >>",g);if(CommonService.isSuccess(g)){var n=g.content;a.requestTaskFormAttachment.addClass("hide");a.requestTaskFormContent.html("");FormService.appendHiddenField(a.requestTaskFormContentHidden,"zone",iNet.zone);FormService.appendHiddenField(a.requestTaskFormContentHidden,"context",iNet.context);FormService.appendHiddenField(a.requestTaskFormContentHidden,"form",g.formID);FormService.appendHiddenField(a.requestTaskFormContentHidden,"procedureID",b.id);H(g.nodeInfo||
[]);I(a.requestTaskFormContent,n);l(a.requestTaskDataContent,"show")}else h.notifyError(e.constant.warning_title,h.getNotifyContent(e.constant.warning_error,g.errors||[]))},{mask:s.requestTask,msg:iNet.resources.ajaxLoading.loading});else{d.additionalID=f;$.postJSON(m.create_request,d,function(i){var g=i||{};console.log("create_request result >>",g);if(CommonService.isSuccess(g)){var n=g.content;a.requestTaskFormAttachment.addClass("hide");FormService.appendHiddenField(a.requestTaskFormContentHidden,
"zone",iNet.zone);FormService.appendHiddenField(a.requestTaskFormContentHidden,"context",iNet.context);FormService.appendHiddenField(a.requestTaskFormContentHidden,"form",g.formID);H(g.nodeInfo||[]);I(a.requestTaskFormContent,n);var t="",r=0;if((g.attachments||[]).length>0){$.each(g.attachments||[],function(S,p){var y=p.contentID||p.gridfsUUID||"",B=p.file||p.filename||"";a.requestTaskFormContent.find('[data-control="File"]').each(function(T,C){var N=$(C).find('[property-value="'+p.fieldname+'"]');
if(N.length>0){$(C).find("[data-container]").html('<a href="'+m.downloadFile+"?binary="+y+'"><i class="'+iNet.FileFormat.getFileIcon(B)+'"></i> '+B+" - "+iNet.FileFormat.getSize(p.size||0)+"</a>");$(C).find('[name="'+p.fieldname+'"]').attr("value",y)}});console.log(">> attachment >>",p.fieldname,a.requestTaskFormContent.find('[data-control="File"][name="'+p.fieldname+'"]').length==0);if(a.requestTaskFormContent.find('[data-control="File"][name="'+p.fieldname+'"]').length==0){r++;t+=String.format(j.htmlAttachment(),
y,p.fieldname,iNet.FileFormat.getFileIcon(p.mimetype),B,iNet.FileFormat.getSize(p.size||0),(p.size||0).toString(),y)}});console.log(">> __htmlAttachment >>",t);if(!iNet.isEmpty(t)){a.requestTaskFormAttachment.removeClass("hide");a.requestTaskFormAttachmentNumber.text(r);a.requestTaskFormAttachmentList.html(t)}}}else h.notifyError(e.constant.warning_title,h.getNotifyContent(e.constant.warning_error,g.errors||[]))})}}},w=function(){var b=a.requestTaskProcedure.getData()||{},c=a.requestTaskUPFullName.val()||
"",d=b.name||"";iNet.isEmpty(c)||(d+=" - "+c);a.requestTaskSubject.val(d)},O=function(){var b=(j.item.pkgdata||{}).uuid||"",c=((j.item.pkgdata||{}).requestData||{}).procedureID||"",d=((j.item.pkgdata||{}).requestData||{}).profileID||"",f=((j.item.pkgdata||{}).requestData||{}).isPostOffice||"false";a.requestTaskDiv.show();l(a.requestTaskProcedureContent,"show");l(a.requestTaskUPContent,"show");l(a.requestTaskReceiptContent,"hide");l(a.requestTaskDataContent,"hide");FormService.createDate(a.requestTaskUPIdDateOfIssue);
FormService.createDate(a.requestTaskUPOtherDateOfIssue);FormService.createDate(a.requestTaskAppointment);a.requestTaskAppointmentHour.timepicker({minuteStep:1,showSeconds:false,showMeridian:false});a.requestTaskFormContent.html("");a.requestTaskFormContentHidden.html("");a.requestTaskSubject.val("");a.requestTaskReceiptNo.val("");a.requestTaskNumberOfRecord.val(1);a.requestTaskRecordBook.val("");a.requestTaskRecordOrder.val(1);a.requestTaskAppointment.val((new Date).format("d/m/Y"));a.requestTaskAppointmentHour.val((new Date).format("H:m"));
a.requestTaskHour.val((new Date).getTime());a.requestTaskIsPostOfficeSelect.setValue("false");D("");a.requestTaskIsPostOfficeSelect.setValue(f);M();L(c);if(iNet.isEmpty(d)){E({});a.requestTaskUPIdentity.removeAttr("disabled");a.requestTaskUPBirthday.removeAttr("disabled")}else $.postJSON(m.user_profile_load,{profileID:d},function(i){E(i);a.requestTaskUPIdentity.attr("disabled","disabled");a.requestTaskUPBirthday.attr("disabled","disabled")});if(!iNet.isEmpty(b)){l(a.requestTaskProcedureContent,"show");
l(a.requestTaskUPContent,"show");l(a.requestTaskReceiptContent,"show");l(a.requestTaskDataContent,"show");FormService.appendHiddenField(a.requestTaskFormContentHidden,"additionalID",b)}o()},P=function(){if(iNet.isEmpty(a.requestTaskReceiptNo.val())||iNet.isEmpty(a.requestTaskAppointment.val())||iNet.isEmpty(a.requestTaskSubject.val())){var b="\n";if(iNet.isEmpty(a.requestTaskReceiptNo.val()))b+=e.task.receiptNo+"\n";if(iNet.isEmpty(a.requestTaskSubject.val()))b+=e.task.subject+"\n";if(iNet.isEmpty(a.requestTaskAppointment.val()))b+=
e.task.appointmentDate+"\n";h.notifyError(e.constant.warning_title,String.format(e.constant.warning_error,b));return false}var c=a.requestTaskAppointment.val().dateToLong(),d=new Date(c),f=a.requestTaskAppointmentHour.val();if(f.split(":").length==2){iNet.isNumber(Number(f.split(":")[0]))&&d.setHours(Number(f.split(":")[0]));iNet.isNumber(Number(f.split(":")[1]))&&d.setMinutes(Number(f.split(":")[1]))}console.log(">> __dateAppointment >>",d.getTime(),d.format("d/m/Y H:m"));FormService.appendHiddenField(a.requestTaskFormContentHidden,
"receiptNo",a.requestTaskReceiptNo.val());FormService.appendHiddenField(a.requestTaskFormContentHidden,"appointment",d.getTime());FormService.appendHiddenField(a.requestTaskFormContentHidden,"hour",a.requestTaskHour.val());FormService.appendHiddenField(a.requestTaskFormContentHidden,"exclusive",a.requestTaskExclusive.getValue().toString());FormService.appendHiddenField(a.requestTaskFormContentHidden,"subject",a.requestTaskSubject.val());FormService.appendHiddenField(a.requestTaskFormContentHidden,
"numberOfRecord",a.requestTaskNumberOfRecord.val());FormService.appendHiddenField(a.requestTaskFormContentHidden,"recordBook",a.requestTaskRecordBook.val());FormService.appendHiddenField(a.requestTaskFormContentHidden,"recordOrder",a.requestTaskRecordOrder.val());FormService.appendHiddenField(a.requestTaskFormContentHidden,"isPostOffice",a.requestTaskIsPostOfficeSelect.getValue());var i=[];a.requestTaskMembers.find('[type="checkbox"]').each(function(g,n){$(n).prop("checked")&&i.push({username:$(n).attr("data-member"),
role:"",direction:"",nodeName:$(n).attr("data-nodeName")})});console.log("members >>",iNet.JSON.encode(i));FormService.appendHiddenField(a.requestTaskFormContentHidden,"member",iNet.JSON.encode(i).replace(/"/gi,"'"));return true},Q=function(){var b=!iNet.isFunction(((iNet||{}).requestData||{}).messageValidate)?"":((iNet||{}).requestData||{}).messageValidate();console.log(">> submitRequest validate >>",{messageValidate:b});if(iNet.isEmpty(b)){s.ajaxTask.show();a.requestTaskForm.ajaxSubmit({url:m.submit_request,
beforeSubmit:function(){},uploadProgress:function(){},success:function(){},complete:function(c){s.ajaxTask.hide();var d=c.responseJSON||{},f=c.responseText||{};console.log(">> submitRequest result >>",d,iNet.isEmpty(d.uuid));if(iNet.isEmpty(d.uuid)){j.isRefresh="";h.notifyError(e.constant.submit_title,h.getNotifyContent(e.constant.submit_error,d.errors||[]))}else{k(d.subject,d.uuid);h.notifySuccess(e.constant.submit_title,e.constant.submit_success);j.isRefresh=true;u.REQUEST_BACK.trigger("click")}}})}else{h.notifyError(e.constant.warning_title,
b);s.ajaxTask.hide()}},J=function(b){var c=function(){if(P()){FormService.appendHiddenField(a.requestTaskFormContentHidden,"saveAsDraft",b);Q()}};R(c)},z=function(b){a.requestTaskUPContent.find('[data-profile="'+b+'"]').show();a.requestTaskUPSearchContent.find('[data-profile="'+b+'"]').show()},A=function(b){a.requestTaskUPContent.find('[data-profile="'+b+'"]').hide();a.requestTaskUPSearchContent.find('[data-profile="'+b+'"]').hide()},E=function(b){var c=b||{};a.requestTaskUPAddress1.val(c.address1||
"");a.requestTaskUPAddress2.val(c.address2||"");a.requestTaskUPBirthday.val(c.birthday||"");a.requestTaskUPEmail.val(c.email||"");a.requestTaskUPFullName.val(c.fullname||"");a.requestTaskUPIdDateOfIssue.val(c.idDateOfIssue||"");a.requestTaskUPIdentity.val(c.identity||"");a.requestTaskUPIdPlaceOfIssuse.val(c.idPlaceOfIssuse||"");a.requestTaskUPNationality.val(c.nationality||e.task.userprofileNationality);a.requestTaskUPOtherDateOfIssue.val(c.otherDateOfIssue||"");a.requestTaskUPOtherNumber.val(c.otherNumber||
"");a.requestTaskUPOtherPlaceOfIssuse.val(c.otherPlaceOfIssuse||"");a.requestTaskUPRegion.val(c.region||(j.profileType=="citizen"?e.task.userprofileRegion:""));a.requestTaskUPSmobile.val(c.mobile||"");a.requestTaskUPFemale.prop("checked",c.sex=="Nu"||c.sex=="TNHH"||(c.sex||"")=="");a.requestTaskUPFemale.prop("checked")||a.requestTaskUPMale.prop("checked",true);if(c.company=="DN"){a.requestTaskUPOrgan.prop("checked",true);z("organ");A("citizen")}else{a.requestTaskUPCitizen.prop("checked",true);z("citizen");
A("organ")}w()},R=function(b){var c={address1:a.requestTaskUPAddress1.val(),address2:a.requestTaskUPAddress2.val(),birthday:a.requestTaskUPBirthday.val(),email:a.requestTaskUPEmail.val(),fullname:a.requestTaskUPFullName.val(),idDateOfIssue:a.requestTaskUPIdDateOfIssue.val(),identity:a.requestTaskUPIdentity.val(),idPlaceOfIssuse:a.requestTaskUPIdPlaceOfIssuse.val(),nationality:a.requestTaskUPNationality.val(),otherDateOfIssue:a.requestTaskUPOtherDateOfIssue.val(),otherNumber:a.requestTaskUPOtherNumber.val(),
otherPlaceOfIssuse:a.requestTaskUPOtherPlaceOfIssuse.val(),region:a.requestTaskUPRegion.val(),mobile:a.requestTaskUPSmobile.val()};if(a.requestTaskUPCitizen.prop("checked")){c.sex="Nam";c.company="CN";if(a.requestTaskUPFemale.prop("checked"))c.sex="Nu"}else{c.sex="CP";c.company="DN";if(a.requestTaskUPFemale.prop("checked"))c.sex="TNHH"}if(iNet.isEmpty(c.fullname)||iNet.isEmpty(c.birthday)||iNet.isEmpty(c.identity)||iNet.isEmpty(c.address1)){s.ajaxTask.hide();h.notifyError(e.constant.warning_title,
String.format(e.constant.warning_error,e.task.userprofileInfo))}else $.postJSON(m.user_profile_search,c,function(d){var f=d||{};console.log("user_profile result >>",f,iNet.isFunction(b));if(CommonService.isSuccess(f)){var i=f.uuid||"";FormService.appendHiddenField(a.requestTaskFormContentHidden,"profileID",i);iNet.isFunction(b)&&b()}else{s.ajaxTask.hide();h.notifyError(e.constant.submit_title,h.getNotifyContent(e.constant.submit_error,f.errors||[]))}})},K=function(b){if(iNet.isEmpty(a.requestTaskUPIdentity.attr("disabled"))){a.requestTaskUPContent.hide();
a.requestTaskUPSearchContent.show();var c=b||"",d={};d.identity=a.requestTaskUPIdentity.val();d.birthday=a.requestTaskUPBirthday.val();d.fullname=a.requestTaskUPFullName.val();if(!iNet.isEmpty(c)){if(c=="fullname"){delete d.birthday;delete d.identity}if(c=="birthday"){delete d.fullname;delete d.identity}if(c=="identity"){delete d.birthday;delete d.fullname}}d.company=a.requestTaskUPOrgan.prop("checked")?"DN":"CN";$.postJSON(m.user_profile_filter,d,function(f){var i=f||{},g=i.items||[];a.requestTaskUPTable.find("tbody").html("");
$.each(g,function(n,t){for(var r in t)a.requestTaskUPRowTemplate.find('[data-type="'+r+'"]').text(t[r]);a.requestTaskUPTable.find("tbody").append("<tr>"+a.requestTaskUPRowTemplate.html()+"</tr>")});a.requestTaskUPTable.find("[data-action]").unbind();a.requestTaskUPTable.find('[data-action="close"]').on("click",function(){a.requestTaskUPContent.show();a.requestTaskUPSearchContent.hide()});a.requestTaskUPTable.find('[data-action="select"]').on("click",function(){a.requestTaskUPContent.show();a.requestTaskUPSearchContent.hide();
var n=$(this).parent().find('[data-type="uuid"]').text();$(g).each(function(t,r){r.uuid==n&&E(r)})});g.length==1&&a.requestTaskUPTable.find('[data-action="select"]:first').trigger("click")})}},D=function(b){$.postJSON(m.receiverBookCount,{recordBook:b},function(c){var d=c||{};console.log("receiverBookCount result >>",d);if(CommonService.isSuccess(d))a.requestTaskRecordOrder.val(d.recordOrder||1)})};a.requestTaskRecordBook.on("change",function(){D(a.requestTaskRecordBook.val())});a.requestTaskUPFullName.on("change",
function(){w()});a.requestTaskProcedureInfo.on("click",function(){l(a.requestTaskProcedureContent)});a.requestTaskDataInfo.on("click",function(){l(a.requestTaskDataContent)});a.requestTaskUPInfo.on("click",function(){l(a.requestTaskUPContent)});a.requestTaskUPRandomInfo.on("click",function(){if(iNet.isEmpty(a.requestTaskUPIdentity.attr("disabled"))){a.requestTaskUPFullName.val(e.task.userprofileRandomFullname);a.requestTaskUPIdentity.val("unk"+iNet.generateId().substring(0,6));a.requestTaskUPBirthday.val(e.task.userprofileRandomBirthday);
a.requestTaskUPAddress1.val(e.task.userprofileRandomAddress1);w()}});a.requestTaskUPShowInfo.on("click",function(){a.requestTaskUPMoreInfo01.show();a.requestTaskUPMoreInfo02.show();a.requestTaskUPShowInfo.hide();a.requestTaskUPHideInfo.show()});a.requestTaskUPHideInfo.on("click",function(){a.requestTaskUPMoreInfo01.hide();a.requestTaskUPMoreInfo02.hide();a.requestTaskUPShowInfo.show();a.requestTaskUPHideInfo.hide()});a.requestTaskUPClickSearch.on("click",function(){var b=$(this).attr("data-searchId")||
"";K(b)});a.requestTaskUPKeyupSearch.on("keyup",function(b){if(b.which==13){var c=$(this).attr("data-searchId")||"";K(c)}});a.requestTaskUPCitizen.on("click",function(){j.profileType="citizen";a.requestTaskUPRegion.val()==""&&a.requestTaskUPRegion.val(e.task.userprofileRegion);z("citizen");A("organ")});a.requestTaskUPOrgan.on("click",function(){j.profileType="organ";a.requestTaskUPRegion.val()==e.task.userprofileRegion&&a.requestTaskUPRegion.val("");z("organ");A("citizen")});a.requestTaskReceiptInfo.on("click",
function(){l(a.requestTaskReceiptContent)});a.requestTaskReceiptShowInfo.on("click",function(){a.requestTaskReceiptMoreInfo.show();a.requestTaskReceiptShowInfo.hide();a.requestTaskReceiptHideInfo.show()});a.requestTaskReceiptHideInfo.on("click",function(){a.requestTaskReceiptMoreInfo.hide();a.requestTaskReceiptShowInfo.show();a.requestTaskReceiptHideInfo.hide()});a.requestTaskReceiptNoLoad.on("click",function(){$.postJSON(m.receiverno,{},function(b){var c=b||(new Date).format("YmdHis");a.requestTaskReceiptNo.val(c)})});
a.requestTaskRecordBookLoad.on("click",function(){if(a.requestTaskRecordBookLoad.parent().hasClass("open"))a.requestTaskRecordBookLoad.parent().removeClass("open");else{a.requestTaskRecordBookList.width($($(this).parent()).width());a.requestTaskRecordBookList.html("");$.postJSON(m.receiverBookList,{},function(b){var c=b||{};$.each(c.elements,function(d,f){iNet.isEmpty(f)||a.requestTaskRecordBookList.append(String.format('<tr style="cursor: pointer; height: 30px;"><td style="padding: 5px;">{0}</td></tr>',
f))});a.requestTaskRecordBookLoad.parent().addClass("open");a.requestTaskRecordBookList.find("tr").on("click",function(){var d=$(this).find("td:first").text();a.requestTaskRecordBook.val(d);D(d);a.requestTaskRecordBookLoad.parent().removeClass("open")})})}});a.requestTaskUPBirthday.on("change",function(){iNet.isEmpty(a.requestTaskUPBirthday.val())||FormService.validateDate(a.requestTaskUPBirthday.val())||a.requestTaskUPBirthday.val("")});a.requestTaskUPBirthday.on("keyup",function(){iNet.isEmpty(a.requestTaskUPBirthday.val())||
FormService.validateDate(a.requestTaskUPBirthday.val(),true)||a.requestTaskUPBirthday.val("")});u.REQUEST_SUBMIT.on("click",function(){s.ajaxTask.show();J(false)});u.REQUEST_SAVE.on("click",function(){s.ajaxTask.show();J(true)});u.REQUEST_BACK.on("click",function(){h.fireEvent("finish",j.isRefresh)}.createDelegate(this));var H=function(b){a.requestTaskMembers.html("");var c="",d=b||[];$.each(d,function(f,i){var g=i||{};c+='<ul style="list-style: none;margin-left: 0;">';c+='<li><span class="label label-xlg label-info"><i class="icon-chevron-sign-right"></i> '+
g.nodeName+"</span></li>";$.each(g.members||[],function(n,t){var r=t||{};c+='<ul style="list-style: none;margin-left: 0;">';c+="<li>";c+='    <div class="checkbox">';c+="        <label>";c+='            <input type="checkbox" data-nodeName="'+g.nodeName+'" data-member="'+r.usercode+'" value="" class="ace" style="display: none;">';c+='            <span class="lbl"> '+r.username+"</span>";c+="        </label>";c+="    </div>";c+="</li>";c+="</ul>"});c+="</ul>"});a.requestTaskMembers.html(c)},I=function(b,
c){b.html(c);for(var d=1;d<=12;d++){b.find(".col-md-"+d).removeClass("col-md-"+d);b.find(".col-xs-"+d).removeClass("col-xs-"+d);b.find(".col-sm-"+d).removeClass("col-sm-"+d)}b.find(".row").removeClass("row");PublicService.PageScript(b)};this.setData=function(b){var c=b||{};j.item=c.item||{};j.info=c.info||{};j.isRefresh="";O();$("html").css("overflow","hidden")};$(iNet.getLayout()).on("resize",function(){o()});iNet.ui.task.TRequest.superclass.constructor.call(this)};iNet.extend(iNet.ui.task.TRequest,
iNet.ui.app.widget)});
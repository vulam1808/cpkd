$(function(){iNet.ns("iNet.ui.builder","iNet.ui.builder.TPageList","iNet.ui.builder.TPageCopy");iNet.ui.builder.TPageCopy=function(){this.id="page-list-modal-copy";var j=$("#page-list-modal-copy"),i=this,b={name:$("#page-list-modal-copy-name")},l={submit:$("#page-list-modal-copy-submit-btn"),close:$("#page-list-modal-copy-close-btn")};this.show=function(){b.name.val("");j.modal("show")};this.hide=function(){j.modal("hide")};var m=function(){i.fireEvent("finish",b.name.val());i.hide()}.createDelegate(this);
l.submit.on("click",m);l.close.on("click",function(){i.hide()})};iNet.extend(iNet.ui.builder.TPageCopy,iNet.Component);iNet.ui.builder.TPageList=function(){this.id="page-list-div";console.log(">>>> C,E,D,V >>>> ",roleCreate,roleEdit,roleDelete,roleView);var j=iNet.zone,i=iNet.context,b=this,l={},m=null,n=null,r=null,c={page:iNet.resources.builder.page,global:iNet.resources.global,errors:iNet.resources.errors,constant:iNet.resources.constant,validate:iNet.resources.validate},g={CREATE:$("#page-list-create-btn"),
DELETE:$("#page-list-delete-btn"),COPY:$("#page-list-copy-btn")};g.DELETE.hide();g.COPY.hide();roleCreate?g.CREATE.show():g.CREATE.hide();var p={view:iNet.getUrl("design/page/list"),create:iNet.getUrl("design/page/create"),copy:iNet.getUrl("design/page/copy"),update:iNet.getUrl("design/page/update"),del:iNet.getUrl("design/page/delete")},q=this.confirmDialog(iNet.resources.message.dialog_confirm_title,b.getNotifyContent(c.constant.del_content,r),function(){if(!iNet.isEmpty(n)){q.hide();$.postJSON(p.del,
{zone:j,context:i,page:n},function(a){var d=a||{};if(CommonService.isSuccess(d)){var f=n.split(",");for(a=0;a<f.length;a++)e.remove(f[a]);n=null;g.DELETE.hide();b.notifySuccess(c.constant.del_title,c.constant.del_success)}else b.notifyError(c.constant.del_title,b.getNotifyContent(c.constant.del_error,d.errors||[]))},{mask:b.getMask(),msg:iNet.resources.ajaxLoading.deleting})}}),w=new DataSource({columns:[{property:"name",label:c.page.name,sortable:true,disabled:true,type:"text",validate:function(a){if($.trim(a)==
"")return String.format(c.validate.is_not_blank,c.page.name)}},{property:"creator",label:c.page.creator,sortable:true,disabled:true,type:"text",width:200},{label:"",type:"action",width:32,align:"center",buttons:[{text:iNet.resources.message.button.edit,icon:"icon-pencil",labelCls:"label label-success",fn:function(a){b.hide();var d=u();d.loadData(a);d.setPageBack(b);d.show()}},{text:iNet.resources.message.button.upload,icon:"icon-cloud-upload",labelCls:"label label-info",fn:function(a){v(a)}},{text:iNet.resources.message.button.del,
icon:"icon-trash",labelCls:"label label-important",fn:function(a){n=a.uuid.toString();r=a.name;q.setContent(String.format(c.constant.del_content,r));q.show()},visibled:function(a){var d=a||{};if(roleDelete)return true;return false}}]}],delay:250}),e=new iNet.ui.grid.Grid({id:"page-list-grid",url:p.view,params:{zone:j,context:i},convertData:function(a){var d=a||{},f=d.items||[];return f},dataSource:w,stretchHeight:false,editable:roleEdit,firstLoad:roleView,hideHeader:!roleView,hideSearch:!roleView,
idProperty:"uuid"});roleView||e.loadData([]);e.on("save",function(a){var d=a||{};d.zone=j;d.context=i;$.postJSON(p.create,d,function(f){var h=f||{};if(CommonService.isSuccess(h)){e.insert(h);b.notifySuccess(c.constant.save_title,c.constant.save_success)}else b.notifyError(c.constant.save_title,b.getNotifyContent(c.constant.save_error,h.errors||[]))})});e.on("update",function(a,d){var f=iNet.apply(d,a)||{};f.zone=j;f.context=i;$.postJSON(p.update,f,function(h){var k=h||{};if(CommonService.isSuccess(k)){e.update(k);
e.commit();b.notifySuccess(c.constant.save_title,c.constant.save_success)}else b.notifyError(c.constant.save_title,b.getNotifyContent(c.constant.save_error,k.errors||[]))},{msg:iNet.resources.ajaxLoading.updating,mask:b.getMask()})});e.on("blur",function(a,d){a=="update"?e.endEdit():d.save()});e.on("selectionchange",function(a){a=a.getSelection();for(var d=a.length,f=[],h=[],k=0;k<d;k++){var t=a[k];f.push(t.id);h.push(t.name)}n=f.join(iNet.splitChar);r=h.join(iNet.splitChar)});e.on("loaded",function(){l=
{};g.COPY.hide()});e.on("click",function(a){l=a||{};g.COPY.show()});var s=null,u=function(){if(s==null){s=new iNet.ui.builder.TPage;s.on("finish",function(){if(roleView||roleCreate)e.load()})}return s},o=null,v=function(a){if(o==null){o=new iNet.ui.builder.Published;o.on("finish",function(){})}o.setPageBack(b);o.setData(a);o.show();b.hide()};g.CREATE.on("click",function(){g.DELETE.hide();e.newRecord();var a=e.getColumnModel().getColumnByName("name").getCellAdd(1);a.setDisabled(false);a.setValue("")});
g.DELETE.on("click",function(){q.setContent(iNet.resources.message.dialog_confirm_selected_content);q.show()});g.COPY.on("click",function(){if(m==null)m=new iNet.ui.builder.TPageCopy;m.on("finish",function(a){if(!iNet.isEmpty(a)){var d=l||{},f={page:d.uuid,name:a};$.postJSON(p.copy,f,function(h){if(CommonService.isSuccess(h)){b.notifySuccess(c.constant.submit_title,c.constant.submit_success);e.load()}else b.notifyError(c.constant.submit_title,b.getNotifyContent(c.constant.submit_error,h.errors||[]))},
{msg:iNet.resources.ajaxLoading.processing,mask:b.getMask()})}});m.show()});iNet.ui.builder.TPageList.superclass.constructor.call(this)};iNet.extend(iNet.ui.builder.TPageList,iNet.ui.app.widget);(new iNet.ui.builder.TPageList).show()});
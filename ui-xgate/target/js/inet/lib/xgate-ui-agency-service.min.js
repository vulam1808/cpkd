$(function(){iNet.ns("iNet.ui.admin","iNet.ui.admin.Agency");iNet.ui.admin.Agency=function(){this.id="agency-div";var e=this,i={},c={agency:iNet.resources.xgate.admin.agency,global:iNet.resources.global,errors:iNet.resources.errors,constant:iNet.resources.constant,validate:iNet.resources.validate},d={LINK:$("#agency-link-btn"),UNLINK:$("#agency-unlink-btn")},g={available:iNet.getUrl("onegate/expwayavailable"),accepted:iNet.getUrl("onegate/expwayaccepted"),unaccepted:iNet.getUrl("onegate/expwayunaccepted"),
firms:iNet.getUrl("onegate/expwayfirms")},n=function(){$.postJSON(g.firms,{},function(a){var b=a||{};console.log(">>firms>>",b);var j=b.items||[];$("#agency-grid").find("[data-check-connected]").each(function(p,f){var l=$(f).attr("data-check-connected")||"",m=false;if(!iNet.isEmpty(l))if(j.length>0)for(var k=0;k<=j.length-1;k++)if(j[k].organId==l){m=true;break}if(m){$(f).removeClass("icon-spinner icon-spin").addClass("icon-link");$(f).css("color","#2700FF")}else{$(f).removeClass("icon-spinner icon-spin").addClass("icon-unlink");
$(f).css("color","#D60505")}})})},o=new DataSource({columns:[{property:"organName",label:c.agency.organName,sortable:true,disabled:true},{property:"organAdd",label:c.agency.organAdd,sortable:true,disabled:true},{property:"email",label:c.agency.email,sortable:true,disabled:true},{property:"telephone",label:c.agency.telephone,sortable:true,disabled:true},{property:"fax",label:c.agency.fax,sortable:true,disabled:true},{property:"connected",label:'<i class="icon-exchange icon-large"></i>',sortable:true,
disabled:true,width:30}],delay:250}),h=new iNet.ui.grid.Grid({id:"agency-grid",url:g.available,params:{},convertData:function(a){var b=a||{};for(a=0;a<(b.elements||[]).length;a++)(b.elements[a]||{}).connected='<i data-check-connected="'+(b.elements[a]||{}).organId+'" class="icon-spinner icon-spin icon-large" style="color: #4387f5;"></i>';return b.elements},dataSource:o,stretchHeight:false,editable:false,firstLoad:true,idProperty:"uuid"});h.on("click",function(a){i=a;if($("#agency-grid").find('[data-check-connected="'+
a.organId+'"]').hasClass("icon-link")){d.LINK.hide();d.UNLINK.show()}else{d.LINK.show();d.UNLINK.hide()}});h.on("loaded",function(){n()});d.LINK.on("click",function(){$.postJSON(g.accepted,i,function(a){var b=a||{};console.log(">>accepted>>",b);if(CommonService.isSuccess(b)){d.LINK.hide();d.UNLINK.hide();h.load();e.notifySuccess(c.constant.submit_title,c.constant.submit_success)}else e.notifyError(c.constant.submit_title,e.getNotifyContent(c.constant.submit_error,b.errors||[]))})});d.UNLINK.on("click",
function(){$.postJSON(g.unaccepted,i,function(a){var b=a||{};console.log(">>unaccepted>>",b);if(CommonService.isSuccess(b)){d.LINK.hide();d.UNLINK.hide();h.load();e.notifySuccess(c.constant.submit_title,c.constant.submit_success)}else e.notifyError(c.constant.submit_title,e.getNotifyContent(c.constant.submit_error,b.errors||[]))})});iNet.ui.admin.Agency.superclass.constructor.call(this)};iNet.extend(iNet.ui.admin.Agency,iNet.ui.app.widget);(new iNet.ui.admin.Agency).show()});
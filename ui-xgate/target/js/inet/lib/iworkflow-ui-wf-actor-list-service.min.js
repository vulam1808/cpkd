$(function(){iNet.ns("iNet.ui.workflow","iNet.ui.workflow.WFActorList");iNet.ui.workflow.WFActorList=function(){this.id="actor-list-div";console.log(">>>> C,E,D,V >>>> ",roleCreate,roleEdit,roleDelete,roleView);var p=iNet.zone,q=iNet.context,f=this,j=null,k=null,d={actor:iNet.resources.workflow.actor,global:iNet.resources.global,errors:iNet.resources.errors,constant:iNet.resources.constant,validate:iNet.resources.validate},h={CREATE:$("#actor-list-create-btn"),DELETE:$("#actor-list-delete-btn")};
h.DELETE.hide();roleCreate?h.CREATE.show():h.CREATE.hide();var m={view:iNet.getUrl("cloud/workflow/alias/list"),create:iNet.getUrl("cloud/workflow/alias/create"),update:iNet.getUrl("cloud/workflow/alias/update"),del:iNet.getUrl("cloud/workflow/alias/delete")},l=this.confirmDialog(iNet.resources.message.dialog_confirm_title,f.getNotifyContent(d.constant.del_content,k),function(){if(!iNet.isEmpty(j)){l.hide();$.postJSON(m.del,{zone:p,context:q,actor:k},function(a){var b=a||{};if(CommonService.isSuccess(b)){var g=
j.split(",");for(a=0;a<g.length;a++)e.remove(g[a]);j=null;h.DELETE.hide();f.notifySuccess(d.constant.del_title,d.constant.del_success)}else f.notifyError(d.constant.del_title,f.getNotifyContent(d.constant.del_error,b.errors||[]))},{mask:f.getMask(),msg:iNet.resources.ajaxLoading.deleting})}}),r=new DataSource({columns:[{property:"name",label:d.actor.name,disabled:true,sortable:true,type:"text",validate:function(a){if($.trim(a)=="")return String.format(d.validate.is_not_blank,d.actor.name)},width:150},
{property:"position",label:d.actor.position,disabled:true,sortable:true,type:"text",width:150},{property:"brief",label:d.actor.brief,disabled:true,sortable:true,type:"text",width:150},{label:"",type:"action",width:32,align:"center",buttons:[{text:iNet.resources.message.button.del,icon:"icon-trash",labelCls:"label label-important",fn:function(a){j=a.uuid.toString();k=a.name;l.setContent(String.format(d.constant.del_content,k));l.show()},visibled:function(){return false}}]}],delay:250}),e=new iNet.ui.grid.Grid({id:"actor-list-grid",
url:m.view,params:{},convertData:function(a){var b=a||{};e.setTotal(b.total);a=b.items||[];$.each(a,function(g,c){c.name=c.code;c.position=(c.attribute||{}).position;c.brief=(c.attribute||{}).brief});return a},dataSource:r,stretchHeight:false,editable:roleEdit,firstLoad:roleView,hideHeader:!roleView,hideSearch:!roleView,idProperty:"uuid"});roleView||e.loadData([]);e.on("save",function(a){var b=a||{};b.code=b.name;$.postJSON(m.create,b,function(g){var c=g||{};if(CommonService.isSuccess(c)){c.name=
c.code;c.position=(c.attribute||{}).position;c.brief=(c.attribute||{}).brief;e.insert(c);n();f.notifySuccess(d.constant.save_title,d.constant.save_success)}else f.notifyError(d.constant.save_title,f.getNotifyContent(d.constant.save_error,c.errors||[]))})});e.on("update",function(a,b){var g=iNet.apply(b,a)||{};$.postJSON(m.update,g,function(c){var i=c||{};if(CommonService.isSuccess(i)){e.update(i);e.commit();f.notifySuccess(d.constant.save_title,d.constant.save_success)}else f.notifyError(d.constant.save_title,
f.getNotifyContent(d.constant.save_error,i.errors||[]))},{msg:iNet.resources.ajaxLoading.updating,mask:f.getMask()})});e.on("blur",function(a,b){a=="update"?e.endEdit():b.save()});e.on("selectionchange",function(a){a=a.getSelection();for(var b=a.length,g=[],c=[],i=0;i<b;i++){var o=a[i];g.push(o.uuid);c.push(o.name)}g.length>0&&roleDelete?h.DELETE.show():h.DELETE.hide();j=g.join(iNet.splitChar);k=c.join(iNet.splitChar)});var n=function(){e.newRecord();var a=e.getColumnModel(),b=a.getColumnByName("name").getCellAdd(1);
b.setDisabled(false);b.setValue("");b=a.getColumnByName("position").getCellAdd(1);b.setDisabled(false);b.setValue("");b=a.getColumnByName("brief").getCellAdd(1);b.setDisabled(false);b.setValue("")};h.CREATE.on("click",function(){h.DELETE.hide();n()});h.DELETE.on("click",function(){l.setContent(iNet.resources.message.dialog_confirm_selected_content);l.show()});iNet.ui.workflow.WFActorList.superclass.constructor.call(this)};iNet.extend(iNet.ui.workflow.WFActorList,iNet.ui.app.widget);(new iNet.ui.workflow.WFActorList).show()});
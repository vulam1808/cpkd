$(function(){iNet.ns("iNet.ui.workflow","iNet.ui.workflow.WFScript");iNet.ui.workflow.WFScript=function(){this.id="script-div";console.log(">>>> C,E,D,V >>>> ",roleCreate,roleEdit,roleDelete,roleView);var q=iNet.zone,i=false,j=null,h={},e=this,k=null,l=null,c={script:iNet.resources.workflow.script,global:iNet.resources.global,errors:iNet.resources.errors,constant:iNet.resources.constant,validate:iNet.resources.validate},d={CREATE:$("#script-create-btn"),DELETE:$("#script-delete-btn"),SAVE:$("#script-save-btn"),
BACK:$("#script-back-btn")};d.DELETE.hide();roleCreate?d.CREATE.show():d.CREATE.hide();roleCreate||roleEdit?d.SAVE.show():d.SAVE.hide();var m={view_info:iNet.getUrl("cloud/workflow/script/find"),create_info:iNet.getUrl("cloud/workflow/script/create"),update_info:iNet.getUrl("cloud/workflow/script/update"),del_info:iNet.getUrl("cloud/workflow/script/delete")},a={info:$("#script-info-div"),item:$("#script-item-div"),name:$("#script-name-txt"),zone:$("#script-zone-txt"),brief:$("#script-brief-txt"),
condition:$("#script-condition-txt")};a.info.bind("keydown",function(){});a.info.bind("focusoutside",function(){});a.info.bind("click",function(){});a.info.bind("change",function(){});a.item.bind("click",function(){});var n=this.confirmDialog(iNet.resources.message.dialog_confirm_title,e.getNotifyContent(c.constant.del_content,l),function(){if(!iNet.isEmpty(k)){n.hide();$.postJSON(m.del_info,{id:k},function(b){var f=b||{};if(CommonService.isSuccess(f)){i=true;k=null;e.notifySuccess(c.constant.del_title,
c.constant.del_success);p()}else e.notifyError(c.constant.del_title,e.getNotifyContent(c.constant.del_error,f.errors||[]))},{mask:e.getMask(),msg:iNet.resources.ajaxLoading.deleting})}});this.loadData=function(b){if(b!=null){var f=(h=b||{})||{};a.name.val(f.name);a.zone.val(f.zone);a.brief.val(f.brief);a.condition.val(f.condition);roleDelete&&d.DELETE.show()}else o()};this.setPageBack=function(b){j=b;j==null&&d.BACK.hide()};var o=function(){a.name.val("");a.zone.val("");a.brief.val("");a.condition.val("");
h={};a.name.focus();d.DELETE.hide()},r=function(){var b={name:a.name.val(),zone:a.zone.val(),brief:a.brief.val(),condition:a.condition.val()};return b=iNet.apply(h,b)||{}},s=function(b){var f=b;return true},p=function(){if(j!=null){e.hide();j.show();i&&this.fireEvent("finish")}else o()}.createDelegate(this);d.CREATE.on("click",function(){o();a.name.focus()});d.DELETE.on("click",function(){k=h.uuid;l=h.name;n.setContent(String.format(c.constant.del_content,l));n.show()});d.SAVE.on("click",function(){var b=
r();b.zone=q;console.log("onSave",b);if(s(b))b.uuid==null?$.postJSON(m.create_info,b,function(f){var g=f||{};console.log("create_info",g);if(CommonService.isSuccess(g)){i=true;roleDelete&&d.DELETE.show();h=g;e.notifySuccess(c.constant.save_title,c.constant.save_success)}else e.notifyError(c.constant.save_title,e.getNotifyContent(c.constant.save_error,g.errors||[]))}):$.postJSON(m.update_info,b,function(f){var g=f||{};console.log("update_info",g);if(CommonService.isSuccess(g)){i=true;h=g;e.notifySuccess(c.constant.save_title,
c.constant.save_success)}else e.notifyError(c.constant.save_title,e.getNotifyContent(c.constant.save_error,g.errors||[]))})});d.BACK.on("click",p);iNet.ui.workflow.WFScript.superclass.constructor.call(this)};iNet.extend(iNet.ui.workflow.WFScript,iNet.ui.app.widget)});
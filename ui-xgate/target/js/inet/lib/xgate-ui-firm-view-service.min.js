$(function(){iNet.ns("iNet.ui.admin","iNet.ui.admin.FirmView");iNet.ui.admin.FirmView=function(){this.id="firm-view-div";var e=this,d={},u=null,v=false,f={firm:iNet.resources.xgate.admin.firm,global:iNet.resources.global,errors:iNet.resources.errors,constant:iNet.resources.constant,validate:iNet.resources.validate},o={BACK:$("#firm-view-btn-back"),CREATE:$("#firm-view-btn-create"),SAVE:$("#firm-view-btn-save"),DEL:$("#firm-view-btn-delete")},s={view:iNet.getUrl("firmtask/subfirm/list"),del:iNet.getUrl("firmtask/subfirm/delete"),
create:iNet.getUrl("firmtask/subfirm/create"),update:iNet.getUrl("firmtask/subfirm/update"),load_user:iNet.getUrl("system/account/role")},b={organiId:$("#firm-view-organId"),name:$("#firm-view-name"),brief:$("#firm-view-brief"),profileID:$("#firm-view-profile"),email:$("#firm-view-email"),phone:$("#firm-view-phone"),website:$("#firm-view-website"),fax:$("#firm-view-fax"),address1:$("#firm-view-address1"),member:$("#firm-view-member")},p=this.confirmDialog(f.constant.del_title,e.getNotifyContent(f.constant.del_content,
""),function(){if(!iNet.isEmpty(p.deleteId)){p.hide();$.postJSON(s.del,{organId:p.deleteId},function(g){var a=g||{};if(CommonService.isSuccess(a)){p.deleteId="";v=true;o.BACK.trigger("click");e.notifySuccess(f.constant.del_title,f.constant.del_success)}else e.notifyError(f.constant.del_title,e.getNotifyContent(f.constant.del_error,a.errors||[]))},{mask:e.getMask(),msg:iNet.resources.ajaxLoading.deleting})}}),F=function(g,a,k,m,w,q,x,y){var h=a||[],z=k||"id",A=m||1,G=iNet.isEmpty(w)?true:w,B=iNet.isEmpty(q)?
false:q,H=iNet.isEmpty(x)?{}:x,I=iNet.isFunction(y)?y:"",j={};j.id=g;j.allowClear=G;j.multiple=B;j.data={results:h,text:function(c){return iNet.isEmpty(c.name)?"":c.name}};j.idValue=function(c){return c[z]};j.initSelection=function(c,r){var l=z,n=c.val().split(",")||[],C=[],D="",E=B;if(!iNet.isEmpty(n))for(var t=0;t<n.length;t++)for(var i=0;i<h.length;i++)if(l=="id"?h[i][l].toString()==n[t].toString():h[i][l].toString()==n[t].toString()){h[i].name=iNet.isEmpty(h[i].name)?"":h[i].name;h[i].code=iNet.isEmpty(h[i].code)?
"":h[i].code;if(E)C.push(h[i]);else D=h[i];break}E?r(C):r(D)};j.formatResult=function(c){var r=iNet.isEmpty(c.code)?"":c.code,l=iNet.isEmpty(c.name)?"":c.name;c=l;var n=String.format('<span style="color: #c09853; text-align: right; padding-right: 5px"><strong>{0}<strong></strong></strong></span> {1}',r,l);return A==1?c:n};j.formatSelection=function(c){var r=iNet.isEmpty(c.code)?"":c.code,l=iNet.isEmpty(c.name)?"":c.name;c=l;var n=String.format('<label class="label label-info marg-b-0">{0}</label> {1}',
r,l);return A==1?c:n};if(!iNet.isEmpty(x))j.ajax=H;if(!iNet.isEmpty(I))j.query=y;return new iNet.ui.form.select.Select(j)};b.member=F("firm-view-member",[],"id",1,true,true);var J=function(g){$.postJSON(s.load_user,{},function(a){var k=a||{};if(CommonService.isSuccess(k)){var m=[];$.each(k.items||[],function(w,q){m.push({id:q.username,code:q.username,name:q.fullname})});b.member=F("firm-view-member",m,"id",1,true,true);b.member.setValue(g||[])}})};this.setData=function(g){d=g||{};b.organiId.val(d.organiId||
"");b.name.val(d.name||"");b.brief.val(d.brief||"");b.profileID.val(d.profileID||iNet.generateUUID());b.email.val(d.email||"");b.phone.val(d.phone||"");b.fax.val(d.fax||"");b.website.val(d.website||"");b.address1.val(d.address1||"");var a=[];d.members=d.members||[];for(var k in d.members)iNet.isEmpty((d.members[k]||{}).name||"")||a.push((d.members[k]||{}).name||"");J(a);b.profileID.attr("readonly",true);if(iNet.isEmpty(d.organiId||"")){b.organiId.attr("readonly",false);o.DEL.hide()}else{b.organiId.attr("readonly",
true);o.DEL.show()}};this.setPageBack=function(g){u=g};o.CREATE.on("click",function(){e.setData({})});o.SAVE.on("click",function(){var g="";g=iNet.isEmpty(d.organiId||"")?s.create:s.update;var a={};a.organiId=b.organiId.val();a.address1=b.address1.val();a.brief=b.brief.val();a.email=b.email.val();a.fax=b.fax.val();a.name=b.name.val();a.phone=b.phone.val();a.profileID=b.profileID.val()||iNet.generateUUID();a.website=b.website.val();a.organId=a.organiId;a.member=iNet.JSON.encode(b.member.getData());
iNet.isEmpty(a.organId)||iNet.isEmpty(a.name)||iNet.isEmpty(a.profileID)?e.notifyError(f.constant.warning_title,f.constant.warning_required):$.postJSON(g,a,function(k){var m=k||{};if(CommonService.isSuccess(m)){e.setData(m||{});v=true;e.notifySuccess(f.constant.save_title,f.constant.save_success)}else e.notifyError(f.constant.save_title,e.getNotifyContent(f.constant.save_error,m.errors||[]))},{mask:e.getMask(),msg:iNet.resources.ajaxLoading.processing})});o.DEL.on("click",function(){p.deleteId=d.organiId;
p.setContent(String.format(f.constant.del_content,d.name));p.show()});o.BACK.on("click",function(){if(u!=null){e.hide();u.show();v&&this.fireEvent("finish")}else clearData()}.createDelegate(this));iNet.ui.admin.FirmView.superclass.constructor.call(this)};iNet.extend(iNet.ui.admin.FirmView,iNet.ui.app.widget)});
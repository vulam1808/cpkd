$(function(){iNet.ns("iNet.ui.admin","iNet.ui.admin.ProcedureDictAdditional");iNet.ui.admin.ProcedureDictAdditional=function(){this.id="procedure-dictadditional-div";var e=this,i=null,d={procedure:iNet.resources.xgate.admin.procedure,global:iNet.resources.global,errors:iNet.resources.errors,constant:iNet.resources.constant,validate:iNet.resources.validate},k={BACK:$("#procedure-dictadditional-back-btn"),ADD:$("#procedure-dictadditional-add-btn")},h={listAdd:iNet.getUrl("onegate/dictadditional/list"),
createAdd:iNet.getUrl("onegate/dictadditional/create"),updateAdd:iNet.getUrl("onegate/dictadditional/update"),deleteAdd:iNet.getUrl("onegate/dictadditional/delete")},l=new DataSource({columns:[{property:"brief",label:d.procedure.brief,type:"text",sortable:true},{property:"system",label:d.procedure.system,type:"checkbox",sortable:true,disabled:true,width:130},{label:"",type:"action",width:32,align:"center",buttons:[{text:iNet.resources.message.button.del,icon:"icon-trash",labelCls:"label label-important",
fn:function(a){$.postJSON(h.deleteAdd,{additional:a.uuid},function(){b.remove(a.uuid);b.load()})},visibled:function(a){return!a.system}}]}],delay:250}),b=new iNet.ui.grid.Grid({id:"procedure-dictadditional-grid",url:h.listAdd,firstLoad:false,dataSource:l,convertData:function(a){var c=a||{};$(c.items||[]).each(function(f,g){if(iNet.isEmpty(g.brief))g.brief=g.fieldName});return c.items},stretchHeight:false,editable:true,idProperty:"uuid"});b.on("save",function(a){var c=a||{};if(!iNet.isEmpty(c.brief)){c.fieldName=
"file"+iNet.generateId().substring(0,6);c.procedureID=(b.getParams()||{}).procedure;$.postJSON(h.createAdd,c,function(f){var g=f||{};if(CommonService.isSuccess(g)){b.insert(g);e.notifySuccess(d.constant.save_title,d.constant.save_success)}else e.notifyError(d.constant.save_title,e.getNotifyContent(d.constant.save_error,g.errors||[]))})}});b.on("update",function(a,c){var f=iNet.apply(c,a)||{};if(!iNet.isEmpty(f.brief)){f.procedureID=(b.getParams()||{}).procedure;f.additional=f.uuid;$.postJSON(h.updateAdd,
f,function(g){var j=g||{};if(CommonService.isSuccess(j)){b.update(j);b.commit();e.notifySuccess(d.constant.save_title,d.constant.save_success)}else e.notifyError(d.constant.save_title,e.getNotifyContent(d.constant.save_error,j.errors||[]))},{msg:iNet.resources.ajaxLoading.updating,mask:e.getMask()})}});b.on("blur",function(a,c){a=="update"?b.endEdit():c.save()});b.on("beforeedit",function(a){var c=iNet.isEmpty(a.uuid),f=b.getColumnModel()});this.loadById=function(a){var c=a||{};b.setParams({procedure:c.uuid});
b.load()};this.setPageBack=function(a){i=a};k.BACK.on("click",function(){if(i!=null){e.hide();i.show()}e.fireEvent("back")}.createDelegate(this));k.ADD.on("click",function(){b.newRecord({system:false});var a=b.getColumnModel(),c=a.getColumnByName("brief").getCellAdd(1);c.setDisabled(false);c.setValue("");a.getColumnByName("system").getCellAdd(1).setDisabled(true)});iNet.ui.admin.ProcedureDictAdditional.superclass.constructor.call(this)};iNet.extend(iNet.ui.admin.ProcedureDictAdditional,iNet.ui.app.widget)});
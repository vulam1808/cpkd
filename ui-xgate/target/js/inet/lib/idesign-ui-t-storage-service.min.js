$(function(){iNet.ns("iNet.ui.builder","iNet.ui.builder.TStorage");iNet.ui.builder.TStorage=function(){this.id="storage-div";var i=this,j={storage:iNet.resources.builder.storage,global:iNet.resources.global,errors:iNet.resources.errors,constant:iNet.resources.constant,validate:iNet.resources.validate},m={load_category:iNet.getUrl("cloud/designform/application"),load_storage:iNet.getUrl("cloud/designform/list"),load_image:iNet.getUrl("cloud/designbinary/view"),importPage:iNet.getUrl("cloud/designform/import")},
c={search:$("#storage-search-btn"),pageLeft:$("#storage-paging-left"),pageInfo:$("#storage-paging-info"),pageRight:$("#storage-paging-right"),pageRefresh:$("#storage-paging-refresh")};c.pageInfo.text("0/0");var g={category:$("#storage-category-select"),keyword:$("#storage-keyword-txt"),list:$("#storage-list")},b="";b+='<div data-uuid="{0}" class="theme " title="{3}">';b+='    <div class="theme-screenshot">';b+='        <img src="{1}" alt="{3}">';b+="    </div>";b+='    <div class="theme-author">{2}</div>';
b+='    <h3 class="theme-name" title="{3}">{3}</h3>';b+='    <div class="theme-actions" title="{3}">';b+='        <button class="btn btn-success btn-sm install" data-uuid="{0}" data-action="import" title="{3}">';b+='           <i class="stat-icon fa fa-download"></i> '+j.storage["import"];b+="        </button>";b+="    </div>";b+="</div>";$.postJSON(m.load_category,{},function(d){var a=d||"";if((a.type||"")!="ERROR"){var e=[];$.each(a||[],function(h,f){e.push({id:f,code:f,name:f})});g.category=FormService.createSelect("storage-category-select",
e,"id",1,true,false);g.category.on("change",function(){l()});l()}},{msg:iNet.resources.ajaxLoading.processing,mask:i.getMask()});var q=function(d,a){var e=((a||{}).images||[])[0];return String.format("{0}/cms/asset/photoview.cpx?folder={1}&code={2}",d,e.folder,e.code)},l=function(d){c.pageInfo.attr("pageNumber",d||0);var a={pageSize:10,pageNumber:d||0,category:g.category.getValue()||"",keyword:g.keyword.val()};$.postJSON(m.load_storage,a,function(e){g.list.html("");var h=e||{};if((h.type||"")!="ERROR"){var f=
(h.total||0)%10;f=f>0&&f<5?parseFloat((h.total/10).toFixed(0))+1:f.toFixed(0);var p=h.items||[],r=h.marketplacePath||"";c.pageInfo.attr("pageTotal",f);c.pageInfo.text("[ "+p.length+" ] -- "+((d||0)+1)+"/"+f);$.each(p,function(n,k){g.list.append(String.format(b,k.uuid,q(r,k),"iNet Solutions",k.brief))})}else c.pageInfo.text("0/0");g.list.find('[data-action="import"]').on("click",function(){var n=$(this).attr("data-uuid");console.log(n);$.postJSON(m.importPage,{application:n},function(k){var s=k||{};
(s.type||"")!="ERROR"?i.notifySuccess(j.constant.submit_title,j.constant.submit_success):i.notifyError(j.constant.submit_title,j.constant.submit_error)},{msg:iNet.resources.ajaxLoading.processing,mask:i.getMask()})})},{msg:iNet.resources.ajaxLoading.processing,mask:i.getMask()})},o=function(d){var a=c.pageInfo.attr("pageNumber")||0,e=c.pageInfo.attr("pageTotal")||0;d==-2&&a--;d==-1&&a++;if(a<=0)a=0;if(a>=e)a=e-1;l(a)};g.keyword.on("keyup",function(d){d.which==13&&c.search.trigger("click")});c.search.on("click",
function(){l()});c.pageLeft.on("click",function(){o(-2)});c.pageRight.on("click",function(){o(-1)});c.pageRefresh.on("click",function(){o()});iNet.ui.builder.TStorage.superclass.constructor.call(this)};iNet.extend(iNet.ui.builder.TStorage,iNet.ui.app.widget);(new iNet.ui.builder.TStorage).show()});
(function(c){function t(a,b,d,k){if(!a.tag.isInline&&d.length>0){d.push("\n");for(i=0;i<k;i++)d.push("\t")}}function w(a,b){var d=[],k=a.attributes.length==0,e;if(a.tag.isComment){if(b.allowComments){d.push("<!--");d.push(a.tag.rawAttributes);d.push(">");b.format&&t(a,b,d,e-1)}}else{this.name.concat(a.tag.rawAttributes==undefined?"":a.tag.rawAttributes);var n=a.tag.render&&(b.allowedTags.length==0||c.inArray(a.tag.name,b.allowedTags)>-1)&&(b.removeTags.length==0||c.inArray(a.tag.name,b.removeTags)==
-1);if(!a.isRoot&&n){d.push("<");d.push(a.tag.name);c.each(a.attributes,function(){if(c.inArray(this.name,b.removeAttrs)==-1){var j=RegExp(/^(['"]?)(.*?)['"]?$/).exec(this.value),m=j[2];j=j[1]||"'";if(this.name=="class"&&b.allowedClasses.length>0)m=c.grep(m.split(" "),function(o){return c.grep(b.allowedClasses,function(p){return p==o||p[0]==o&&(p.length==1||c.inArray(a.tag.name,p[1])>-1)}).length>0}).join(" ");if(m!=null&&(m.length>0||c.inArray(this.name,a.tag.requiredAttributes)>-1)){d.push(" ");
d.push(this.name);d.push("=");d.push(j);d.push(m);d.push(j)}}})}if(a.tag.isSelfClosing){n&&d.push(" />");k=false}else if(a.tag.isNonClosing)k=false;else{!a.isRoot&&n&&d.push(">");e=b.formatIndent++;if(a.tag.toProtect){var f=c.htmlClean.trim(a.children.join("")).replace(/<br>/ig,"\n");d.push(f);k=f.length==0}else{f=[];for(var h=0;h<a.children.length;h++){var l=a.children[h],g=c.htmlClean.trim(u(q(l)?l:l.childrenToString()));if(q(l)||l.tag.isInline)if(h>0&&g.length>0&&(D(l)||E(a.children[h-1])))f.push(" ");
if(q(l))g.length>0&&f.push(g);else if(h!=a.children.length-1||l.tag.name!="br"){b.format&&t(l,b,f,e);f=f.concat(w(l,b))}}b.formatIndent--;if(f.length>0){b.format&&f[0]!="\n"&&t(a,b,d,e);d=d.concat(f);k=false}}if(!a.isRoot&&n){b.format&&t(a,b,d,e-1);d.push("</");d.push(a.tag.name);d.push(">")}}if(!a.tag.allowEmpty&&k)return[]}return d}function x(a,b){return v(a,function(d){return c.inArray(d.tag.nameOriginal,b)>-1})}function F(a){return v(a,function(b){return b.isRoot||!b.tag.isInline})}function v(a,
b,d){d=d||1;if(b(a[a.length-d]))return true;else if(a.length-d>0&&v(a,b,d+1)){a.pop();return true}return false}function r(a){if(a){this.tag=a;this.isRoot=false}else{this.tag=new s("root");this.isRoot=true}this.attributes=[];this.children=[];this.hasAttribute=function(b){for(var d=0;d<this.attributes.length;d++)if(this.attributes[d].name==b)return true;return false};this.childrenToString=function(){return this.children.join("")};return this}function y(a,b){this.name=a;this.value=b;return this}function s(a,
b,d,k){this.nameOriginal=this.name=a.toLowerCase();this.render=true;this.init=function(){if(this.name=="--")this.isSelfClosing=this.isComment=true;else{this.isComment=false;this.isSelfClosing=c.inArray(this.name,G)>-1;this.isNonClosing=c.inArray(this.name,H)>-1;this.isClosing=b!=undefined&&b.length>0;this.isInline=c.inArray(this.name,I)>-1;this.disallowNest=c.inArray(this.name,J)>-1;this.requiredParent=z[c.inArray(this.name,z)+1];this.allowEmpty=c.inArray(this.name,K)>-1;this.toProtect=c.inArray(this.name,
L)>-1}this.rawAttributes=d;this.requiredAttributes=A[c.inArray(this.name,A)+1];if(k){if(!k.tagAttributesCache)k.tagAttributesCache=[];if(c.inArray(this.name,k.tagAttributesCache)==-1){for(var e=B[c.inArray(this.name,B)+1].slice(0),n=0;n<k.allowedAttributes.length;n++){var f=k.allowedAttributes[n][0];if((k.allowedAttributes[n].length==1||c.inArray(this.name,k.allowedAttributes[n][1])>-1)&&c.inArray(f,e)==-1)e.push(f)}k.tagAttributesCache.push(this.name);k.tagAttributesCache.push(e)}this.allowedAttributes=
k.tagAttributesCache[c.inArray(this.name,k.tagAttributesCache)+1]}};this.init();this.rename=function(e){this.name=e;this.init()};return this}function D(a){for(;a.constructor==r&&a.children.length>0;)a=a.children[0];if(!q(a))return false;a=u(a);return a.length>0&&c.htmlClean.isWhitespace(a.charAt(0))}function E(a){for(;a.constructor==r&&a.children.length>0;)a=a.children[a.children.length-1];if(!q(a))return false;a=u(a);return a.length>0&&c.htmlClean.isWhitespace(a.charAt(a.length-1))}function q(a){return a.constructor==
String}function u(a){return a.replace(/&nbsp;|\n/g," ").replace(/\s\s+/g," ")}c.fn.htmlClean=function(a){return this.each(function(){c(this);if(this.value)this.value=c.htmlClean(this.value,a);else this.innerHTML=c.htmlClean(this.innerHTML,a)})};c.htmlClean=function(a,b){b=c.extend({},c.htmlClean.defaults,b);var d=/(<(\/)?(\w+:)?([\w]+)([^>]*)>)|<!--(.*?--)>/gi,k=/([\w\-]+)=(".*?"|'.*?'|[^\s>]*)/gi,e,n=new r,f=[n],h=n;if(b.bodyOnly)if(e=/<body[^>]*>((\n|.)*)<\/body>/i.exec(a))a=e[1];a=a.concat("<xxx>");
for(var l;e=d.exec(a);){var g=e[6]?new s("--",null,e[6],b):new s(e[4],e[2],e[5],b);l=a.substring(l,e.index);if(l.length>0){var j=h.children[h.children.length-1];if(h.children.length>0&&q(j=h.children[h.children.length-1]))h.children[h.children.length-1]=j.concat(l);else h.children.push(l)}l=d.lastIndex;if(g.isClosing){if(x(f,[g.name])){f.pop();h=f[f.length-1]}}else{for(var m=new r(g);j=k.exec(g.rawAttributes);){if(j[1].toLowerCase()=="style"&&b.replaceStyles)for(var o=!g.isInline,p=0;p<b.replaceStyles.length;p++)if(b.replaceStyles[p][0].test(j[2])){if(!o){g.render=
false;o=true}h.children.push(m);f.push(m);h=m;g=new s(b.replaceStyles[p][1],"","",b);m=new r(g)}if(g.allowedAttributes!=null&&(g.allowedAttributes.length==0||c.inArray(j[1],g.allowedAttributes)>-1))m.attributes.push(new y(j[1],j[2]))}c.each(g.requiredAttributes,function(){var C=this.toString();m.hasAttribute(C)||m.attributes.push(new y(C,""))});for(j=0;j<b.replace.length;j++)for(o=0;o<b.replace[j][0].length;o++)if((p=typeof b.replace[j][0][o]=="string")&&b.replace[j][0][o]==g.name||!p&&b.replace[j][0][o].test(e)){g.rename(b.replace[j][1]);
j=b.replace.length;break}e=true;if(!h.isRoot)if(h.tag.isInline&&!g.isInline){if(e=F(f))h=f[f.length-1]}else if(h.tag.disallowNest&&g.disallowNest&&!g.requiredParent)e=false;else if(g.requiredParent)if(e=x(f,g.requiredParent))h=f[f.length-1];if(e){h.children.push(m);if(g.toProtect)for(;tagMatch2=d.exec(a);){e=new s(tagMatch2[3],tagMatch2[1],tagMatch2[4],b);if(e.isClosing&&e.name==g.name){m.children.push(RegExp.leftContext.substring(l));l=d.lastIndex;break}}else if(!g.isSelfClosing&&!g.isNonClosing){f.push(m);
h=m}}}}return c.htmlClean.trim(w(n,b).join(""))};c.htmlClean.defaults={bodyOnly:true,allowedTags:[],removeTags:["basefont","center","dir","font","frame","frameset","iframe","isindex","menu","noframes","s","strike","u"],allowedAttributes:[],removeAttrs:[],allowedClasses:[],format:false,formatIndent:0,replace:[[["b","big"],"strong"],[["i"],"em"]],replaceStyles:[[/font-weight:\s*bold/i,"strong"],[/font-style:\s*italic/i,"em"],[/vertical-align:\s*super/i,"sup"],[/vertical-align:\s*sub/i,"sub"]],allowComments:false};
c.htmlClean.trim=function(a){return c.htmlClean.trimStart(c.htmlClean.trimEnd(a))};c.htmlClean.trimStart=function(a){return a.substring(c.htmlClean.trimStartIndex(a))};c.htmlClean.trimStartIndex=function(a){for(var b=0;b<a.length-1&&c.htmlClean.isWhitespace(a.charAt(b));b++);return b};c.htmlClean.trimEnd=function(a){return a.substring(0,c.htmlClean.trimEndIndex(a))};c.htmlClean.trimEndIndex=function(a){for(var b=a.length-1;b>=0&&c.htmlClean.isWhitespace(a.charAt(b));b--);return b+1};c.htmlClean.isWhitespace=
function(a){return c.inArray(a,M)!=-1};var I=["a","abbr","acronym","address","b","big","br","button","caption","cite","code","del","em","font","hr","i","input","img","ins","label","legend","map","q","s","samp","select","option","param","small","span","strike","strong","sub","sup","tt","u","var"],J=["h1","h2","h3","h4","h5","h6","p","th","td","object"],K=["th","td"],z=[null,"li",["ul","ol"],"dt",["dl"],"dd",["dl"],"td",["tr"],"th",["tr"],"tr",["table","thead","tbody","tfoot"],"thead",["table"],"tbody",
["table"],"tfoot",["table"],"param",["object"]],L=["script","style","pre","code"],G=["area","base","br","col","command","embed","hr","img","input","keygen","link","meta","param","source","track","wbr"],H=["!doctype","?xml"],B=[["class"],"?xml",[],"!doctype",[],"a",["accesskey","class","href","name","title","rel","rev","type","tabindex"],"abbr",["class","title"],"acronym",["class","title"],"blockquote",["cite","class"],"button",["class","disabled","name","type","value"],"del",["cite","class","datetime"],
"form",["accept","action","class","enctype","method","name"],"input",["accept","accesskey","alt","checked","class","disabled","ismap","maxlength","name","size","readonly","src","tabindex","type","usemap","value"],"img",["alt","class","height","src","width"],"ins",["cite","class","datetime"],"label",["accesskey","class","for"],"legend",["accesskey","class"],"link",["href","rel","type"],"meta",["content","http-equiv","name","scheme","charset"],"map",["name"],"optgroup",["class","disabled","label"],
"option",["class","disabled","label","selected","value"],"q",["class","cite"],"script",["src","type"],"select",["class","disabled","multiple","name","size","tabindex"],"style",["type"],"table",["class","summary"],"th",["class","colspan","rowspan"],"td",["class","colspan","rowspan"],"textarea",["accesskey","class","cols","disabled","name","readonly","rows","tabindex"],"param",["name","value"],"embed",["height","src","type","width"]],A=[[],"img",["alt"]],M=["\u00a0"," ","\t","\n","\r","\u000c"]})(jQuery);
$(function(){iNet.ns("iNet.ui.workflow","iNet.ui.workflow.WFScriptList");iNet.ui.workflow.WFScriptList=function(){this.id="script-list-div";console.log(">>>> C,E,D,V >>>> ",roleCreate,roleEdit,roleDelete,roleView);var l=iNet.zone,m=iNet.context,d=this,j=null,n=null,c={script:iNet.resources.workflow.script,global:iNet.resources.global,errors:iNet.resources.errors,constant:iNet.resources.constant,validate:iNet.resources.validate},g={CREATE:$("#script-list-create-btn"),DELETE:$("#script-list-delete-btn")};
g.DELETE.hide();roleCreate?g.CREATE.show():g.CREATE.hide();var o={view:iNet.getUrl("cloud/workflow/script/list"),create:iNet.getUrl("cloud/workflow/script/create"),update:iNet.getUrl("cloud/workflow/script/update"),del:iNet.getUrl("cloud/workflow/script/delete")},k=this.confirmDialog(iNet.resources.message.dialog_confirm_title,d.getNotifyContent(c.constant.del_content,n),function(){if(!iNet.isEmpty(j)){k.hide();$.postJSON(o.del,{zone:l,context:m,script:j},function(a){var b=a||{};if(CommonService.isSuccess(b)){var f=
j.split(",");for(a=0;a<f.length;a++)e.remove(f[a]);j=null;g.DELETE.hide();d.notifySuccess(c.constant.del_title,c.constant.del_success)}else d.notifyError(c.constant.del_title,d.getNotifyContent(c.constant.del_error,b.errors||[]))},{mask:d.getMask(),msg:iNet.resources.ajaxLoading.deleting})}}),s=new DataSource({columns:[{property:"name",label:c.script.name,sortable:true,type:"text",validate:function(a){if($.trim(a)=="")return String.format(c.validate.is_not_blank,c.script.name)},width:150},{property:"brief",
label:c.script.brief,sortable:true,type:"text",width:150},{label:"",type:"action",width:32,align:"center",buttons:[{text:c.script.title,icon:"icon-pencil",labelCls:"label label-success",fn:function(a){d.hide();var b=q();b.loadData(a);b.setPageBack(d);b.show()}},{text:iNet.resources.message.button.del,icon:"icon-trash",labelCls:"label label-important",fn:function(a){j=a.uuid.toString();n=a.name;k.setContent(String.format(c.constant.del_content,n));k.show()},visibled:function(a){var b=a||{};if(roleDelete)return true;
return false}}]}],delay:250}),e=new iNet.ui.grid.Grid({id:"script-list-grid",url:o.view,params:{zone:l,context:m},convertData:function(a){var b=a||{};e.setTotal(b.total);return b.items||[]},dataSource:s,stretchHeight:false,editable:roleEdit,firstLoad:roleView,hideHeader:!roleView,hideSearch:!roleView,idProperty:"uuid"});roleView||e.loadData([]);e.on("save",function(a){var b=a||{};b.zone=l;b.context=m;$.postJSON(o.create,b,function(f){var h=f||{};if(CommonService.isSuccess(h)){e.insert(h);e.newRecord();
d.notifySuccess(c.constant.save_title,c.constant.save_success)}else d.notifyError(c.constant.save_title,d.getNotifyContent(c.constant.save_error,h.errors||[]))})});e.on("update",function(a,b){var f=iNet.apply(b,a)||{};f.zone=l;f.context=m;$.postJSON(o.update,f,function(h){var i=h||{};if(CommonService.isSuccess(i)){e.update(i);e.commit();d.notifySuccess(c.constant.save_title,c.constant.save_success)}else d.notifyError(c.constant.save_title,d.getNotifyContent(c.constant.save_error,i.errors||[]))},{msg:iNet.resources.ajaxLoading.updating,
mask:d.getMask()})});e.on("blur",function(a,b){a=="update"?e.endEdit():b.save()});e.on("selectionchange",function(a){a=a.getSelection();for(var b=a.length,f=[],h=[],i=0;i<b;i++){var r=a[i];f.push(r.id);h.push(r.name)}f.length>0&&roleDelete?g.DELETE.show():g.DELETE.hide();j=f.join(iNet.splitChar);n=h.join(iNet.splitChar)});var p=null,q=function(){if(p==null){p=new iNet.ui.workflow.WFScript;p.on("finish",function(){if(roleView||roleCreate)e.load()})}return p};g.CREATE.on("click",function(){g.DELETE.hide();
d.hide();var a=q();a.loadData({});a.setPageBack(d);a.show()});g.DELETE.on("click",function(){k.setContent(iNet.resources.message.dialog_confirm_selected_content);k.show()});iNet.ui.workflow.WFScriptList.superclass.constructor.call(this)};iNet.extend(iNet.ui.workflow.WFScriptList,iNet.ui.app.widget);(new iNet.ui.workflow.WFScriptList).show()});
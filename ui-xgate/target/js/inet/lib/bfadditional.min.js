$(function(){iNet.ns("iNet.ui.xgate","iNet.ui.xgate.BfAdditional");iNet.ui.xgate.BfAdditional=function(q){this.id="briefcase-additional-div";var s=q||{},g=this,n=null,h={task:iNet.resources.task.task,Bfadditional:iNet.resources.xgate.Bfadditional,global:iNet.resources.global,errors:iNet.resources.errors,constant:iNet.resources.constant,validate:iNet.resources.validate},o={view:iNet.getUrl("onegate/externaldata/request"),send:iNet.getUrl("onegate/externaldata/reqsubmit"),create:iNet.getUrl("onegate/dictadditional/create")},
l=iNet.getLayout().window.taskFrame;l.on("typechange",function(b){b=="min"?a.setMenuButton(true):a.setMenuButton(false)});var a=new iNet.ui.itemview({id:"briefcase-additional",resource:h,url:o,toolbar:function(){this.id="briefcase-additional-toolbar";this.intComponent=function(){this.$backBtn=$("#briefcase-additional-back-btn");this.$sendBtn=$("#briefcase-additional-send-btn");this.$addBtn=$("#briefcase-additional-add-btn");this.$backBtn.on("click",function(){g.fireEvent("back");if(n!=null){n.show();
g.hide()}}.createDelegate(this));this.$sendBtn.on("click",function(){var b=l.getTaskDataIndex(),j=((b||{}).request||{}).additionalID||"",c=((b||{}).request||{}).uuid||"",d=$(this).attr("fieldName")||"",e=$(this).attr("brief")||"",f=a.dataContent.$note.val()||"",k=a.dataContent.$expiredTime.val().dateToLong();if(!iNet.isEmpty(j)&&!iNet.isEmpty(d)){var i={"package":j,brief:f,expiredTime:k,requestID:c},r=e.split(",");$.each(d.split(","),function(m,p){iNet.isEmpty(p||"")||(i[p]=r[m])});$.postJSON(o.send,
i,function(m){console.log("additional_submit result >>",m);if(CommonService.isSuccess(m)){g.notifySuccess(h.constant.submit_title,h.constant.submit_success);l.refresh()}else g.notifyError(h.constant.submit_title,g.getNotifyContent(h.constant.submit_error,m.errors||[]))},{mask:g.getMask(),msg:iNet.resources.ajaxLoading.loading})}});this.$addBtn.on("click",function(){a.dataContent.$grid.newRecord({brief:""})})}},dataContent:function(){this.id="briefcase-additional-data-content";this.intComponent=function(){this.$note=
$("#briefcase-additional-brief-note-txt");this.$expiredTime=$("#briefcase-additional-brief-expiredTime");FormService.createDate(this.$expiredTime);this.$expiredTime.val((new Date).format("d/m/Y"));var b=this,j=new DataSource({columns:[{align:"center",type:"selection",width:30},{property:"brief",label:h.task.brief,sortable:true,type:"text"},{label:"",type:"action",separate:"&nbsp;",align:"center",buttons:[{text:iNet.resources.message.button.edit,icon:"icon-pencil",labelCls:"label label-info",fn:function(c){b.$grid.edit(c[b.$grid.getIdProperty()])}}]}],
delay:250});this.$grid=new iNet.ui.grid.Grid({id:"briefcase-additional-grid",url:o.view,params:{"package":""},convertData:function(c){var d=c||{};$(d.items||[]).each(function(e,f){if(iNet.isEmpty(f.brief))f.brief=f.fieldName});return d.items},dataSource:j,stretchHeight:false,editable:false,firstLoad:false,idProperty:"uuid"});this.$grid.on("selectionchange",function(c){c=c.getSelection();for(var d=c.length,e=[],f=[],k=0;k<d;k++){var i=c[k];if(!iNet.isEmpty(i.fieldName||"")){e.push(i.fieldName);f.push(i.brief)}}if(e.length>
0){a.toolbar.$sendBtn.show();a.toolbar.$sendBtn.attr("fieldName",e.join(iNet.splitChar));a.toolbar.$sendBtn.attr("brief",f.join(iNet.splitChar))}else{a.toolbar.$sendBtn.hide();a.toolbar.$sendBtn.attr("fieldName","");a.toolbar.$sendBtn.attr("brief","")}});this.$grid.on("loaded",function(){a.toolbar.$sendBtn.hide()});this.$grid.on("save",function(c){var d=c||{},e=l.getTaskDataIndex(),f=(((e||{}).request||{}).requestData||{}).procedureID||"";if(!(iNet.isEmpty(d.brief)||iNet.isEmpty(f))){d.fieldName=
"file"+iNet.generateId().substring(0,6);d.procedureID=f;$.postJSON(o.create,d,function(k){var i=k||{};if(CommonService.isSuccess(i)){b.$grid.insert(i);g.notifySuccess(h.constant.save_title,h.constant.save_success)}else g.notifyError(h.constant.save_title,g.getNotifyContent(h.constant.save_error,i.errors||[]))})}});this.$grid.on("update",function(c,d){var e=d||{};e.brief=c.brief||"";if(!iNet.isEmpty(e.brief)){this.update(e);this.commit()}})}},ajaxMaskId:"ajax-mask",headerDetails:{subject:"briefcase-additional-subject-details",
sender:"briefcase-additional-sender-details"}});a.on("menuclick",function(){l.setListTaskType("menu")});this.load=function(){a.reset();var b=l.getTaskDataIndex(),j=((b||{}).request||{}).additionalID||"";a.dataContent.$grid.setParams({"package":j});a.dataContent.$grid.load();a.setDataContent("view")};this.setPageBack=function(b,j){n=b;n!=null&&j!=false?a.toolbar.$backBtn.show():a.toolbar.$backBtn.hide()};this.setType=function(b){$("#"+g.id+' [data-id="item-view-control"].item-view').removeClass("full").addClass(b)};
iNet.ui.xgate.BfAdditional.superclass.constructor.call(this)};iNet.extend(iNet.ui.xgate.BfAdditional,iNet.ui.app.widget)});
$(function(){iNet.ns("iNet.ui.UserProfile");iNet.ui.UserProfile=function(){this.id="userprofile-div";var g=this,d={dataReturn:{},profileID:""},e={task:iNet.resources.receiver.task,global:iNet.resources.global,errors:iNet.resources.errors,constant:iNet.resources.constant,validate:iNet.resources.validate},k={load:iNet.getUrl("onegate/userprofile/load"),update:iNet.getUrl("onegate/userprofile/update")};$("#ajax-mask");var a={UPViewContent:$("#userprofile-view-content"),UPInfo:$("#userprofile-info"),
UPCitizen:$("#userprofile-citizen"),UPOrgan:$("#userprofile-organ"),UPContent:$("#userprofile-content"),UPFullName:$("#userprofile-fullname"),UPBirthday:$("#userprofile-birthday"),UPIdentity:$("#userprofile-identity"),UPIdDateOfIssue:$("#userprofile-idDateOfIssue"),UPIdPlaceOfIssuse:$("#userprofile-idPlaceOfIssuse"),UPRegion:$("#userprofile-region"),UPNationality:$("#userprofile-nationality"),UPOtherNumber:$("#userprofile-otherNumber"),UPOtherDateOfIssue:$("#userprofile-otherDateOfIssue"),UPOtherPlaceOfIssuse:$("#userprofile-otherPlaceOfIssuse"),
UPAddress1:$("#userprofile-address1"),UPAddress2:$("#userprofile-address2"),UPSmobile:$("#userprofile-smobile"),UPMale:$("#userprofile-sex-male"),UPFemale:$("#userprofile-sex-female"),UPEmail:$("#userprofile-email")};a.UPCitizen.prop("checked",true);FormService.createDate(a.UPIdDateOfIssue);FormService.createDate(a.UPOtherDateOfIssue);var h={SAVE:$("#user-profile-save-btn"),BACK:$("#user-profile-back-btn")},l=function(){try{iNet.getLayout().$iframe.height($(iNet.getLayout().window).height()-90)}catch(c){}a.UPViewContent.height($(window).height()-
45)},i=function(c){a.UPContent.find('[data-profile="'+c+'"]').show()},j=function(c){a.UPContent.find('[data-profile="'+c+'"]').hide()},n=function(c){var b={address1:a.UPAddress1.val(),address2:a.UPAddress2.val(),birthday:a.UPBirthday.val(),email:a.UPEmail.val(),fullname:a.UPFullName.val(),idDateOfIssue:a.UPIdDateOfIssue.val(),identity:a.UPIdentity.val(),idPlaceOfIssuse:a.UPIdPlaceOfIssuse.val(),nationality:a.UPNationality.val(),otherDateOfIssue:a.UPOtherDateOfIssue.val(),otherNumber:a.UPOtherNumber.val(),
otherPlaceOfIssuse:a.UPOtherPlaceOfIssuse.val(),region:a.UPRegion.val(),mobile:a.UPSmobile.val()};if(a.UPCitizen.prop("checked")){b.sex="Nam";b.company="CN";if(a.UPFemale.prop("checked"))b.sex="Nu"}else{b.sex="CP";b.company="DN";if(a.UPFemale.prop("checked"))b.sex="TNHH"}if(c)if(iNet.isEmpty(b.fullname)||iNet.isEmpty(b.birthday)||iNet.isEmpty(b.identity)||iNet.isEmpty(b.address1)){g.notifyError(e.constant.warning_title,String.format(e.constant.warning_error,e.task.userprofileInfo));return{}}return b},
m=function(c){d.dataReturn={};var b=c||{};a.UPAddress1.val(b.address1||"");a.UPAddress2.val(b.address2||"");a.UPBirthday.val(b.birthday||"");a.UPEmail.val(b.email||"");a.UPFullName.val(b.fullname||"");a.UPIdDateOfIssue.val(b.idDateOfIssue||"");a.UPIdentity.val(b.identity||"");a.UPIdPlaceOfIssuse.val(b.idPlaceOfIssuse||"");a.UPNationality.val(b.nationality||e.task.userprofileNationality);a.UPOtherDateOfIssue.val(b.otherDateOfIssue||"");a.UPOtherNumber.val(b.otherNumber||"");a.UPOtherPlaceOfIssuse.val(b.otherPlaceOfIssuse||
"");a.UPRegion.val(b.region||(d.profileType=="citizen"?e.task.userprofileRegion:""));a.UPSmobile.val(b.mobile||"");a.UPFemale.prop("checked",b.sex=="Nu"||b.sex=="TNHH"||(b.sex||"")=="");a.UPFemale.prop("checked")||a.UPMale.prop("checked",true);if(b.company=="DN"){a.UPOrgan.prop("checked",true);i("organ");j("citizen")}else{a.UPCitizen.prop("checked",true);i("citizen");j("organ")}};a.UPCitizen.on("click",function(){d.profileType="citizen";a.UPRegion.val()==""&&a.UPRegion.val(e.task.userprofileRegion);
i("citizen");j("organ")});a.UPOrgan.on("click",function(){d.profileType="organ";a.UPRegion.val()==e.task.userprofileRegion&&a.UPRegion.val("");i("organ");j("citizen")});a.UPBirthday.on("change",function(){iNet.isEmpty(a.UPBirthday.val())||FormService.validateDate(a.UPBirthday.val())||a.UPBirthday.val("")});a.UPBirthday.on("keyup",function(){iNet.isEmpty(a.UPBirthday.val())||FormService.validateDate(a.UPBirthday.val(),true)||a.UPBirthday.val("")});h.SAVE.on("click",function(){var c=n(true);if(!(iNet.isEmpty(c)||
iNet.isEmpty(d.profileID))){c.profileID=d.profileID;$.postJSON(k.update,c,function(b){var f=b||{};if(CommonService.isSuccess(f)){d.dataReturn=f;h.BACK.trigger("click")}else g.notifyError(e.constant.submit_title,g.getNotifyContent(e.constant.submit_error,f.errors||[]))})}});h.BACK.on("click",function(){iNet.isEmpty(d.dataReturn)?g.fireEvent("back"):g.fireEvent("back",d.dataReturn)}.createDelegate(this));this.setProfile=function(c){d.profileID=c||"";iNet.isEmpty(d.profileID)?h.BACK.trigger("click"):
$.postJSON(k.load,{profileID:c},function(b){var f=b||{};CommonService.isSuccess(f)&&m(f)})};this.setData=function(c){d.profileID=(c||{}).uuid||"";iNet.isEmpty(d.profileID)?h.BACK.trigger("click"):m(c)};$(iNet.getLayout()).on("resize",function(){l()});l();iNet.ui.UserProfile.superclass.constructor.call(this)};iNet.extend(iNet.ui.UserProfile,iNet.ui.app.widget)});
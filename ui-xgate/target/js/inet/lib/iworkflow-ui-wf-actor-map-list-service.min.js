$(function(){iNet.ns("iNet.ui.workflow","iNet.ui.workflow.WFActorMapList");iNet.ui.workflow.WFActorMapList=function(){this.id="actor-map-list-div";console.log(">>>> C,E,D,V >>>> ",roleCreate,roleEdit,roleDelete,roleView);var m=iNet.zone,n=iNet.context,e=this,g={},b={actormap:iNet.resources.workflow.actormap,global:iNet.resources.global,errors:iNet.resources.errors,constant:iNet.resources.constant,validate:iNet.resources.validate},j={CREATE:$("#actor-map-list-create-btn"),DELETE:$("#actor-map-list-delete-btn")};
j.DELETE.hide();roleCreate?j.CREATE.show():j.CREATE.hide();var k={view:iNet.getUrl("firmtask/actormap/list"),create:iNet.getUrl("firmtask/actormap/create"),del:iNet.getUrl("firmtask/actormap/delete"),load_actor:iNet.getUrl("cloud/workflow/alias/list"),load_user:iNet.getUrl("system/account/role")},p=[];$.postJSON(k.load_user,{},function(a){var c=a||{};if(CommonService.isSuccess(c)){p=[];$.each(c.items||[],function(d,h){p.push({id:h.username,code:h.username,name:h.fullname})});o=q();f.setDataSource(o);
f.load()}});var l=this.confirmDialog(iNet.resources.message.dialog_confirm_title,e.getNotifyContent(b.constant.del_content,g.name),function(){if(!iNet.isEmpty(g.id)){l.hide();$.postJSON(k.del,{zone:m,context:n,actor:g.id},function(a){var c=a||{};if(CommonService.isSuccess(c)){var d=g.gridId.split(",");for(a=0;a<d.length;a++)f.remove(d[a]);g={};j.DELETE.hide();e.notifySuccess(b.constant.del_title,b.constant.del_success)}else e.notifyError(b.constant.del_title,e.getNotifyContent(b.constant.del_error,
c.errors||[]))},{mask:e.getMask(),msg:iNet.resources.ajaxLoading.deleting})}}),q=function(){return new DataSource({columns:[{property:"name",label:b.actormap.name,sortable:true,type:"text"},{label:"",type:"action",width:32,align:"center",buttons:[{text:b.actormap.map,icon:"icon-cogs",labelCls:"label label-success",fn:function(a){e.hide();i=s();i.loadData(a);i.setPageBack(e);i.show()}},{text:iNet.resources.message.button.del,icon:"icon-trash",labelCls:"label label-important",fn:function(a){g.id=a.actor.toString();
g.gridId=a.uuid.toString();g.name=a.name;l.setContent(String.format(b.constant.del_content,g.name));l.show()}}]}],delay:250})},o=q(),f=new iNet.ui.grid.Grid({id:"actor-map-list-grid",url:k.view,params:{zone:m,context:n},convertData:function(a){var c=a||{};return c.items||[]},dataSource:o,stretchHeight:false,editable:true,firstLoad:true,idProperty:"uuid"});f.on("save",function(a){var c=a||{};if(!iNet.isEmpty(c.name)){c.zone=m;c.context=n;c.actor="actor"+iNet.generateId().substring(0,6);$.postJSON(k.create,
c,function(d){var h=d||{};if(CommonService.isSuccess(h)){f.insert(h);e.notifySuccess(b.constant.save_title,b.constant.save_success)}else e.notifyError(b.constant.save_title,e.getNotifyContent(b.constant.save_error,h.errors||[]))})}});f.on("update",function(a,c){var d=iNet.apply(c,a)||{};if(!iNet.isEmpty(d.name)){d.zone=m;d.context=n;d.mapid=d.uuid;d.member=d.members.join(iNet.splitChar);delete d.members;$.postJSON(k.create,d,function(h){var r=h||{};if(CommonService.isSuccess(r)){f.load();e.notifySuccess(b.constant.save_title,
b.constant.save_success)}else e.notifyError(b.constant.save_title,e.getNotifyContent(b.constant.save_error,r.errors||[]))})}});f.on("blur",function(){});f.on("selectionchange",function(){});var i=null,s=function(){if(i==null){i=new iNet.ui.workflow.WFActorMap;i.on("finish",function(){if(roleView||roleCreate)f.load()})}return i};j.CREATE.on("click",function(){j.DELETE.hide();f.newRecord();var a=f.getColumnModel().getColumnByName("name").getCellAdd(1);a.setDisabled(false);a.setValue("")});j.DELETE.on("click",
function(){l.setContent(iNet.resources.message.dialog_confirm_selected_content);l.show()});iNet.ui.workflow.WFActorMapList.superclass.constructor.call(this)};iNet.extend(iNet.ui.workflow.WFActorMapList,iNet.ui.app.widget);(new iNet.ui.workflow.WFActorMapList).show()});
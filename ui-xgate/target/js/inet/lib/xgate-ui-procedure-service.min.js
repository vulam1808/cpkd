$(function(){iNet.ns("iNet.ui.admin","iNet.ui.admin.Procedure","iNet.ui.admin.ProcedureModal");iNet.ui.admin.ProcedureModal=function(){this.id="procedure-modal";var b=$("#procedure-modal"),f=this,j={},h={constant:iNet.resources.constant,errors:iNet.resources.errors},k={create:iNet.getUrl("onegate/firmprocedure/create"),update:iNet.getUrl("onegate/firmprocedure/update")},d=null,l=function(m,g,n){d||(d=new iNet.ui.form.Notify({id:iNet.generateId()}));d.setType(m);d.setTitle(g);d.setContent(n);d.show()},
c={title:$("#procedure-modal-tile"),body:$("#procedure-modal-body"),subject:$("#procedure-modal-subject")},e={submit:$("#procedure-modal-submit-btn"),close:$("#procedure-modal-close-btn")};this.setData=function(m){var g=m||{};j.procedure=g;c.subject.val(g.subject||"")};this.show=function(){b.modal("show")};this.hide=function(){b.modal("hide")};var p=function(){var m=c.subject.val();if(!iNet.isEmpty(m)){var g=k.create,n={procedureName:m};if(!iNet.isEmpty(j.procedure.uuid)){g=k.update;n.procedure=j.procedure.uuid}$.postJSON(g,
n,function(q){var r=q||{};if(CommonService.isSuccess(r)){l("success",h.constant.submit_title,h.constant.submit_success);f.fireEvent("success");i()}else l("error",h.constant.submit_title,f.getNotifyContent(h.constant.submit_error,r.errors||[]))})}}.createDelegate(this),i=function(){f.hide()};e.submit.on("click",p);e.close.on("click",i)};iNet.extend(iNet.ui.admin.ProcedureModal,iNet.Component);iNet.ui.admin.Procedure=function(){this.id="procedure-div";var b=this,f={total:0,procedure:{}},j=null,h=null,
k=null,d=null,l=null,c={procedure:iNet.resources.xgate.admin.procedure,global:iNet.resources.global,errors:iNet.resources.errors,constant:iNet.resources.constant,validate:iNet.resources.validate},e={ADD:$("#procedure-add-btn"),PUBLISH_XGATE:$("#procedure-published-xgate-btn"),PUBLISH_EXPWAY:$("#procedure-published-expway-btn")};e.PUBLISH_XGATE.hide();e.PUBLISH_EXPWAY.hide();var p={remove:iNet.getUrl("onegate/firmprocedure/remove"),prodlist:iNet.getUrl("onegate/procedure/maplist"),prodload:iNet.getUrl("onegate/prodload"),
formdetach:iNet.getUrl("onegate/formdetach")},i=this.confirmDialog(c.constant.del_title,b.getNotifyContent(c.constant.del_content,""),function(){var a=(i.data||{}).uuid||"",o=(i.data||{}).code||"";if(!iNet.isEmpty(a)){i.hide();var s=p.formdetach,u={procedure:a};if(iNet.isEmpty(o))s=p.remove;$.postJSON(s,u,function(v){var t=v||{};if(CommonService.isSuccess(t)){g.remove((i.data||{}).uuid||"");b.notifySuccess(c.constant.del_title,c.constant.del_success);i.data={}}else b.notifyError(c.constant.del_title,
b.getNotifyContent(c.constant.del_error,t.errors||[]))},{mask:b.getMask(),msg:iNet.resources.ajaxLoading.deleting})}}),m=new DataSource({columns:[{property:"subject",label:c.procedure.subject,sortable:true,disabled:true,width:350},{property:"industry",label:c.procedure.industry,sortable:true,disabled:true},{property:"formUI",label:c.procedure.formUI,type:"checkbox",sortable:true,disabled:true,width:130},{property:"brief",label:c.procedure.workflow,sortable:true,disabled:true,width:200},{property:"name",
label:c.procedure.page,sortable:true,disabled:true,width:200},{label:"",type:"action",width:32,align:"center",buttons:[{text:iNet.resources.message.button.del,icon:"icon-trash icon-white",labelCls:"label label-important",fn:function(a){i.setContent(String.format(c.constant.del_content,a.subject));i.data=a;i.show()}},{text:iNet.resources.message.button.edit,icon:"icon-pencil",fn:function(a){(a.code||"")==""?q(a):r(a)}},{text:c.procedure.attach,icon:"icon-paper-clip",labelCls:"label label-info",fn:function(a){if(h==
null){h=new iNet.ui.admin.ProcedureDictAdditional;h.on("back",function(){h.hide();b.show()})}h.loadById(a);h.show();b.hide()}},{text:c.procedure.pagedesign,icon:"icon-cogs",labelCls:"label label-warning",fn:function(a){if(k==null){k=new iNet.ui.admin.ProcedureAttribute;k.on("back",function(){k.hide();b.show()})}k.setProcedure(a.uuid);k.show();b.hide()}}]}],delay:250}),g=new iNet.ui.grid.Grid({id:"procedure-grid",url:p.prodlist,firstLoad:true,dataSource:m,convertData:function(a){var o=a||{};a=(o.elements||
[]).length;if(f.total!=(a||0)){f.total=a||0;CommonService.syncProcedure()}return o.elements},stretchHeight:false,editable:false,idProperty:"uuid"});g.on("click",function(a){f.procedure=a||{};e.PUBLISH_XGATE.show();f.procedure.formUI?e.PUBLISH_EXPWAY.show():e.PUBLISH_EXPWAY.hide()});g.on("loaded",function(){e.PUBLISH_EXPWAY.hide();e.PUBLISH_XGATE.hide()});var n=function(a){if(l==null)l=new iNet.ui.admin.Published;l.on("back",function(){l.hide();b.show()});f.procedure=f.procedure||{};l.setData({published:a,
type:"procedure",uuid:f.procedure.uuid||"",name:f.procedure.subject});l.show();b.hide()},q=function(a){if(d==null){d=new iNet.ui.admin.ProcedureModal;d.on("success",function(){d.hide();b.show();g.load()})}d.setData(a);d.show()},r=function(a){var o=a||{};if(j==null){j=new iNet.ui.admin.ProcedureDetailWidget({bootstrap:"v2"});j.on("back",function(){j.hide();b.show()})}j.loadById(o.uuid,"XGate");j.show();b.hide()};e.ADD.on("click",function(){q()});e.PUBLISH_EXPWAY.on("click",function(){n("expway")});
e.PUBLISH_XGATE.on("click",function(){n("xgate")});iNet.ui.admin.Procedure.superclass.constructor.call(this)};iNet.extend(iNet.ui.admin.Procedure,iNet.ui.app.widget);(new iNet.ui.admin.Procedure).show()});
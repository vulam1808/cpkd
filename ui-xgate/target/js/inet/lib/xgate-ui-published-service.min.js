$(function(){iNet.ns("iNet.ui.admin","iNet.ui.admin.Published");iNet.ui.admin.Published=function(){this.id="published-div";var f=this,c={},o=null,p=iNet.zone,q=iNet.context,k=null,l=null,e={published:iNet.resources.xgate.admin.published,global:iNet.resources.global,errors:iNet.resources.errors,constant:iNet.resources.constant,validate:iNet.resources.validate},j={BACK:$("#published-back-btn"),SUBMIT:$("#published-submit-btn"),CREATE_PAGE:$("#published-create-page-btn"),CREATE_WORKFLOW:$("#published-create-workflow-btn")},
h={view_page:iNet.getUrl("design/page/list"),view_plugin:iNet.getUrl("onegate/plugin/list"),view_application:iNet.getUrl("onegate/deptapplication/list","smartcloud"),view_workflow:iNet.getUrl("cloud/workflow/defproc/list"),view_procedure:iNet.getUrl("onegate/procedure/maplist"),attach_xgate:iNet.getUrl("onegate/taskuiattach"),attach_expway:iNet.getUrl("onegate/formattach"),attach:""},b={navListItems:$("ul.setup-panel li a"),allWells:$(".setup-content"),page:$("#published-page-selected"),workflow:$("#published-workflow-selected"),
procedure:$("#published-procedure-selected"),plugin:$("#published-plugin-selected"),application:$("#published-application-selected")};b.allWells.hide();b.navListItems.on("click",function(a){a.preventDefault();a=$($(this).attr("href"));var d=$($(this).attr("button")),g=$(this).closest("li");$('button[data-handler="tabChange"]').hide();if(!g.hasClass("disabled")){b.navListItems.closest("li").removeClass("active");g.addClass("active");b.allWells.hide();a.show();d.show()}});var n=function(){!iNet.isEmpty(c.page)&&
!iNet.isEmpty(c.procedure)&&(c.published=="expway"||!iNet.isEmpty(c.workflow))?j.SUBMIT.show():j.SUBMIT.hide()},i=new DataSource({columns:[{property:"application",label:e.published.applicationName,sortable:true,disabled:true},{property:"brief",label:e.published.applicationBrief,sortable:true,disabled:true}]});(new iNet.ui.grid.Grid({id:"published-application-grid",url:h.view_application,params:{status:"PUBLISHED"},convertData:function(a){var d=a||{};return d.items||[]},dataSource:i,stretchHeight:false,
remotePaging:false,editable:false,firstLoad:true,idProperty:"uuid"})).on("click",function(a){b.application.text(a.application+" ["+a.brief+"]");c.application=a.application;n()});i=new DataSource({columns:[{property:"subject",label:e.published.procedureSubject,sortable:true,disabled:true},{property:"industry",label:e.published.procedureIndustry,sortable:true,disabled:true},{property:"formUI",label:e.published.procedureFormUI,type:"checkbox",sortable:true,disabled:true}]});(new iNet.ui.grid.Grid({id:"published-procedure-grid",
url:h.view_procedure,params:{},convertData:function(a){var d=a||{};return d.elements||[]},dataSource:i,stretchHeight:false,remotePaging:false,editable:false,firstLoad:true,idProperty:"uuid"})).on("click",function(a){b.procedure.text(a.subject);c.procedure=a.uuid;n()});i=new DataSource({columns:[{property:"name",label:e.published.workflowName,sortable:true,disabled:true}]});var r=new iNet.ui.grid.Grid({id:"published-workflow-grid",url:h.view_workflow,params:{zone:p,context:q,version:"PRODUCTION"},
convertData:function(a){var d=a||{};return d.items||[]},dataSource:i,stretchHeight:false,remotePaging:false,editable:false,firstLoad:true,idProperty:"uuid"});r.on("click",function(a){b.workflow.text(a.name);c.workflow=a.uuid;n()});i=new DataSource({columns:[{property:"name",label:e.published.pageName,sortable:true,disabled:true}]});var s=new iNet.ui.grid.Grid({id:"published-page-grid",url:h.view_page,params:{zone:p,context:q},convertData:function(a){var d=a||{};return d.items||[]},dataSource:i,stretchHeight:false,
remotePaging:false,editable:false,firstLoad:true,idProperty:"uuid"});s.on("click",function(a){b.page.text(a.name);c.page=a.uuid;n()});this.setPageBack=function(a){o=a};this.setData=function(a){c={};var d=a||{};c.type=d.type;j.SUBMIT.hide();b.page.text("");b.page.parent().parent().parent().removeClass("disabled");b.workflow.text("");b.workflow.parent().parent().parent().removeClass("disabled");b.procedure.text("");b.procedure.parent().parent().parent().removeClass("disabled");b.plugin.text("");b.plugin.parent().parent().parent().removeClass("disabled");
b.application.text("");b.application.parent().parent().parent().removeClass("disabled");switch(c.type||""){case "page":b.page.text(a.name||"");c.page=a.uuid||"";b.page.parent().parent().parent().addClass("disabled");break;case "workflow":b.workflow.text(a.name||"");c.workflow=a.uuid||"";b.workflow.parent().parent().parent().addClass("disabled");break;case "procedure":b.procedure.text(a.name||"");c.procedure=a.uuid||"";b.procedure.parent().parent().parent().addClass("disabled");break;case "plugin":b.plugin.text(a.name||
"");c.plugin=a.uuid||"";b.plugin.parent().parent().parent().addClass("disabled")}c.published=d.published;switch(c.published||""){case "expway":h.attach=h.attach_expway;$("ul.setup-panel li").each(function(g,m){$(m).removeClass("hide span3 span4 span6").addClass("span6");g>1&&$(m).addClass("hide")});break;case "xgate":h.attach=h.attach_xgate;$("ul.setup-panel li").each(function(g,m){$(m).removeClass("hide span3 span4 span6").addClass("span3");g>3&&$(m).addClass("hide")})}$("ul.setup-panel li[first] a").trigger("click")};
i=function(){if(o!=null){f.hide();o.show()}f.fireEvent("back")}.createDelegate(this);j.BACK.on("click",i);j.SUBMIT.on("click",function(){if(!iNet.isEmpty(c.page)&&!iNet.isEmpty(c.workflow)&&!iNet.isEmpty(c.procedure)){var a={page:c.page,procedure:c.procedure,graph:c.workflow,application:c.application};$.postJSON(h.attach,a,function(d){var g=d||{};console.log(">> attach >>",a,g);CommonService.isSuccess(g)?f.notifySuccess(e.constant.submit_title,e.constant.submit_success):f.notifyError(e.constant.submit_title,
f.getNotifyContent(e.constant.submit_error,g.errors||[]))},{msg:iNet.resources.ajaxLoading.processing,mask:f.getMask()})}});j.CREATE_PAGE.on("click",function(){if(!iNet.isEmpty(b.procedure.text())){if(k==null)k=new iNet.ui.builder.TPage;k.createPage(b.procedure.text());k.setPageBack(f);k.on("finish",function(){s.load()});k.show();f.hide()}});j.CREATE_WORKFLOW.on("click",function(){if(!iNet.isEmpty(b.procedure.text())){if(l==null)l=new iNet.ui.workflow.WFGraphProcess;l.createWorkflow(b.procedure.text());
l.setPageBack(f);l.on("finish",function(){r.load()});l.show();f.hide()}});iNet.ui.admin.Published.superclass.constructor.call(this)};iNet.extend(iNet.ui.admin.Published,iNet.ui.app.widget)});
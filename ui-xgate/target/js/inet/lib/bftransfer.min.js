$(function(){iNet.ns("iNet.ui.xgate","iNet.ui.xgate.BfTransfer");iNet.ui.xgate.BfTransfer=function(n){this.id="briefcase-transfer-div";var p=n||{},e=this,i=null,b={task:iNet.resources.task.task,BfTransfer:iNet.resources.xgate.BfTransfer,global:iNet.resources.global,errors:iNet.resources.errors,constant:iNet.resources.constant,validate:iNet.resources.validate},j={firms:iNet.getUrl("onegate/expwayfirms"),expway:iNet.getUrl("onegate/process/expway")},k=iNet.getLayout().window.taskFrame;k.on("typechange",
function(c){c=="min"?a.setMenuButton(true):a.setMenuButton(false)});var a=new iNet.ui.itemview({id:"briefcase-transfer",resource:b,url:j,toolbar:function(){this.id="briefcase-transfer-toolbar";this.intComponent=function(){this.$backBtn=$("#briefcase-transfer-back-btn");this.$sendBtn=$("#briefcase-transfer-send-btn");this.$backBtn.on("click",function(){e.fireEvent("back");if(i!=null){i.show();e.hide()}}.createDelegate(this));this.$sendBtn.on("click",function(){var c=k.getTaskDataIndex(),d=((c||{}).history||
{}).taskID||"",g=((c||{}).history||{}).graphID||"",f=$(this).attr("receiver")||"";if(!iNet.isEmpty(f)){var h=a.dataContent.$remove.prop("checked"),l=a.dataContent.$note.val(),o={task:d,graph:g,receiver:f,remove:h,note:l};$.postJSON(j.expway,o,function(m){console.log("transfer result >>",m);CommonService.isSuccess(m)?e.notifySuccess(b.constant.submit_title,b.constant.submit_success):e.notifyError(b.constant.submit_title,e.getNotifyContent(b.constant.submit_error,m.errors||[]))},{mask:e.getMask(),msg:iNet.resources.ajaxLoading.loading})}})}},
dataContent:function(){this.id="briefcase-transfer-data-content";this.intComponent=function(){var c=new DataSource({columns:[{align:"center",type:"selection",width:30},{property:"organName",label:b.task.organName,sortable:true,disabled:true},{property:"organAdd",label:b.task.organAdd,sortable:true,disabled:true},{property:"email",label:b.task.email,sortable:true,disabled:true},{property:"telephone",label:b.task.telephone,sortable:true,disabled:true},{property:"fax",label:b.task.fax,sortable:true,
disabled:true},{property:"website",label:b.task.website,sortable:true,disabled:true}],delay:250});this.$remove=$("#briefcase-transfer-agency-remove-chk");this.$note=$("#briefcase-transfer-note-txt");this.$grid=new iNet.ui.grid.Grid({id:"briefcase-transfer-agency-grid",url:j.firms,params:{},convertData:function(d){var g=d||{};return g.items},dataSource:c,stretchHeight:false,editable:false,firstLoad:false,idProperty:"uuid"});this.$grid.on("selectionchange",function(d){d=d.getSelection();for(var g=d.length,
f=[],h=0;h<g;h++){var l=d[h];f.push(l.organId)}if(f.length>0){a.toolbar.$sendBtn.show();a.toolbar.$sendBtn.attr("receiver",f.join(iNet.splitChar))}else{a.toolbar.$sendBtn.hide();a.toolbar.$sendBtn.attr("receiver","")}});this.$grid.on("loaded",function(){a.toolbar.$sendBtn.hide()})}},ajaxMaskId:"ajax-mask",headerDetails:{subject:"briefcase-transfer-subject-details",sender:"briefcase-transfer-sender-details"}});a.on("menuclick",function(){k.setListTaskType("menu")});this.load=function(){a.reset();a.dataContent.$grid.load();
a.setDataContent("view")};this.setPageBack=function(c,d){i=c;i!=null&&d!=false?a.toolbar.$backBtn.show():a.toolbar.$backBtn.hide()};this.setType=function(c){$("#"+e.id+' [data-id="item-view-control"].item-view').removeClass("full").addClass(c)};iNet.ui.xgate.BfTransfer.superclass.constructor.call(this)};iNet.extend(iNet.ui.xgate.BfTransfer,iNet.ui.app.widget)});
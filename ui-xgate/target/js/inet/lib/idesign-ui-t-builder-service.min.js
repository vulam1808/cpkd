$(function(){ConvertService={dateToLong:function(d,a){var g="d/m/Y";a=a||"dd/MM/yyyy";if(a=="dd/MM/yyyy")g="d/m/Y";if(a=="dd/MM/yyyy HH:mm:ss")g="d/m/Y H:i:s";if(a=="MM/dd/yyyy")g="m/d/Y";if(a=="MM/dd/yyyy HH:mm:ss")g="m/d/Y H:i:s";var c=g;if(c.length>=5)c=c.substring(0,5);g=null;if(iNet.isEmpty(d))return null;try{var k=d.substring(0,2),m=d.substring(3,5),l=d.substring(6,10);switch(c){case "m/d/Y":m=d.substring(0,2);k=d.substring(3,5)}g=(new Date(Date.parse(m+"/"+k+"/"+l))).getTime()}catch(b){return null}return!isNaN(parseFloat(g))&&
isFinite(g)?g:null},longToDate:function(d,a){var g="d/m/Y";a=a||"dd/MM/yyyy";if(a=="dd/MM/yyyy")g="d/m/Y";if(a=="dd/MM/yyyy HH:mm:ss")g="d/m/Y H:i:s";if(a=="MM/dd/yyyy")g="m/d/Y";if(a=="MM/dd/yyyy HH:mm:ss")g="m/d/Y H:i:s";var c="";if(!(!isNaN(parseFloat(d))&&isFinite(d)))return"";try{c=(new Date(parseFloat(d))).format(g)}catch(k){}return c}};PropertyService={InputHtml:function(){var d="";d+='<div class="attr attr-element">';d+='<span class="name">{2}</span>';d+='<span class="value"><input target-id="{0}" data-control="{1}" property-id="{2}" value="{3}" type="text" placeholder="{4}" /></span>';
d+="</div>";return d},ButtonHtml:function(){var d="";d+='<div class="attr attr-element">';d+='<span class="name">{2}</span>';d+='<span class="value"><button data-action="Config" target-id="{0}" data-control="{1}" property-id="{2}"  placeholder="{4}">{3}</button></span>';d+="</div>";return d},SelectHtml:function(){var d="";d+='<div class="attr attr-element">';d+='<span class="name">{2}</span>';d+='<span class="value"><select data-action="Select" target-id="{0}" data-control="{1}" property-id="{2}" value="{3}"></select></span>';
d+="</div>";return d},GridSourceHtml:function(){var d="";d+='<div class="attr attr-element">';d+='<span class="name">{2}</span>';d+='<span class="value"><button data-action="Config" target-id="{0}" source-id="{1}" property-id="{2}" style="width:84%;">{3}</button><button class="btn-circle" target-id="{0}" data-action="Minus" style="width:16%;"><i class="icon-minus"></i>></button></span>';d+="</div>";return d},GridColumnHtml:function(){var d="";d+='<div class="attr attr-element">';d+='<span class="name">{2}</span>';
d+='<span class="value"><input target-id="{0}" column-id="{1}" property-id="{2}" value="{3}" placeholder="{4}" data-type="{5}" {6} type="text" /></span>';d+="</div>";return d},GridColumnConfigHtml:function(){var d="";d+='<properties rel="{0}" ref="column" property-value="{0}"/>';d+='<column target-id="{0}">';d+='<properties rel="property" disable="disabled" property-value="{0}"/>';d+='<properties rel="label" property-value="{0}"/>';d+='<properties rel="sortable" type="boolean" placeholder="true,false" property-value="true"/>';
d+='<properties rel="disabled" type="boolean" placeholder="true,false" property-value="false"/>';d+='<properties rel="type" placeholder="text,selectx,datetime,checkbox" property-value="text"/>';d+='<properties rel="align" placeholder="left,center,right" property-value="left"/>';d+='<properties rel="width" type="int" property-value="80"/>';d+='<properties rel="require" type="boolean" placeholder="true,false" property-value="false"/>';d+='<properties rel="service" placeholder="url service" property-value=""/>';
d+='<properties rel="sourcevalue" placeholder="source value" property-value=""/>';d+='<properties rel="displayvalue" placeholder="display value" property-value=""/>';d+='<properties rel="keyvalue" placeholder="key value" property-value=""/>';d+='<properties rel="formula" placeholder="sum,avg,v.v..." property-value=""/>';d+="</column>";return d},RenderPropertyTarget:function(d,a){var g="";d.find("target").each(function(){var m=$(this);m.find("properties").each(function(){var l=m.attr("target-id")||
"",b=d.find('[target-id="'+l+'"]').attr("data-control")||"",e=$(this),j=e.attr("ref")||"",i=e.attr("rel")||"",h=e.attr("property-value")||"",s=e.attr("property-type")||"",w=e.attr("placeholder")||"";console.log(">> target properties >>",l,b,i,h);if(!iNet.isEmpty(l)&&!iNet.isEmpty(b)&&!iNet.isEmpty(i)){var o="";if(iNet.isEmpty(s))o=PropertyService.InputHtml();else if(s=="button"){h=h||"Config";o=PropertyService.ButtonHtml()}else o=PropertyService.SelectHtml();g+=String.format(o,l,b,i,h,w)}})});a.html(g);
var c=function(){a.find("input").on("change",function(){var m=$(this).attr("target-id"),l=$(this).attr("property-id"),b=$(this).attr("data-control"),e=$(this).val();console.log(">> $container change >>",m,b,l,e);switch(l){case "maskoption":case "sourcevalue":e=e.replace(/"/gi,"'");break;case "css":d.find('[target-id="'+m+'"][data-control="'+b+'"]').removeClass().addClass(e);break;case "style":d.find('[target-id="'+m+'"][data-control="'+b+'"]').attr("style",e);break;case "title":d.find('[target-id="'+
m+'"][data-control="'+b+'"]').attr("title",e);break;case "rows":d.find('[target-id="'+m+'"][data-control="'+b+'"]').attr("rows",e||3);break;case "text":e.split(".").length>1?d.find('[target-id="'+m+'"][data-control="'+b+'"]').text('$text.getText("'+e+'")'):d.find('[target-id="'+m+'"][data-control="'+b+'"]').text(e);break;case "name":if(e.substring(0,1).isNumeric())e="n"+e;e=CommonService.cleanSpecialChar(e);e=CommonService.cleanUnicode(e);if(iNet.isEmpty(e))e=RenderService.generateName();$(this).val(e);
d.find("[name]").each(function(h,s){var w=$(s).attr("name-prefix")||"";$(s).attr(l,e+w)});break;case "scanner":$(this).val()=="true"?d.find("[data-scanner]").parent().removeClass("hide"):d.find("[data-scanner]").parent().addClass("hide");var j=!d.find("[data-hardcopy]").parent().parent().hasClass("hide"),i=$(this).val()=="true";d.find(".ace-file-input").removeClass("span8 span9 span11 span12").addClass("span"+(12-(j?3:0)-(i?1:0)));break;case "hardcopy":$(this).val()=="true"?d.find("[data-hardcopy]").parent().parent().removeClass("hide"):
d.find("[data-hardcopy]").parent().parent().addClass("hide");j=!d.find("[data-hardcopy]").parent().parent().hasClass("hide");i=$(this).val()=="true";d.find(".ace-file-input").removeClass("span8 span9 span11 span12").addClass("span"+(12-(j?3:0)-(i?1:0)));break;case "hardnote":d.find("[data-hardnote]").text(" "+$(this).val());break;case "placeholder":d.find('[target-id="'+m+'"][data-control="'+b+'"]').attr(l,e)}d.find('[target-id="'+m+'"] [rel="'+l+'"]').attr("property-value",e)});a.find('[data-action="Config"]').on("click",
function(){var m=$(this).attr("target-id"),l=$(this).attr("property-id"),b=$(this).attr("data-control");console.log(">> $container click >>",m,b,l,$(this).val());switch(b){case "Grid":case "SimpleGrid":PropertyService.RenderPropertyGridSource(d,a,m)}});a.find('[data-action="Select"]').on("change",function(){var m=$(this).attr("target-id"),l=$(this).attr("property-id"),b=$(this).attr("data-control"),e=$(this).val();console.log(">> $container Select >>",m,b,l,$(this).val());d.find('[target-id="'+m+
'"] [rel="'+l+'"]').attr("property-value",$(this).val());switch(l){case "application":var j=a.find('[target-id="'+m+'"][property-id="widget"]');j.find('[rel="widget"]').attr("property-value","");$.postJSON(iNet.getUrl("application/widget/list"),{module:e,pageSize:1E4},function(i){if(!iNet.isEmpty((i||{}).items)){var h="";$.each((i||{}).items||[],function(s,w){h+='<option value="'+w.uuid+'">'+w.name+"</option>"});j.html(h);j.attr("value","").val("")}})}})},k=a.find('[data-action="Select"]');k.length==
0?c():$.each(k||[],function(m){var l=$(this).attr("target-id"),b=$(this).attr("property-id"),e=$(this).attr("data-control");switch(b){case "application":$.postJSON(iNet.getUrl("system/application/list"),{},function(i){if(!iNet.isEmpty((i||{}).elements)){var h=a.find('[target-id="'+l+'"][property-id="application"]'),s="";$.each((i||{}).elements||[],function(w,o){s+='<option value="'+o.module+'">'+o.name+"</option>"});h.html(s);h.val(h.attr("value"))}});break;case "widget":var j=a.find('[target-id="'+
l+'"][property-id="application"]').attr("value")||"";iNet.isEmpty(j)||$.postJSON(iNet.getUrl("application/widget/list"),{module:j,pageSize:1E4},function(i){var h=a.find('[target-id="'+l+'"][property-id="widget"]');if(!iNet.isEmpty((i||{}).items)){var s="";$.each((i||{}).items||[],function(w,o){s+='<option value="'+o.uuid+'">'+o.name+"</option>"});h.html(s)}h.val(h.attr("value"))})}m==k.length-1&&c()})},RenderPropertyGridSource:function(d,a,g){var c=d.find("[data-properties]"),k=d.find('datasource[target-id="'+
g+'"]'),m="";m+='<div class="attr attr-element">';m+='<span class="name"><button class="btn-circle" data-action="Back"><i class="icon-arrow-left"></i></button></span>';m+='<span class="value">';m+='<input data-action="Type" placeholder="Column name" type="text" style="width:84%;" />';m+='<button data-action="Add" class="btn-circle" style="width:16%;"><i class="icon-plus"></i></button>';m+="</span>";m+="</div>";k.each(function(){$(this).find('[ref="column"]').each(function(){var l=$(this).attr("rel")||
"";m+=String.format(PropertyService.GridSourceHtml(),l,g,"column",l,l)})});a.html(m);a.find('[data-action="Type"]').on("change",function(){a.find('[data-action="Add"]').attr("column",$(this).val())});a.find('[data-action="Back"]').on("click",function(){PropertyService.RenderPropertyTarget(d,a)});a.find('[data-action="Add"]').on("click",function(){a.find('[data-action="Type"]').val("");var l=$(this).attr("column")||"";if(!iNet.isEmpty(l)){$(this).attr("column","");var b="";if(k.length==0)b+='<datasource target-id="'+
g+'">';b+=String.format(PropertyService.GridColumnConfigHtml(),l);if(k.length==0){b+="</datasource>";c.append(b);k=d.find('datasource[target-id="'+g+'"]')}else k.append(b);var e=String.format(PropertyService.GridSourceHtml(),l,g,"column",l,l);a.append(e);a.find('[data-action="Minus"][target-id="'+l+'"]').on("click",function(){k.find('[rel="'+l+'"]').remove();k.find('column[target-id="'+l+'"]').remove();if(k.children().length==0){k.remove();k=d.find('datasource[target-id="'+g+'"]')}$(this).parent().parent().remove()});
a.find('[data-action="Config"][target-id="'+l+'"]').on("click",function(){PropertyService.RenderPropertyGridColumn(d,a,g,l)})}});a.find('[data-action="Minus"]').on("click",function(l){var b=$(l.currentTarget).attr("target-id")||"";if(!iNet.isEmpty(b)){k.find('[rel="'+b+'"]').remove();k.find('column[target-id="'+b+'"]').remove();if(k.children().length==0){k.remove();k=d.find('datasource[target-id="'+g+'"]')}$(this).parent().parent().remove()}});a.find('[data-action="Config"]').on("click",function(l){var b=
$(l.currentTarget).attr("target-id")||"";iNet.isEmpty(b)||PropertyService.RenderPropertyGridColumn(d,a,g,b)})},RenderPropertyGridColumn:function(d,a,g,c){d.find("[data-properties]");var k=d.find('datasource[target-id="'+g+'"]'),m="";m+='<div class="attr attr-element">';m+='<span class="name"><button class="btn-circle" data-action="Back"><i class="icon-arrow-left"></i></button></span>';m+='<span class="value"><button>'+c+"</button></span>";m+="</div>";k.find('column[target-id="'+c+'"]').children().each(function(){var l=
$(this),b=l.attr("rel")||"",e=l.attr("property-value")||"",j=l.attr("disable")||"",i=l.attr("type")||"text",h=l.attr("placeholder")||"";m+=String.format(PropertyService.GridColumnHtml(),g,c,b,e,h,i,j)});a.html(m);a.find("input").on("change",function(){var l=$(this).attr("target-id")||"",b=$(this).attr("column-id")||"",e=$(this).attr("property-id")||"";!iNet.isEmpty(l)&&!iNet.isEmpty(b)&&!iNet.isEmpty(e)&&k.find('column[target-id="'+b+'"] [rel="'+e+'"]').attr("property-value",$(this).val())});a.find('[data-action="Back"]').on("click",
function(){PropertyService.RenderPropertyGridSource(d,a,g)})}};ControlService={RenderSelect:function(d,a,g,c,k,m,l,b){var e=a||[],j=g||"id",i=c||1,h=iNet.isEmpty(k)?true:k,s=iNet.isEmpty(m)?false:m,w=iNet.isEmpty(l)?{}:l,o=iNet.isFunction(b)?b:"",f={};f.id=d;f.placeholder="Select value";f.allowClear=h;f.multiple=s;f.data={results:e,text:function(t){return iNet.isEmpty(t.name)?"":t.name}};f.idValue=function(t){return t[j]};f.initSelection=function(t,n){var p=j,u=t.val().split(",")||[],x=[],v="",y=
s;if(!iNet.isEmpty(u))for(var q=0;q<u.length;q++)for(var r=0;r<e.length;r++)if(p=="id"?e[r][p].toString()==u[q].toString():e[r][p].toString()==u[q].toString()){e[r].name=iNet.isEmpty(e[r].name)?"":e[r].name;e[r].code=iNet.isEmpty(e[r].code)?"":e[r].code;if(y)x.push(e[r]);else v=e[r];break}y?n(x):n(v)};f.formatResult=function(t){var n=iNet.isEmpty(t.code)?"":t.code,p=iNet.isEmpty(t.name)?"":t.name;t=p;var u=String.format('<span style="color: #c09853; text-align: right; padding-right: 5px"><strong>{0}<strong></strong></strong></span> {1}',
n,p);return i==1?t:u};f.formatSelection=function(t){var n=iNet.isEmpty(t.code)?"":t.code,p=iNet.isEmpty(t.name)?"":t.name;t=p;var u=String.format('<label class="label label-info marg-b-0">{0}</label> {1}',n,p);return i==1?t:u};if(!iNet.isEmpty(l))f.ajax=w;if(!iNet.isEmpty(o))f.query=b;return new iNet.ui.form.select.Select(f)},RenderDate:function(d){var a=$("#"+d).datepicker({format:"dd/mm/yyyy"}).on("changeDate",function(){a.hide()}).data("datepicker");$("#"+d).next().on("click",function(){$(this).prev().focus()});
$("#"+d).on("keydown",function(g){if(g.which==13||g.which==9)a.hide()});return a},RenderGrid:function(d,a){return new iNet.ui.grid.Grid({id:d,url:"",dataSource:a,stretchHeight:false,pageSize:5E3,editable:true,firstLoad:false,hideHeader:true,hideSearch:true,rowClass:function(g){if(g.rowTotal==true)return"rowTotal"},idProperty:"autoId"})},RenderScanner:function(d){$('[data-id="jsScanner"]').remove();var a="";a+='<div data-id="jsScanner" style="height: 1px; width: 1px;">';a+='<script type="text/javascript" src="https://www.inetcloud.vn/public/tool/jsScanner.js"><\/script>';
a+='<embed id="deployJavaPlugin" type="application/java-deployment-toolkit" hidden="true">';a+='<applet id="com_asprise_scan_applet" codebase="https://www.inetcloud.vn/public/tool/" archive="com-asprise-scan-applet.jar" code="com.asprise.imaging.scan.ui.web.ScanApplet" width="1" height="1" style="z-index: -999;"><param name="permissions" value="all-permissions"><param name="java_version" value="1.6+"><param name="java_arguments" value="-Xmx512m"><param name="separate_jvm" value="true"><param name="codebase_lookup" value="false"></applet>';
a+="</div>";$("#"+d).parent().append(a)},RemoveScanner:function(){$('[data-id="jsScanner"]').remove()}};BuilderService={PublicControl:function(d,a){if(iNet.isEmpty(window.iNet))window.iNet={};if(iNet.isEmpty(window.iNet.controls))window.iNet.controls={};if(!iNet.isEmpty(d)){console.log(">> PublicControl >>",d);window.iNet.controls[d]=a}},CreateText:function(d,a,g,c){$("#"+a);d.find('[name="'+g+'"]');var k=c||{},m=g||"",l=k[m]||"";BuilderService.PublicControl(g,$("#"+a))},CreateSelect:function(d,a,
g,c){var k=d.find("[data-properties]"),m=$("#"+a).attr("target-id")||"";d.find('[name="'+g+'"]');var l=c||{},b=g||"",e=l[b]||"",j=[],i=null;if(iNet.isEmpty(m)){i=ControlService.RenderSelect(a,j,"",2,true,false);BuilderService.PublicControl(g,i);return i}else{var h=k.find('[target-id="'+m+'"] [rel="service"]').attr("property-value")||"";if(iNet.isEmpty(h)){i=ControlService.RenderSelect(a,j,"",2,true,false);BuilderService.PublicControl(g,i);return i}else $.postJSON(iNet.getUrl(h),{},function(s){for(var w in s)if(iNet.isArray(s[w])){$.each(s[w]||
[],function(o,f){var t={id:f.id||"",code:f.code||"",name:f.name||"",obj:f};j.push(t)});i=ControlService.RenderSelect(a,j,"",2,true,false);BuilderService.PublicControl(g,i);return i}})}},CreateDate:function(d,a,g,c){$("#"+a);d.find('[name="'+g+'"]');var k=c||{},m=g||"",l=k[m]||"";ControlService.RenderDate(a);BuilderService.PublicControl(g,$("#"+a))},CreateGrid:function(d,a,g,c,k){var m=d.find("[data-properties]"),l=$("#"+a).attr("target-id")||"",b=(m.find('[rel="showtotal"]').attr("property-value")||
"false")=="true",e=d.find('[name="'+g+'"]'),j=c||{},i=g||"",h=j[i]||[],s=function(u){var x=[],v=u||"";$.postJSON(iNet.getUrl(v),{},function(q){for(var r in q)if(iNet.isArray(q[r]))$.each(q[r]||[],function(z,C){var A={id:C.id||"",code:C.code||"",name:C.name||"",obj:C};x.push(A)})});var y={placeholder:"Select one value",multiple:false,allowClear:true,data:x,minimumInputLength:0,initSelection:function(q,r){var z=$(q).val();console.log(">> initSelection id >>",x.length);z!=""&&x.length>0&&$.each(x,function(C,
A){if(A.id==z){if(iNet.isEmpty(A.name))A.name="empty";r(A)}})},formatResult:function(q){return q.name},formatSelection:function(q){return q.name},query:function(q){var r={results:[]};$.each(x,function(){if(q.term.length==0||this.code.toUpperCase().indexOf(q.term.toUpperCase())>=0||this.name.toUpperCase().indexOf(q.term.toUpperCase())>=0)r.results.push(this)});q.callback(r)},escapeMarkup:function(q){return q}};return y},w=[],o=m.find('datasource[target-id="'+l+'"]:first');o.find('[ref="column"]').each(function(){var u=
$(this),x=u.attr("ref")||"",v=u.attr("rel")||"",y={};o.find('column[target-id="'+v+'"]:first').children().each(function(){var q=$(this),r=q.attr("rel")||"",z=q.attr("property-value")||"",C=q.attr("type")||"text";if(r=="service"){y[r]=z;if(!iNet.isEmpty(z))y.config=s(z)}else if(r=="require"){y[r]=z;if(z=="true")y.validate=function(A){if($.trim(A)=="")return String.format("{} required!","")}}else y[r]=C=="boolean"?z=="true"?true:false:z});console.log(">> column >>",v,y);w.push(y)});var f={label:"",
type:"action",width:32,align:"center",buttons:[{text:"Delete",icon:"icon-trash",labelCls:"label label-important",fn:function(u){n.remove(u.autoId)},visibled:function(u){return!u.rowTotal}}]};w.push(f);var t=new DataSource({columns:w,delay:250}),n=ControlService.RenderGrid(a,t),p=h;e.val(iNet.JSON.encode(h));n.loadData(h);n.setEditable(!k);BuilderService.PublicControl(g,n);d.find('[data-action="add"]').on("click",function(){n.newRecord({})});(function(){if(b){var u={},x={};m.find('[rel="formula"]').each(function(){var q=
$(this),r=q.attr("property-value")||"",z=q.parent().attr("target-id")||"";if(!iNet.isEmpty(r)&&!iNet.isEmpty(z))u[z]=r;else iNet.isEmpty(z)||(x[z]="")});var v={autoId:"rowTotal",rowTotal:true},y;for(y in u)$.each(p||[],function(q,r){v[y]=(v[y]||0)+(iNet.isNumber(Number(r[y]))?Number(r[y])||0:0)});for(y in x)v[y]="";n.insert(v);n.fireEvent("calc",v)}}).createDelegate(this);n.on("save",function(u){var x=u||{};x.autoId=iNet.generateId();n.insert(x);p.push(x);e.val(iNet.JSON.encode(p));n.newRecord({})});
n.on("calc",function(u){n._switchView(u);console.log(">>> ",n.getById("rowTotal"));n.cancel("rowTotal")});n.on("update",function(u,x){var v=iNet.apply(x,u)||{};n.update(v);n.commit();$.each(p||[],function(y,q){q.autoId==v.autoId&&iNet.apply(q,v)});e.val(iNet.JSON.encode(p))});n.on("blur",function(u,x){var v=null;if(u=="update")n.endEdit();else{v=n.getNewRow();x.save()}n.isValid(v)});n.on("click",function(){});n.on("change",function(){});n.on("selectionchange",function(){});n.on("controlclick",function(){})},
CreateFile:function(d,a){$("#"+a).on("change",function(){if(this.files.length<1)this.files=[];else{var g=this.files[0].name;d.find("span[data-title]").attr("data-title",g)}});d.find("[data-container]").on("click",function(){$("#"+a).trigger("click")})},CreateSimpleGrid:function(){}};PublicService={Widget:function(d,a){var g=d.find("[data-properties]"),c=d.find('[data-control="Widget"]').prop("id")||"",k=$("#"+c).attr("target-id")||"",m=g.find('[rel="widget"]:first').attr("property-value")||"";$("#"+
c).find("[widget]").attr("widget",m);$("#"+c).find("[widget]").attr("name","widget");var l="";l+='<script type="text/javascript">';l+="$(function() {\n";l+='iNet.controls["'+a+'"] = $("#'+c+'");\n';l+='iNet.controls["'+a+'"].validate = "'+a+'";\n';l+='iNet.controls["'+a+'"].type="Widget";\n';l+="});";l+="<\/script>";var b='<WidgetControl id="{0}">{1}</WidgetControl>';return String.format(b,a,l)},Label:function(d,a){d.find("[data-properties]");var g=d.find('[data-control="Label"]').prop("id")||"",
c=$("#"+g).attr("target-id")||"",k="";k+='<script type="text/javascript">';k+="$(function() {\n";k+='iNet.controls["'+a+'"] = $("#'+g+'");\n';k+='iNet.controls["'+a+'"].validate = "'+a+'";\n';k+='iNet.controls["'+a+'"].type="Label";\n';k+='if(!(!!"$editmode" && "$editmode" == "true")) {\n';k+="}\n";k+='iNet.controls["'+a+'"].validate = "'+a+'";\n';k+='iNet.controls["'+a+'"].setValue = function(value){\n';k+='$("#'+g+'").text(value); \n';k+="}\n";k+='iNet.controls["'+a+'"].getValue = function(){\n';
k+='return $("#'+g+'").text(); \n';k+="}\n";k+="});";k+="<\/script>";var m='<LabelControl id="{0}">{1}</LabelControl>';return String.format(m,a,k)},Text:function(d,a){var g=d.find("[data-properties]"),c=d.find('[data-control="Text"]').prop("id")||"",k=$("#"+c).attr("target-id")||"",m=g.find('[rel="require"]:first').attr("property-value")||"",l=g.find('[rel="errormessage"]:first').attr("property-value")||"*",b=g.find('[rel="mask"]:first').attr("property-value")||"",e=g.find('[rel="maskoption"]:first').attr("property-value")||
"",j="";j+='<script type="text/javascript">';j+="$(function() {\n";j+='iNet.controls["'+a+'"] = $("#'+c+'");\n';j+='iNet.controls["'+a+'"].validate = "'+a+'";\n';j+='iNet.controls["'+a+'"].type="Text";\n';j+='iNet.controls["'+a+'"].setValue = function(value){\n';j+='$("#'+c+'").val(value); \n';j+="}\n";j+='iNet.controls["'+a+'"].getValue = function(){\n';j+='return $("#'+c+'").val(); \n';j+="}\n";if(!iNet.isEmpty(b)){var i="{}";try{e=e.replace(/'/gi,'"');i=iNet.JSON.decode(e);i=e}catch(h){}j+='$("#'+
c+'").mask("'+b+"\", iNet.JSON.decode('"+i+"'));\n"}if(m=="true"){j+='iNet.controls["'+a+'"].validate = function(){\n';j+="return new iNet.ui.form.Validate({\n";j+='id: iNet.findForm($("#'+c+'")),\n';j+="rules: [\n";j+="{\n";j+='id: "'+c+'",\n';j+="validate: function (v) {\n";j+="if (iNet.isEmpty(v)){\n";j+=' if (iNet.isEmpty($("#'+c+'").attr("value") || "")){\n';j+='  return "'+l+'";\n';j+=" }\n";j+="}\n";j+="}\n";j+="}\n";j+="]\n";j+="});\n";j+="};\n";j+='iNet.controls["'+a+'"].messageError = "'+
l+'"\n'}j+='if(!(!!"$editmode" && "$editmode" == "true")) {\n';j+='$("#'+c+'").attr("disabled", "disabled"); \n';j+="}\n";j+="});";j+="<\/script>";var s='<TextControl id="{0}">{1}</TextControl>';return String.format(s,a,j)},Check:function(d,a){d.find("[data-properties]");var g=d.find('[data-control="Check"]').prop("id")||"",c=$("#"+g).attr("target-id")||"",k="";k+='<script type="text/javascript">';k+="$(function() {\n";k+='iNet.controls["'+a+'"] = $("#'+g+'");\n';k+='iNet.controls["'+a+'"].validate = "'+
a+'";\n';k+='iNet.controls["'+a+'"].type="Check";\n';k+='$("#'+g+'").on("change", function(){; \n';k+='$("#'+g+'").attr("value", $("#'+g+'").prop("checked")); \n';k+="});";k+='if(!(!!"$editmode" && "$editmode" == "true")) {\n';k+='$("#'+g+'").attr("disabled", "disabled"); \n';k+="}\n";k+="});";k+="<\/script>";var m='<CheckControl id="{0}">{1}</CheckControl>';return String.format(m,a,k)},Number:function(d,a){var g=d.find("[data-properties]"),c=d.find('[data-control="Number"]').prop("id")||"",k=$("#"+
c).attr("target-id")||"",m=g.find('[rel="require"]:first').attr("property-value")||"",l=g.find('[rel="errormessage"]:first').attr("property-value")||"*",b=g.find('[rel="mask"]:first').attr("property-value")||"",e=g.find('[rel="maskoption"]:first').attr("property-value")||"",j="";j+='<script type="text/javascript">';j+="$(function() {\n";j+='iNet.controls["'+a+'"] = $("#'+c+'");\n';j+='iNet.controls["'+a+'"].validate = "'+a+'";\n';j+='iNet.controls["'+a+'"].type="Number";\n';j+='iNet.controls["'+a+
'"].setValue = function(value){\n';j+='$("#'+c+'").val(value); \n';j+="}\n";j+='iNet.controls["'+a+'"].getValue = function(){\n';j+='return $("#'+c+'").val(); \n';j+="}\n";if(!iNet.isEmpty(b)){var i="{}";try{e=e.replace(/'/gi,'"');i=iNet.JSON.decode(e);i=e}catch(h){}j+='$("#'+c+'").mask("'+b+"\", iNet.JSON.decode('"+i+"'));\n"}if(m=="true"){j+='iNet.controls["'+a+'"].validate = function(){\n';j+="return new iNet.ui.form.Validate({\n";j+='id: iNet.findForm($("#'+c+'")),\n';j+="rules: [\n";j+="{\n";
j+='id: "'+c+'",\n';j+="validate: function (v) {\n";j+="if (iNet.isEmpty(v)){\n";j+=' if (iNet.isEmpty($("#'+c+'").attr("value") || "")){\n';j+='  return "'+l+'";\n';j+=" }\n";j+="}\n";j+="}\n";j+="}\n";j+="]\n";j+="});\n";j+="};\n";j+='iNet.controls["'+a+'"].messageError = "'+l+'"\n'}j+='if(!(!!"$editmode" && "$editmode" == "true")) {\n';j+='$("#'+c+'").attr("disabled", "disabled"); \n';j+="}\n";j+="});";j+="<\/script>";var s='<NumberControl id="{0}">{1}</NumberControl>';return String.format(s,a,
j)},Date:function(d,a){var g=d.find("[data-properties]"),c=d.find('[data-control="Date"]').prop("id")||"",k=d.find('[data-control="Text"]').prop("id")||"",m=$("#"+c).attr("target-id")||"",l=g.find('[rel="require"]:first').attr("property-value")||"",b=g.find('[rel="errormessage"]:first').attr("property-value")||"*",e=g.find('[rel="mask"]:first').attr("property-value")||"",j=g.find('[rel="maskoption"]:first').attr("property-value")||"",i="";i+='<script type="text/javascript">';i+="\n";i+="$(function() {\n";
i+='iNet.controls["'+a+'"] = $("#'+c+'").datepicker({\n';i+='format: "dd/mm/yyyy"\n';i+='}).on("changeDate", function (ev) {\n';i+='$("#'+k+'").val(ConvertService.dateToLong($("#'+c+'").val()));\n';i+='iNet.controls["'+a+'"].hide();\n';i+='}).data("datepicker");\n';i+='iNet.controls["'+a+'"].validate = "'+a+'";\n';i+='iNet.controls["'+a+'"].type="Date";\n';if(!iNet.isEmpty(e)){var h="{}";try{j=j.replace(/'/gi,'"');h=iNet.JSON.decode(j);h=j}catch(s){}i+='$("#'+c+'").mask("'+e+"\", iNet.JSON.decode('"+
h+"'));\n"}if(l=="true"){i+='iNet.controls["'+a+'"].validate = function(){\n';i+="return new iNet.ui.form.Validate({\n";i+='id: iNet.findForm($("#'+c+'")),\n';i+="rules: [\n";i+="{\n";i+='id: "'+c+'",\n';i+="validate: function (v) {\n";i+="if (iNet.isEmpty(v)){\n";i+=' if (iNet.isEmpty($("#'+c+'").attr("value") || "")){\n';i+='  return "'+b+'";\n';i+=" }\n";i+="}\n";i+="}\n";i+="}\n";i+="]\n";i+="});\n";i+="};\n";i+='iNet.controls["'+a+'"].messageError = "'+b+'"\n'}i+='iNet.controls["'+a+'"].setValue = function(value){\n';
i+='$("#'+c+'").val(value); \n';i+='$("#'+k+'").val(ConvertService.dateToLong($("#'+c+'").val())); \n';i+="}\n";i+='iNet.controls["'+a+'"].getValue = function(){\n';i+='return $("#'+c+'").val(); \n';i+="}\n";i+='iNet.controls["'+a+'"].setDate = function(date){\n';i+='$("#'+c+'").val(date); \n';i+='$("#'+k+'").val(ConvertService.dateToLong($("#'+c+'").val())); \n';i+="}\n";i+='if(!(!!"$editmode" && "$editmode" == "true")) {\n';i+='$("#'+c+'").attr("disabled", "disabled"); \n';i+="}\n";i+='$("#'+c+
'").next().on("click", function () {\n';i+="$(this).prev().focus();\n";i+="});\n";i+='$("#'+c+'").on("keydown", function (ev) {\n';i+="if (ev.which == 13 || ev.which == 9) {\n";i+='$("#'+k+'").val(ConvertService.dateToLong($("#'+c+'").val()));\n';i+='iNet.controls["'+a+'"].hide();\n';i+="}\n";i+="});\n";i+='$("#'+c+'").on("change", function (ev) {\n';i+='$("#'+k+'").val(ConvertService.dateToLong($("#'+c+'").val()));\n';i+='$("#'+c+'").val(ConvertService.longToDate($("#'+k+'").val()));\n';i+="});\n";
i+='$("#'+c+'").val(ConvertService.longToDate($("#'+k+'").val()));\n';i+="});\n";i+="<\/script>";var w='<DateControl id="{0}">{1}</DateControl>';return String.format(w,a,i)},File:function(d,a){var g=d.find("[data-properties]"),c=d.find('[data-control="File"]').prop("id")||"",k=$("#"+c).attr("target-id")||"",m=g.find('[rel="require"]:first').attr("property-value")||"",l=g.find('[rel="errormessage"]:first').attr("property-value")||"*",b="";b+='<script type="text/javascript">';b+="$(function() {\n";
b+='iNet.controls["'+a+'"] = $("#'+c+'");\n';b+='iNet.controls["'+a+'"].validate = "'+a+'";\n';b+='iNet.controls["'+a+'"].type="File";\n';if(m=="true"){b+='iNet.controls["'+a+'"].validate = function(){\n';b+="return new iNet.ui.form.Validate({\n";b+='id: iNet.findForm($("#'+c+'")),\n';b+="rules: [\n";b+="{\n";b+='id: "'+c+'",\n';b+="validate: function (v) {\n";b+="if (iNet.isEmpty(v)){\n";b+='      var $fileContent = $("#'+c+'").parent();\n';b+='      var dataHardCopy = ($fileContent.find("input[data-hardcopy]").length > 0) ? $fileContent.find("input[data-hardcopy]").val() : "noHardCopy";\n';
b+='      var dataScanner = ($fileContent.find("input[data-scanner]").length > 0) ? $fileContent.find("input[data-scanner]").val() : "noScanner";\n';b+='      var dataFile = ($fileContent.css("display")=="none") || !iNet.isEmpty($("#'+c+'").val());\n';b+='      if (dataHardCopy=="false" && iNet.isEmpty(dataScanner) && dataFile){\n';b+='           return "'+l+'";\n';b+="      }\n";b+="}\n";b+="}\n";b+="}\n";b+="]\n";b+="});\n";b+="};\n";b+='iNet.controls["'+a+'"].validateCheck = function(){\n';b+=
'if (!iNet.controls["'+a+'"].validate().check()){\n';b+='$("#'+c+'").parent().find("label[data-title]").addClass("tooltip-error error");\n';b+='$("#'+c+'").parent().find("label[data-title]").attr("title", "'+l+'");\n';b+="} else {\n";b+='$("#'+c+'").parent().find("label[data-title]").removeClass("tooltip-error error");\n';b+='$("#'+c+'").parent().find("label[data-title]").attr("title", "");\n';b+="};\n";b+="};\n";b+='iNet.controls["'+a+'"].messageError = "'+l+'"\n'}b+='$("#'+c+'").on("change", function(){\n';
b+="if (this.files.length < 1) {\n";b+="this.files = [];\n";b+="return;\n";b+="}\n";b+='$("#'+c+'").parent().find("span[data-title]").attr("data-title", this.files[0].name);\n';b+='$("#'+c+'").parent().find("label[data-title]").addClass("selected");\n';b+='$("#'+c+'").parent().find("input[data-scanner]").attr("value","");\n';b+="});\n";b+='if(!!"$editmode" && "$editmode" == "true") {\n';b+='$("#'+c+'").parent().find("[data-container] label[data-title]").on("click", function(){\n';b+='$("#'+c+'").trigger("click");\n';
b+="});\n";b+='$("#'+c+'").parent().find("[data-remove]").on("click", function(){\n';b+='$("#'+c+'").val("");\n';b+='$("#'+c+'").parent().find("label[data-title]").removeClass("selected");\n';b+='$("#'+c+'").parent().find("span[data-title]").attr("data-title","...");\n';b+="});\n";b+='$("#'+c+'").parent().find("[data-hardcopy]").on("change", function(){\n';b+='$(this).attr("value", $(this).prop("checked"));\n';b+="});\n";b+="function "+a+"ScanIndex(url, images, i, docID) {\n";b+="var __data = {};\n";
b+="__data.scanner_mimetype1 = images[i].mimetype;\n";b+="__data.scanner_base1 = images[i].data;\n";b+="if (!iNet.isEmpty(docID)) {\n";b+="__data.docID = docID;\n";b+="}\n";b+="$.postJSON(url, __data, function (result) {\n";b+="var __result = result || {};\n";b+="if (!iNet.isEmpty(__result.uuid)) {\n";b+='var __docID = __result.uuid || "";\n';b+='var __fileID = __result.file || "Scanner completed ....";\n';b+="if (i >= (images.length - 1)) {\n";b+='$("#'+c+'").val("");\n';b+='$("#'+c+'").parent().find("label[data-title]").removeClass("selected");\n';
b+='$("#'+c+'").parent().find("span[data-title]").attr("data-title",__fileID);\n';b+='$("#'+c+'").parent().find("input[data-scanner]").attr("value",__docID);\n';b+="} else {\n";b+='var __process = "...";\n';b+='if(i%2==0) {__process = "......";}\n';b+='if(i%3==0) {__process = ".........";}\n';b+='$("#'+c+'").parent().find("span[data-title]").attr("data-title",__process);\n';b+=""+a+"ScanIndex(url, images, (i + 1), __docID);\n";b+="}\n";b+="} else {\n";b+='$("#'+c+'").val("");\n';b+='$("#'+c+'").parent().find("label[data-title]").removeClass("selected");\n';
b+='$("#'+c+'").parent().find("span[data-title]").attr("data-title",__fileID);\n';b+='$("#'+c+'").parent().find("input[data-scanner]").attr("value",__docID);\n';b+="}\n";b+="});\n";b+="}\n";b+="function "+a+"CallBackFunc(success, mesg, thumbs, images) {\n";b+="if ((images instanceof Array) && images.length > 0){\n";b+=""+a+'ScanIndex(iNet.getUrl("firmtask/scanner/upload"), images, 0, "");\n';b+="}\n";b+='ControlService.RemoveScanner("'+c+'");\n';b+="}\n";b+='$("#'+c+'").parent().find("[data-scanner]").on("click", function(){\n';
b+='ControlService.RenderScanner("'+c+'");\n';b+="setTimeout(function(){\n";b+="com_asprise_scan_request("+a+"CallBackFunc, // callback on dialog closed\n";b+="com_asprise_scan_cmd_method_SCAN, // action: SCAN\n";b+="com_asprise_scan_cmd_return_IMAGES_AND_THUMBNAILS, // return types\n";b+='{"wia-version": 2} // options\n';b+=");\n";b+="}, 2000);\n";b+="});\n";b+="}\n";b+="});";b+="<\/script>";var e='<FileControl id="{0}">{1}</FileControl>';return String.format(e,a,b)},Select:function(d,a){var g=d.find("[data-properties]"),
c=d.find('[data-control="Select"]').prop("id")||"",k=$("#"+c).attr("target-id")||"",m=g.find('[rel="service"]:first').attr("property-value")||"",l=g.find('[rel="sourcevalue"]:first').attr("property-value")||"",b=g.find('[rel="displayvalue"]:first').attr("property-value")||"",e=g.find('[rel="keyvalue"]:first').attr("property-value")||"",j=g.find('[rel="require"]:first').attr("property-value")||"",i=g.find('[rel="errormessage"]:first').attr("property-value")||"*",h="";h+='<script type="text/javascript">';
h+="$(function() {\n";h+='iNet.sources["'+a+'"] = {};\n';h+='iNet.sources["'+a+'"]["'+a+'"] = [];\n';h+='iNet.ajaxs["'+a+'"] = {};\n';if(iNet.isEmpty(m)){h+='iNet.sources["'+a+'"]["'+a+'"] = []; \n';if(!iNet.isEmpty(l)){var s=[];try{s=eval(l)}catch(w){s=[]}$.each(s,function(t,n){h+='iNet.sources["'+a+'"]["'+a+'"].push({id: "'+(iNet.isEmpty(n[e||"id"])?"EmptyId":n[e||"id"])+'", code: "'+(iNet.isEmpty(n[e||"code"])?"EmptyCode":n[e||"code"])+'", name: "'+(iNet.isEmpty(n[b||"name"])?"EmptyName":n[b||
"name"])+'"}); \n'})}h+='iNet.controls["'+a+'"] = ControlService.RenderSelect("'+c+'",iNet.sources["'+a+'"]["'+a+'"],"id",1,true,false);\n';h+='iNet.controls["'+a+'"].validate = "'+a+'";\n';h+='iNet.controls["'+a+'"].type="Select";\n';if(j=="true"){h+='iNet.controls["'+a+'"].validate = function(){\n';h+="return new iNet.ui.form.Validate({\n";h+='id: iNet.findForm($("#'+c+'")),\n';h+="rules: [\n";h+="{\n";h+='id: "'+c+'",\n';h+="validate: function (v) {\n";h+="if (iNet.isEmpty(v)){\n";h+=' if (iNet.isEmpty($("#'+
c+'").attr("value") || "")){\n';h+='  return "'+i+'";\n';h+=" }\n";h+="}\n";h+="}\n";h+="}\n";h+="]\n";h+="});\n";h+="};\n";h+='iNet.controls["'+a+'"].messageError = "'+i+'"\n'}h+='if(!(!!"$editmode" && "$editmode" == "true")) {\n';h+='$("#'+c+'").attr("disabled", "disabled"); \n';h+="}\n"}else{h+='iNet.ajaxs["'+a+'"]["postJSON'+a+'"] = \n';h+='$.postJSON(iNet.getUrl("'+m+'"), { pageNumber: 0, pageSize: 9999 }, function(result){ \n';h+="var __result = result || {}; \n";var o="";$(b.split(",")).each(function(t,
n){if(t>0&&t<b.split(",").length)o+=' + " - " + ';o=o+'(obj["'+(n||"name")+'"] || "")'});if(iNet.isEmpty(l)){h+="for (var key in __result) {\n";h+="if (iNet.isArray(__result[key])) {\n";h+="$.each(__result[key] || [], function (i, obj) {\n";h+='iNet.sources["'+a+'"]["'+a+'"].push({id: (obj["'+(e||"id")+'"] || "EmptyId"), code: (obj["'+(e||"code")+'"] || "EmptyCode"), name: ('+o+' || "EmptyName"), obj: obj}); \n';h+="});\n";h+="}\n"}else{h+='if (iNet.isArray(__result["'+l+'"])) {\n';h+='$.each(__result["'+
l+'"] || [], function (i, obj) {\n';h+='iNet.sources["'+a+'"]["'+a+'"].push({id: (obj["'+(e||"id")+'"] || "EmptyId"), code: (obj["'+(e||"code")+'"] || "EmptyCode"), name: ('+o+' || "EmptyName"), obj: obj}); \n';h+="});\n"}h+="}\n";h+="});\n";h+="$.when(";h+='iNet.ajaxs["'+a+'"]["postJSON'+a+'"]';h+=").done(function(){\n";h+='iNet.controls["'+a+'"] = ControlService.RenderSelect("'+c+'",iNet.sources["'+a+'"]["'+a+'"],"id",1,true,false);\n';h+='iNet.controls["'+a+'"].validate = "'+a+'";\n';h+='iNet.controls["'+
a+'"].type="Select";\n';if(j=="true"){h+='iNet.controls["'+a+'"].validate = function(){\n';h+="return new iNet.ui.form.Validate({\n";h+='id: iNet.findForm($("#'+c+'")),\n';h+="rules: [\n";h+="{\n";h+='id: "'+c+'",\n';h+="validate: function (v) {\n";h+="if (iNet.isEmpty(v)){\n";h+=' if (iNet.isEmpty($("#'+c+'").attr("value") || "")){\n';h+='  return "'+i+'";\n';h+=" }\n";h+="}\n";h+="}\n";h+="}\n";h+="]\n";h+="});\n";h+="};\n";h+='iNet.controls["'+a+'"].messageError = "'+i+'"\n'}h+='if(!(!!"$editmode" && "$editmode" == "true")) {\n';
h+='$("#'+c+'").attr("disabled", "disabled"); \n';h+="}\n";h+="});\n"}h+="});";h+="<\/script>";var f='<SelectControl id="{0}">{1}</SelectControl>';return String.format(f,a,h)},SimpleGrid:function(d,a){var g=d.find("[data-properties]"),c=d.find('[data-control="SimpleGrid"]').prop("id")||"",k=$("#"+c).attr("target-id")||"",m=d.find('[data-action="NewRecord"]').prop("id")||"",l=d.find('[data-control="Text"]').prop("id")||"",b=g.find('[rel="require"]:first').attr("property-value")||"",e=g.find('[rel="errormessage"]:first').attr("property-value")||
"*",j=[],i=[],h=[],s=g.find('datasource[target-id="'+k+'"]:first');s.find('[ref="column"]').each(function(){var n=$(this),p=n.attr("ref")||"",u=n.attr("rel")||"";n=s.find('column[target-id="'+u+'"]');var x=n.find('[rel="type"]:first').attr("property-value")||"",v=n.find('[rel="property"]:first').attr("property-value")||"",y=n.find('[rel="label"]:first').attr("property-value")||"",q=n.find('[rel="width"]:first').attr("property-value")||"",r=n.find('[rel="sortable"]:first').attr("property-value")||
"",z=n.find('[rel="disabled"]:first').attr("property-value")||"",C=n.find('[rel="align"]:first').attr("property-value")||"",A=n.find('[rel="service"]:first').attr("property-value")||"",F=n.find('[rel="sourcevalue"]:first').attr("property-value")||"",G=n.find('[rel="displayvalue"]:first').attr("property-value")||"",H=n.find('[rel="keyvalue"]:first').attr("property-value")||"",D=n.find('[rel="formula"]:first').attr("property-value")||"";if(x=="select2"&&iNet.isEmpty(A))x="text";switch(x){case "select2":var B=
'{"name": "{0}", "title": "{1}", "width" : "{2}", "fnEdit": "{3}", "optValue": "id", "optDisplay": "name", "type" : "select2"}',E=String.format("fnGet{0}",v);i.push({name:v,formula:D});h.push({name:v,service:A,sourcevalue:F,displayvalue:G,keyvalue:H,fnEdit:E});B=String.format(B,v,y,q,E);j.push(B);break;case "datetime":B='{"name": "{0}", "title": "{1}", "width" : "{2}", "sortable": "{3}", "disabled": "{4}", "align": "{5}", "type" : "{6}", "clearTime": true }';i.push({name:v,formula:D});B=String.format(B,
v,y,q,r,z,C,x);j.push(B);break;default:B='{"name": "{0}", "title": "{1}", "width" : "{2}", "sortable": "{3}", "disabled": "{4}", "align": "{5}", "type" : "{6}"}';i.push({name:v,formula:D});B=String.format(B,v,y,q,r,z,C,x);j.push(B)}});var w="";w+='<script type="text/javascript">';w+="$(function() {\n";w+="fnData"+a+" = {};\n";$.each(h,function(n,p){w+="fnData"+a+'["fnGet'+p.name+'"]=[];\n'});w+="});\n";w+="<\/script>";var o="";o+="#gridUI({\n";o+='"type":"simple-grid-form",\n';o+='"namespace":"'+
a+'",\n';o+='"id":"'+c+'",\n';o+='"url":"",\n';o+='"firstLoad": false,\n';o+='"hideHeader": true,\n';o+='"hideSearch": true,\n';o+='"rowId":"autoId"\n';o+="})\n";o+="[\n";o+=j.toString();o+="#if(!!$editmode && $editmode == true)";o+=",{\n";o+='"align": "center",\n';o+='"buttons":\n';o+="[\n";o+='{"fnAction": "gridedit", "icon": "icon-pencil", "title": "Edit"},\n';o+='{"fnAction": "griddelete", "icon": "icon-trash", "css": "label label-important", "title": "delete"}\n';o+="]\n";o+="}\n";o+="#end";
o+="]\n";o+="#end";var f="";f+='<script type="text/javascript">';f+="$(function() {\n";f+='iNet.sources["'+a+'"] = {};\n';f+='iNet.ajaxs["'+a+'"] = {};\n';$.each(h,function(n,p){f+='iNet.sources["'+a+'"]["'+p.name+'"] = [];\n';f+='iNet.ajaxs["'+a+'"]["postJSON'+p.name+'"] = \n';f+='$.postJSON(iNet.getUrl("'+p.service+'"), {pageNumber: 0, pageSize: 9999}, function(result){ \n';f+="var __result = result || {}; \n";if(iNet.isEmpty(p.sourcevalue)){f+="for (var key in __result) {\n";f+="if (iNet.isArray(__result[key])) {\n";
f+="$.each(__result[key] || [], function (i, obj) {\n";f+='iNet.sources["'+a+'"]["'+p.name+'"].push({id: (obj["'+(p.keyvalue||"id")+'"] || "EmptyId"), code: (obj["'+(p.keyvalue||"code")+'"] || "EmptyCode"), name: (obj["'+(p.displayvalue||"name")+'"] || "EmptyName"), obj: obj}); \n';f+="});\n";f+="}\n"}else{f+='if (iNet.isArray(__result["'+p.sourcevalue+'"])) {\n';f+='$.each(__result["'+p.sourcevalue+'"] || [], function (i, obj) {\n';f+='iNet.sources["'+a+'"]["'+p.name+'"].push({id: (obj["'+(p.keyvalue||
"id")+'"] || "EmptyId"), code: (obj["'+(p.keyvalue||"code")+'"] || "EmptyCode"), name: (obj["'+(p.displayvalue||"name")+'"] || "EmptyName"), obj: obj}); \n';f+="});\n"}f+="}\n";f+="});\n"});f+='iNet.controls["'+a+'"] = null;\n';f+="$.when(";$.each(h,function(n,p){f+='iNet.ajaxs["'+a+'"]["postJSON'+p.name+'"]'+(n==h.length-1?"":",")});f+=").done(function(){\n";$.each(h,function(n,p){f+="fnData"+a+'["fnGet'+p.name+'"] = iNet.sources["'+a+'"]["'+p.name+'"];\n'});f+='iNet.controls["'+a+'"] = new iNet.ui.'+
a+".SimpleGrid({\n";f+="fnDataEdit: fnData"+a+",\n";f+="hideHeader: true,\n";f+="pageSize: 200,\n";f+="data: #if(!!$formreqdata && !!$formreqdata."+a+")$formreqdata."+a+"#else[]#end\n";f+="});\n";f+='iNet.controls["'+a+'"].validate = "'+a+'";\n';f+='iNet.controls["'+a+'"].type="SimpleGrid";\n';if(b=="true"){f+='iNet.controls["'+a+'"].validate = function(){\n';f+="return new iNet.ui.form.Validate({\n";f+='id: iNet.findForm($("#'+l+'")),\n';f+="rules: [\n";f+="{\n";f+='id: "'+l+'",\n';f+="validate: function (v) {\n";
f+="if (iNet.isEmpty(v)){\n";f+=' if (iNet.isEmpty($("#'+l+'").attr("value") || "")){\n';f+='  return "'+e+'";\n';f+=" }\n";f+="}\n";f+="}\n";f+="}\n";f+="]\n";f+="});\n";f+="};\n";f+='iNet.controls["'+a+'"].messageError = "'+e+'"\n';f+='iNet.controls["'+a+'"].validateCheck = function(){\n';f+='if (!iNet.controls["'+a+'"].validate().check()){\n';f+='$("#'+c+'").parent().parent().addClass("tooltip-error error");\n';f+='$("#'+c+'").parent().parent().attr("title", "'+e+'");\n';f+="} else {\n";f+='$("#'+
c+'").parent().parent().removeClass("tooltip-error error");\n';f+='$("#'+c+'").parent().parent().attr("title", "");\n';f+="};\n";f+="};\n"}if(!iNet.isEmpty(m)){f+='if(!!"$editmode" && "$editmode" == "true"){\n';f+='$("#'+m+'").show();\n';f+="} else { \n";f+='$("#'+m+'").hide();\n';f+="}\n";f+='$("#'+m+'").on("click", function(){\n';f+='iNet.controls["'+a+'"].newRecord();\n';f+="});\n"}f+='iNet.controls["'+a+'"].setValue = function(){\n';f+="}\n";f+='iNet.controls["'+a+'"].getValue = function(){\n';
f+='return $("#'+l+'").val(); \n';f+="}\n";f+='iNet.controls["'+a+'"].updateStore = function(){\n';f+='$("#'+l+'").val(iNet.JSON.encode(iNet.controls["'+a+'"].getStore().values()));\n';f+="};\n";f+='iNet.controls["'+a+'"].getColValue = function(col, formula){\n';f+='var __col = col || "";\n';f+='var __formula = formula || "sum";\n';f+="var __valueReturn = 0;\n";f+="if(iNet.isEmpty(__col)) return 0;\n";f+='if(__formula == "sum"){\n';f+='var __values = iNet.controls["'+a+'"].getStore().values() || [];\n';
f+="$.each(__values, function(i, value){\n";f+="var __value = value || {};\n";f+="__valueReturn  += iNet.isNumber(Number(__value[col] || 0)) ? Number(__value[col] || 0) : 0;\n";f+="});\n";f+="return __valueReturn;\n";f+="} else {\n";f+="return __valueReturn;\n";f+="}\n";f+="};\n";f+='iNet.controls["'+a+'"].on("save", function (row) {\n';f+="row = row || {};\n";f+="row.autoId = iNet.generateId();\n";$.each(i,function(n,p){if(!iNet.isEmpty(p.name||"")&&!iNet.isEmpty(p.formula||""))f+='try{row["'+p.name+
'"] = math.eval(""+'+p.formula+");}catch(ex) {}\n"});f+='iNet.controls["'+a+'"].insert(row);\n';f+="});\n";f+='iNet.controls["'+a+'"].on("insert", function (row) {\n';f+='iNet.controls["'+a+'"].updateStore();\n';f+='iNet.controls["'+a+'"].fireEvent("completed", row);\n';f+="});\n";f+='iNet.controls["'+a+'"].on("update", function (newData, oldData) {\n';f+="var row = iNet.apply(oldData, newData) || {};\n";$.each(i,function(n,p){if(!iNet.isEmpty(p.name||"")&&!iNet.isEmpty(p.formula||""))f+='try{row["'+
p.name+'"] = math.eval(""+'+p.formula+");}catch(ex) {}\n"});f+='iNet.controls["'+a+'"].update(row);\n';f+='iNet.controls["'+a+'"].commit();\n';f+='iNet.controls["'+a+'"].updateStore();\n';f+='iNet.controls["'+a+'"].fireEvent("completed", row);\n';f+="});\n";f+='iNet.controls["'+a+'"].on("gridedit", function(row){\n';f+='iNet.controls["'+a+'"].edit(row[iNet.controls["'+a+'"].getIdProperty()]);\n';f+="});\n";f+='iNet.controls["'+a+'"].on("griddelete", function(row){\n';f+='iNet.controls["'+a+'"].remove(row[iNet.controls["'+
a+'"].getIdProperty()]);\n';f+='iNet.controls["'+a+'"].updateStore();\n';f+='iNet.controls["'+a+'"].fireEvent("completed", row);\n';f+="});\n";f+='iNet.controls["'+a+'"].on("loaded", function(){\n';f+='console.log(">>loaded>>>");\n';f+='iNet.controls["'+a+'"].updateStore();\n';f+="});\n";f+="});\n";f+="});";f+="<\/script>";var t='<SimpleGridControl id="{0}">{1}</SimpleGridControl>';return String.format(t,a,w+o+f)},GraphData:function(d,a){d.find("[data-properties]");var g=d.find('[data-control="GraphData"]').prop("id")||
"",c=d.find('[data-control="Text"]').prop("id")||"",k=d.find('[data-control="Button"][data-action="Search"]').prop("id")||"",m=d.find('[data-control="Button"][data-action="Close"]').prop("id")||"",l=d.find('[data-control="Select"]').prop("id")||"",b=d.find('[data-control="Grid"]').prop("id")||"",e="";e+='<script type="text/javascript">';e+="$(function() {\n";e+='if(!!"$editmode" && "$editmode" == "true") {\n';e+='$("#'+g+'").show(); \n';e+="} else { \n";e+='$("#'+g+'").hide(); \n';e+="}\n";e+="var __dataSource = new DataSource({\n";
e+="columns: [\n";e+='{property:"requestorName",label:"Requestor",sortable: true,disabled: true,type: "label",},\n';e+='{property:"requestTime",label:"Request time",sortable: true,disabled: true,type: "datetime",},\n';e+='{property:"name",label:"Subject",sortable: true,disabled: true,type: "label",},\n';e+='{label: "",type: "action",width: 32,align: "center",\n';e+='buttons: [{text: "Select",icon: "icon-ok",labelCls: "label label-info",\n';e+='fn: function (record) {iNet.controls["'+a+'"].fireEvent("select", record);}\n';
e+="}]}\n";e+="],\n";e+="delay: 250\n";e+="});\n";e+='iNet.controls["'+a+'"] = new iNet.ui.grid.Grid({\n';e+='id: "'+b+'",\n';e+='url: iNet.getUrl("request/warehouse/query"),\n';e+='params: {type: true, keyword: ""},\n';e+="convertData: function (data) {\n";e+="var __data = data || {};\n";e+='iNet.controls["'+a+'"].setTotal(__data.total);\n';e+="return __data.items || [];},\n";e+="dataSource: __dataSource,\n";e+="stretchHeight: false,\n";e+="editable: false,\n";e+="firstLoad: false,\n";e+='idProperty: "uuid"\n';
e+="});\n";e+='iNet.controls["'+a+'"].validate = "'+a+'";\n';e+='iNet.controls["'+a+'"].type="GraphData";\n';e+='iNet.controls["'+a+'"].selected = function(item){\n';e+='$("#'+k+'").parent().removeClass("open");\n';e+="};\n";e+='$("#'+k+'").on("click", function(){\n';e+='$("#'+k+'").parent().addClass("open");\n';e+='var __params = iNet.controls["'+a+'"].getParams() || {};\n';e+='__params.keyword = $("#'+c+'").val();\n';e+='__params.type = $("#'+l+'").val();\n';e+='iNet.controls["'+a+'"].setParams(__params);\n';
e+='iNet.controls["'+a+'"].load();\n';e+="});\n";e+='$("#'+m+'").on("click", function(){\n';e+='$("#'+m+'").parent().parent().parent().removeClass("open");\n';e+="});\n";e+="});";e+="<\/script>";var j='<GraphDataControl id="{0}">{1}</GraphDataControl>';return String.format(j,a,e)},Textarea:function(d,a){var g=d.find("[data-properties]"),c=d.find('[data-control="Textarea"]').prop("id")||"",k=$("#"+c).attr("target-id")||"",m=g.find('[rel="require"]:first').attr("property-value")||"",l=g.find('[rel="errormessage"]:first').attr("property-value")||
"*",b="";b+='<script type="text/javascript">';b+="$(function() {\n";b+='iNet.controls["'+a+'"] = $("#'+c+'");\n';b+='iNet.controls["'+a+'"].validate = "'+a+'";\n';b+='iNet.controls["'+a+'"].type="Textarea";\n';if(m=="true"){b+='iNet.controls["'+a+'"].validate = function(){\n';b+="return new iNet.ui.form.Validate({\n";b+='id: iNet.findForm($("#'+c+'")),\n';b+="rules: [\n";b+="{\n";b+='id: "'+c+'",\n';b+="validate: function (v) {\n";b+="if (iNet.isEmpty(v)){\n";b+=' if (iNet.isEmpty($("#'+c+'").attr("value") || "")){\n';
b+='  return "'+l+'";\n';b+=" }\n";b+="}\n";b+="}\n";b+="}\n";b+="]\n";b+="});\n";b+="};\n";b+='iNet.controls["'+a+'"].messageError = "'+l+'"\n'}b+='if(!(!!"$editmode" && "$editmode" == "true")) {\n';b+='$("#'+c+'").attr("disabled", "disabled"); \n';b+="}\n";b+="});";b+="<\/script>";var e='<TextareaControl id="{0}">{1}</TextareaControl>';return String.format(e,a,b)},iNetScript:function(d){var a="",g="",c="";c+='<script type="text/javascript">';c+="$(function() {\n";c+="iNet.sources = {};\n";c+="iNet.ajaxs = {};\n";
c+="iNet.controls = {};\n";c+="iNet.findForm = function($el){\n";c+='if ($el.get(0).tagName == "FORM") {\n';c+='return $el.prop("id");\n';c+="} else {\n";c+="return iNet.findForm($el.parent()); \n";c+="};\n";c+="};\n";c+="iNet.requestData = {\n";c+="messageError: [],\n";c+="validate: function(){\n";c+="var __validateCheck = true;\n";c+="iNet.requestData.messageError=[];\n";c+="for (var control in iNet.controls) {\n";c+="try {\n";c+="  if (!iNet.isEmpty(iNet.controls[control])) {\n";c+="    if (iNet.isFunction(iNet.controls[control].validate)) {\n";
c+="      if (!iNet.controls[control].validate().check()){\n";c+='      if (iNet.controls[control].type=="File"){\n';c+="      var $fileContent = iNet.controls[control].parent();\n";c+='      var dataHardCopy = ($fileContent.find("input[data-hardcopy]").length > 0) ? $fileContent.find("input[data-hardcopy]").val() : "noHardCopy";\n';c+='      var dataScanner = ($fileContent.find("input[data-scanner]").length > 0) ? $fileContent.find("input[data-scanner]").val() : "noScanner";\n';c+="      var dataFile = iNet.controls[control].val();\n";
c+='      if (dataHardCopy=="false" && iNet.isEmpty(dataScanner) && iNet.isEmpty(dataFile)){\n';c+="        iNet.requestData.messageError.push(iNet.controls[control].messageError);\n";c+="        __validateCheck = false;\n";c+="      }\n";c+="      } else {\n";c+="        iNet.requestData.messageError.push(iNet.controls[control].messageError);\n";c+="        __validateCheck = false;\n";c+="      }\n";c+="      }\n";c+='      if (iNet.controls[control].type.indexOf("File")>=0 || iNet.controls[control].type.indexOf("SimpleGrid")>=0){\n';
c+="        iNet.controls[control].validateCheck();\n";c+="      }\n";c+="    }\n";c+="  }\n";c+="} catch(ex) {}\n";c+="}\n";c+="return __validateCheck;\n";c+="},\n";c+="messageValidate: function(){\n";c+='return iNet.requestData.validate() ? "" : iNet.requestData.messageError;\n';c+="}\n";c+="};\n";c+="fnDataEdit = {};\n";c+="});\n";c+="<\/script>";d.find("[data-control]").each(function(){var e=$(this),j=e.find("[data-content][web-content]:first"),i=e.attr("data-control")||"",h=e.find("[name]").attr("name")||
"";if(!iNet.isEmpty(i)&&j.length>0)switch(i){case "Widget":a=PublicService.Widget(e,h);g+=a+"\n";break;case "Label":a=PublicService.Label(e,h);g+=a+"\n";break;case "Text":case "TextBox":a=PublicService.Text(e,h);g+=a+"\n";if(i=="TextBox"){a=PublicService.Label(e,h+"lbl");g+=a+"\n"}break;case "Check":case "CheckBox":a=PublicService.Check(e,h);g+=a+"\n";if(i=="Check"){a=PublicService.Label(e,h+"lbl");g+=a+"\n"}break;case "Number":case "NumberBox":a=PublicService.Number(e,h);g+=a+"\n";if(i=="NumberBox"){a=
PublicService.Label(e,h+"lbl");g+=a+"\n"}break;case "Textarea":case "TextareaBox":a=PublicService.Textarea(e,h);g+=a+"\n";if(i=="TextBox"){a=PublicService.Label(e,h+"lbl");g+=a+"\n"}break;case "Date":case "DateBox":a=PublicService.Date(e,h);g+=a+"\n";if(i=="TextBox"){a=PublicService.Label(e,h+"lbl");g+=a+"\n"}break;case "File":case "FileBox":a=PublicService.File(e,h);g+=a+"\n";if(i=="TextBox"){a=PublicService.Label(e,h+"lbl");g+=a+"\n"}break;case "Select":case "SelectBox":a=PublicService.Select(e,
h);g+=a+"\n";if(i=="TextBox"){a=PublicService.Label(e,h+"lbl");g+=a+"\n"}break;case "SimpleGrid":a=PublicService.SimpleGrid(e,h);g+=a+"\n";break;case "GraphData":a=PublicService.GraphData(e,h);g+=a+"\n"}});var k="",m=d.find("[page-javascript-web-content]").text();if(!iNet.isEmpty(m)){var l='<script type="text/javascript">\n{0}<\/script>',b="$(function(){\niNet.pageScript = function(){\n{0}\n};\n});";m=m.replace(/;/gi,";\n");m=m.replace(/var/gi,"\nvar");m=String.format(b,m);k=String.format(l,m)}return String.format("<iNetControls>{0}{1}{2}</iNetControls>",
c,g,k)},PageScript:function(d){console.log(">>> call function PageScript >>>");var a=false;setTimeout(function(){if(!a){console.log(">>> iNet.pageScript >>>");if(iNet.isFunction(iNet.pageScript)){iNet.pageScript();a=true}}},2E3);$(d).on("loaded",function(){console.log(">>> content html loaded  >>> ")})},MobileScript:function(d){var a=d.find("[page-javascript-mobile-content]"),g=String.format("<script>{0}<\/script>",a.html()),c=d.find('[data-control="Widget"]'),k={};if(c.length>0){try{k=JSON.parse(d.find('[type="text/properties"]').html())}catch(m){}c.each(function(){this.setAttribute("widget",
k[this.getAttribute("name")].widget);this.setAttribute("name","widget")})}a.remove();return d.html()+g}};RenderService={generateName:function(){var d=["a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","x","y","z"];return d[Math.floor(Math.random()*26)+1]+iNet.generateId()},DesignData:function(d){d.find("[data-control]").each(function(){var a=$(this),g=a.attr("data-control")||"";if(!iNet.isEmpty(g))if(iNet.isEmpty(a.prop("id"))){var c=RenderService.generateName(),
k=g+"-design-"+c;a.prop("id",k);a.attr("name",c);switch(g){case "Select":BuilderService.CreateSelect(a,k);break;case "Grid":BuilderService.CreateGrid(a,k)}}else k=a.prop("id")||""})},DesignContent:function(d){d.find("[data-control]").each(function(){var a=$(this),g=a.attr("data-control")||"";if(iNet.isEmpty(a.prop("id"))&&!iNet.isEmpty(g)){var c=RenderService.generateName();a.prop("id",g+"-content-"+c);a.parent().parent().parent().find('[rel="name"]').attr("property-value",c);a.parent().parent().parent().find("[name]").attr("name",
c)}})}}});